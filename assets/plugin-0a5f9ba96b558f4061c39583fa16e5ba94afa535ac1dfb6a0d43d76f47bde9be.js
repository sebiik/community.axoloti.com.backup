!function(t,e){function l(t){t.toggleClass("open")}var o=function(t){var e,l=t.createElement("details");if(!("open"in l))return!1;var o=t.body||function(){var l=t.documentElement;return e=!0,l.insertBefore(t.createElement("body"),l.firstElementChild||l.firstChild)}();l.innerHTML="<summary>a</summary>b",l.style.display="block",o.appendChild(l);var n=l.offsetHeight;return l.open=!0,n=n!==l.offsetHeight,o.removeChild(l),e&&o.parentNode.removeChild(o),n}(t);e.fn.details=function(){return o?this:this.each(function(){var t=e(this),o=e("summary",t).first();o.prop("tabIndex",0),o.on("keydown",function(e){return 32===e.keyCode||13===e.keyCode?(l(t),!1):void 0}),o.on("click",function(){o.focus(),l(t)})})}}(document,jQuery),define("discourse/plugins/discourse-details/initializers/apply-details",["discourse/lib/plugin-api","exports"],function(t,e){"use strict";function l(t){t.decorateCooked(function(t){return $("details",t).details()}),t.addToolbarPopupMenuOptionsCallback(function(){return{action:"insertDetails",icon:"caret-right",label:"details.title"}});var e=t.container.lookupFactory("controller:composer");e.reopen({actions:{insertDetails:function(){this.get("toolbarEvent").applySurround("[details="+I18n.t("composer.details_title")+"]","[/details]","details_text",{multiline:!1}),this.set("optionsVisible",!1)}}})}var o=t.withPluginApi;e["default"]={name:"apply-details",initialize:function(){o("0.5",l)}}}),define("discourse/plugins/discourse-details/lib/discourse-markdown/details",["pretty-text/pretty-text","exports"],function(t,e){"use strict";function l(t,e,l){return"<details><summary>"+e+"</summary>"+l+"</details>"}function o(t){for(t=t||"";t!==(t=t.replace(/\[details=([^\]]+)\]((?:(?!\[details=[^\]]+\]|\[\/details\])[\S\s])*)\[\/details\]/gi,l)););return t.replace(/<\/summary>/gi,"</summary>\n\n").replace(/<\/details>/gi,"\n\n</details>\n\n")}function n(t){t.whiteList(["summary","summary[title]","details","details[open]","details.elided"]),t.addPreProcessor(function(t){return o(t)})}e.setup=n;var i=t.registerOption;i(function(t,e){e.features.details=!0})}),function(t){"use strict";function e(t,e){var l,o,n,i=t.data("width"),s=t.data("height"),r=t.data("ratio")?t.data("ratio"):e.default_ratio,a=t.data("youtube-id"),u=t.data("youtube-title"),p=[],c=t.data("parameters")||"";r=r.split(":"),"number"==typeof i&&"number"==typeof s?(t.width(i),l=s+"px"):"number"==typeof i?(t.width(i),l=i*r[1]/r[0]+"px"):(i=t.width(),0===i&&(i=t.parent().width()),l=r[1]/r[0]*100+"%"),p.push('<div class="ytp-thumbnail">'),p.push('<div class="ytp-large-play-button"'),640>=i&&p.push(' style="transform: scale(0.563888888888889);"'),p.push(">"),p.push("<svg>"),p.push('<path fill-rule="evenodd" clip-rule="evenodd" fill="#1F1F1F" class="ytp-large-play-button-svg" d="M84.15,26.4v6.35c0,2.833-0.15,5.967-0.45,9.4c-0.133,1.7-0.267,3.117-0.4,4.25l-0.15,0.95c-0.167,0.767-0.367,1.517-0.6,2.25c-0.667,2.367-1.533,4.083-2.6,5.15c-1.367,1.4-2.967,2.383-4.8,2.95c-0.633,0.2-1.316,0.333-2.05,0.4c-0.767,0.1-1.3,0.167-1.6,0.2c-4.9,0.367-11.283,0.617-19.15,0.75c-2.434,0.034-4.883,0.067-7.35,0.1h-2.95C38.417,59.117,34.5,59.067,30.3,59c-8.433-0.167-14.05-0.383-16.85-0.65c-0.067-0.033-0.667-0.117-1.8-0.25c-0.9-0.133-1.683-0.283-2.35-0.45c-2.066-0.533-3.783-1.5-5.15-2.9c-1.033-1.067-1.9-2.783-2.6-5.15C1.317,48.867,1.133,48.117,1,47.35L0.8,46.4c-0.133-1.133-0.267-2.55-0.4-4.25C0.133,38.717,0,35.583,0,32.75V26.4c0-2.833,0.133-5.95,0.4-9.35l0.4-4.25c0.167-0.966,0.417-2.05,0.75-3.25c0.7-2.333,1.567-4.033,2.6-5.1c1.367-1.434,2.967-2.434,4.8-3c0.633-0.167,1.333-0.3,2.1-0.4c0.4-0.066,0.917-0.133,1.55-0.2c4.9-0.333,11.283-0.567,19.15-0.7C35.65,0.05,39.083,0,42.05,0L45,0.05c2.467,0,4.933,0.034,7.4,0.1c7.833,0.133,14.2,0.367,19.1,0.7c0.3,0.033,0.833,0.1,1.6,0.2c0.733,0.1,1.417,0.233,2.05,0.4c1.833,0.566,3.434,1.566,4.8,3c1.066,1.066,1.933,2.767,2.6,5.1c0.367,1.2,0.617,2.284,0.75,3.25l0.4,4.25C84,20.45,84.15,23.567,84.15,26.4z M33.3,41.4L56,29.6L33.3,17.75V41.4z"></path>'),p.push('<polygon fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" points="33.3,41.4 33.3,17.75 56,29.6"></polygon>'),p.push("</svg>"),p.push("</div>"),p.push("</div>"),p.push('<div class="html5-info-bar">'),p.push('<div class="html5-title">'),p.push('<div class="html5-title-text-wrapper">'),p.push('<a class="html5-title-text" target="_blank" tabindex="3100" href="https://www.youtube.com/watch?v=',a,'">'),void 0===u||null===u||""===u?p.push("youtube.com/watch?v="+a):p.push(u),p.push("</a>"),p.push("</div>"),p.push("</div>"),p.push("</div>"),t.css({"padding-bottom":l}).html(p.join("")),n=i>640?"maxresdefault.jpg":i>480?"sddefault.jpg":i>320?"hqdefault.jpg":i>120?"mqdefault.jpg":0===i?"hqdefault.jpg":"default.jpg",o=t.find(".ytp-thumbnail").css({"background-image":["url(//img.youtube.com/vi/",a,"/",n,")"].join("")}).addClass("lazyYT-image-loaded").on("click",function(l){l.preventDefault(),!t.hasClass("lazyYT-video-loaded")&&o.hasClass("lazyYT-image-loaded")&&t.html('<iframe src="//www.youtube.com/embed/'+a+"?autoplay=1&"+c+'" frameborder="0" allowfullscreen></iframe>').addClass("lazyYT-video-loaded"),e.onPlay&&e.onPlay(l,t)})}t.fn.lazyYT=function(l){var o={default_ratio:"16:9",callback:null,container_class:"lazyYT-container"},n=t.extend(o,l);return this.each(function(){var l=t(this).addClass(n.container_class);e(l,n)})}}(jQuery),function(t){t.fn.iframeTracker=function(e){var l=this.get();if(null===e||e===!1)t.iframeTracker.untrack(l);else{if("object"!=typeof e)throw new Error("Wrong handler type (must be an object, or null|false to untrack)");t.iframeTracker.track(l,e)}},t.iframeTracker={focusRetriever:null,focusRetrieved:!1,handlersList:[],isIE8AndOlder:!1,init:function(){try{1==t.browser.msie&&t.browser.version<9&&(this.isIE8AndOlder=!0)}catch(e){try{var l=navigator.userAgent.match(/(msie) ([\w.]+)/i);l[2]<9&&(this.isIE8AndOlder=!0)}catch(o){}}if(t(window).focus(),t(window).blur(function(e){t.iframeTracker.windowLoseFocus(e)}),t("body").append('<div style="position:fixed; top:0; left:0; overflow:hidden;"><input style="position:absolute; left:-300px;" type="text" value="" id="focus_retriever" readonly="true" /></div>'),this.focusRetriever=t("#focus_retriever"),this.focusRetrieved=!1,t(document).mousemove(function(e){document.activeElement&&"IFRAME"==document.activeElement.tagName&&(t.iframeTracker.focusRetriever.focus(),t.iframeTracker.focusRetrieved=!0)}),this.isIE8AndOlder){this.focusRetriever.blur(function(e){e.stopPropagation(),e.preventDefault(),t.iframeTracker.windowLoseFocus(e)}),t("body").click(function(e){t(window).focus()}),t("form").click(function(t){t.stopPropagation()});try{t("body").on("click","form",function(t){t.stopPropagation()})}catch(e){console.log("[iframeTracker] Please update jQuery to 1.7 or newer. (exception: "+e.message+")")}}},track:function(e,l){l.target=e,t.iframeTracker.handlersList.push(l),t(e).bind("mouseover",{handler:l},t.iframeTracker.mouseoverListener).bind("mouseout",{handler:l},t.iframeTracker.mouseoutListener)},untrack:function(e){if("function"!=typeof Array.prototype.filter)return void console.log("Your browser doesn't support Array filter, untrack disabled");t(e).each(function(e){t(this).unbind("mouseover",t.iframeTracker.mouseoverListener).unbind("mouseout",t.iframeTracker.mouseoutListener)});var l=function(t){return null!==t};for(var o in this.handlersList){for(var n in this.handlersList[o].target)-1!==t.inArray(this.handlersList[o].target[n],e)&&(this.handlersList[o].target[n]=null);this.handlersList[o].target=this.handlersList[o].target.filter(l),0==this.handlersList[o].target.length&&(this.handlersList[o]=null)}this.handlersList=this.handlersList.filter(l)},mouseoverListener:function(t){t.data.handler.over=!0;try{t.data.handler.overCallback(this)}catch(e){}},mouseoutListener:function(e){e.data.handler.over=!1,t.iframeTracker.focusRetriever.focus();try{e.data.handler.outCallback(this)}catch(l){}},windowLoseFocus:function(t){for(var e in this.handlersList)if(1==this.handlersList[e].over)try{this.handlersList[e].blurCallback()}catch(l){}}},t(document).ready(function(){t.iframeTracker.init()})}(jQuery),define("discourse/plugins/lazyYT/initializers/lazyYT",["discourse/lib/plugin-api","exports"],function(t,e){"use strict";var l=t.withPluginApi,o=function(){return!1};e["default"]={name:"apply-lazyYT",initialize:function(){l("0.1",function(t){t.decorateCooked(function(e){var l=$(".lazyYT",e);0!==l.length&&$(".lazyYT",e).lazyYT({onPlay:function(e,n){var i=parseInt(n.closest("article").data("post-id"));i&&t.preventCloak(i),$("iframe",l).iframeTracker({blurCallback:function(){$(document).on("scroll.discourse-youtube",o),window.setTimeout(function(){return $(document).off("scroll.discourse-youtube",o)},1500),$(document).scroll()}})}})})})}}}),Ember.TEMPLATES["javascripts/modal/poll-ui-builder"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["d-modal-body"],null,[["title","class"],["poll.ui_builder.title","poll-ui-builder"]],3],["text","\\n"],["open-element","div",[]],["static-attr","class","modal-footer"],["flush-element"],["text","\\n  "],["append",["helper",["d-button"],null,[["action","icon","class","label","disabled"],["insertPoll","bar-chart-o","btn-primary","poll.ui_builder.insert",["get",["disableInsert"]]]]],false],["text","\\n"],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_options.label"],null],false],["close-element"],["text","\\n        "],["append",["helper",["input-tip"],null,[["validation"],[["get",["minNumOfOptionsValidation"]]]]],false],["text","\\n        "],["append",["helper",["textarea"],null,[["value"],[["get",["pollOptions"]]]]],false],["text","\\n      "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","        "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n          "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.step"],null],false],["close-element"],["text","\\n          "],["append",["helper",["input"],null,[["type","value","valueAttribute","class"],["number",["get",["pollStep"]],"value","poll-options-step"]]],false],["text","\\n        "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.min"],null],false],["close-element"],["text","\\n        "],["append",["helper",["input"],null,[["type","value","valueAttribute","class"],["number",["get",["pollMin"]],"value","poll-options-min"]]],false],["text","\\n        "],["append",["helper",["input-tip"],null,[["validation"],[["get",["minMaxValueValidation"]]]]],false],["text","\\n      "],["close-element"],["text","\\n\\n\\n      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.max"],null],false],["close-element"],["text","\\n        "],["append",["helper",["input"],null,[["type","value","valueAttribute","class"],["number",["get",["pollMax"]],"value","poll-options-max"]]],false],["text","\\n      "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["isNumber"]]],null,1]],"locals":[]},{"statements":[["text","  "],["open-element","form",[]],["static-attr","class","poll-ui-builder-form form-horizontal"],["flush-element"],["text","\\n    "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n      "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_type.label"],null],false],["close-element"],["text","\\n      "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute","none"],[["get",["pollTypes"]],["get",["pollType"]],"value","poll.ui_builder.poll_type.regular"]]],false],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["showMinMax"]]],null,2],["text","\\n    "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n      "],["open-element","label",[]],["flush-element"],["text","\\n        "],["append",["helper",["input"],null,[["type","checked"],["checkbox",["get",["publicPoll"]]]]],false],["text","\\n        "],["append",["helper",["i18n"],["poll.ui_builder.poll_public.label"],null],false],["text","\\n      "],["close-element"],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["unless"],[["get",["isNumber"]]],null,0],["text","  "],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/modal/poll-ui-builder"}}),define("discourse/plugins/poll/initializers/extend-for-poll",["discourse/lib/plugin-api","ember-addons/ember-computed-decorators","discourse-common/lib/get-owner","discourse/widgets/glue","exports"],function(t,e,l,o,n){"use strict";function i(t){for(var e={},l=0;l<t.length;l++){var o=t[l],n=o.decorators,i=o.key;if(delete o.key,delete o.decorators,o.enumerable=!0,o.configurable=!0,("value"in o||o.initializer)&&(o.writable=!0),n)for(var s=0;s<n.length;s++){var r=n[s];if("function"!=typeof r)throw new TypeError("The decorator for method "+o.key+" is of the invalid type "+typeof r);o=r(e,i,o)||o}o.initializer&&(o.value=o.initializer.call(e)),Object.defineProperty(e,i,o)}return e}function s(t){function e(e,l){var n=$(".poll",e);if(n.length){var i=l.getModel();t.preventCloak(i.id);var s=i.get("polls_votes")||{};i.pollsChanged();var a=i.get("pollsObject");a&&n.each(function(t,e){var l=$(e),n=l.data("poll-name"),u=a[n];if(u){var c="multiple"===u.get("type"),d=new p("discourse-poll",o,{id:n+"-"+i.id,post:i,poll:u,vote:s[n]||[],isMultiple:c});d.appendTo(e),r.push(d)}})}}function l(){r.forEach(function(t){return t.cleanUp()})}var o=u(t),n=t.container.lookupFactory("controller:topic");n.reopen({subscribe:function(){var t=this;this._super(),this.messageBus.subscribe("/polls/"+this.get("model.id"),function(e){var l=t.get("model.postStream").findLoadedPost(e.post_id);l&&l.set("polls",e.polls)})},unsubscribe:function(){this.messageBus.unsubscribe("/polls/*"),this._super()}});var s=t.container.lookupFactory("model:post");s.reopen(i([{key:"_polls",initializer:function(){return null}},{key:"pollsObject",initializer:function(){return null}},{key:"pollsChanged",decorators:[a("polls")],value:function(){var t=this,e=this.get("polls");e&&(this._polls=this._polls||{},_.map(e,function(e,l){var o=t._polls[l];o?t._polls[l].setProperties(e):t._polls[l]=Em.Object.create(e)}),this.set("pollsObject",this._polls),r.forEach(function(t){return t.queueRerender()}))}}]));var r=[];t.includePostAttributes("polls","polls_votes"),t.decorateCooked(e,{onlyStream:!0}),t.cleanupStream(l)}var r=t.withPluginApi,a=e.observes,u=l.getRegister,p=o["default"];n["default"]={name:"extend-for-poll",initialize:function(){r("0.1",s)}}}),define("discourse/plugins/poll/initializers/add-poll-ui-builder",["discourse/lib/plugin-api","discourse/lib/show-modal","exports"],function(t,e,l){"use strict";function o(t){var e=t.container.lookup("site-settings:main");if(e.poll_enabled||!t.getCurrentUser()||t.getCurrentUser().staff){var l=t.container.lookupFactory("controller:composer");l.reopen({actions:{showPollBuilder:function(){i("poll-ui-builder").set("toolbarEvent",this.get("toolbarEvent"))}}}),t.addToolbarPopupMenuOptionsCallback(function(){return{action:"showPollBuilder",icon:"bar-chart-o",label:"poll.ui_builder.title"}})}}var n=t.withPluginApi,i=e["default"];l["default"]={name:"add-poll-ui-builder",initialize:function(){n("0.5",o)}}}),define("discourse/plugins/poll/widgets/discourse-poll",["discourse/widgets/widget","virtual-dom","discourse/helpers/fa-icon-node","discourse/widgets/raw-html","discourse/lib/ajax","discourse/plugins/poll/lib/even-round","discourse/widgets/post","discourse/lib/round","exports"],function(t,e,l,o,n,i,s,r,a){"use strict";function u(t){return new h({html:"<span>"+t.html+"</span>"})}function p(t){return m("/polls/voters.json",{type:"get",data:t})["catch"](function(){bootbox.alert(I18n.t("poll.error_while_fetching_voters"))})}var c=t.createWidget,d=e.h,f=l.iconNode,h=o["default"],m=n.ajax,v=i["default"],g=s.avatarFor,b=r["default"];c("discourse-poll-option",{tagName:"li",buildAttributes:function(t){return{"data-poll-option-id":t.option.id}},html:function(t){var e=[],l=t.option,o=t.vote,n=-1!==o.indexOf(l.id);return t.isMultiple?e.push(f(n?"check-square-o":"square-o")):e.push(f(n?"dot-circle-o":"circle-o")),e.push(" "),e.push(u(l)),e},click:function(t){0===$(t.target).closest("a").length&&this.sendWidgetAction("toggleOption",this.attrs.option)}}),c("discourse-poll-load-more",{tagName:"div.poll-voters-toggle-expand",buildKey:function(t){return t.id+"-load-more"},defaultState:function(){return{loading:!1}},html:function(t,e){return e.loading?d("div.spinner.small"):d("a",f("chevron-down"))},click:function(){var t=this.state;if(!t.loading)return t.loading=!0,this.sendWidgetAction("loadMore")["finally"](function(){return t.loading=!1})}}),c("discourse-poll-voters",{tagName:"ul.poll-voters-list",buildKey:function(t){return t.id()},defaultState:function(){return{loaded:"new",pollVoters:[],offset:1}},fetchVoters:function(){var t=this,e=this.attrs,l=this.state;return"loading"!==l.loaded?(l.loaded="loading",p({post_id:e.postId,poll_name:e.pollName,option_id:e.optionId,offset:l.offset}).then(function(o){l.loaded="loaded",l.offset+=1;var n=o[e.pollName],i="number"===e.pollType?n:n[e.optionId];l.pollVoters=l.pollVoters.concat(i),t.scheduleRerender()})):void 0},loadMore:function(){return this.fetchVoters()},html:function(t,e){t.pollVoters&&"new"===e.loaded&&(e.pollVoters=t.pollVoters);var l=e.pollVoters.map(function(t){return d("li",[g("tiny",{username:t.username,template:t.avatar_template})," "])});return e.pollVoters.length<t.totalVotes&&l.push(this.attach("discourse-poll-load-more",{id:t.id()})),d("div.poll-voters",l)}}),c("discourse-poll-standard-results",{tagName:"ul.results",buildKey:function(t){return t.id+"-standard-results"},defaultState:function(){return{loaded:"new"}},fetchVoters:function(){var t=this,e=this.attrs,l=this.state;"new"===l.loaded&&p({post_id:e.post.id,poll_name:e.poll.get("name")}).then(function(o){l.voters=o[e.poll.get("name")],l.loaded="loaded",t.scheduleRerender()})},html:function(t,e){var l=this,o=t.poll,n=o.get("options");if(n){var i=function(){var i=o.get("voters"),s=o.get("public"),r=_.clone(n).sort(function(t,e){return t.votes<e.votes?1:t.votes===e.votes?t.html<e.html?-1:1:-1}),a=0===i?Array(r.length).fill(0):r.map(function(t){return 100*t.votes/i}),p=t.isMultiple?a.map(Math.floor):v(a);return s&&l.fetchVoters(),{v:r.map(function(n,i){var r=[],a=p[i].toString(),c=(t.vote||[]).includes(n.id);return r.push(d("div.option",d("p",[d("span.percentage",a+"%"),u(n)]))),r.push(d("div.bar-back",d("div.bar",{attributes:{style:"width:"+a+"%"}}))),s&&r.push(l.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+n.id},postId:t.post.id,optionId:n.id,pollName:o.get("name"),totalVotes:n.votes,pollVoters:e.voters&&e.voters[n.id]||[]})),d("li",{className:""+(c?"chosen":"")},r)})}}();if("object"==typeof i)return i.v}}}),c("discourse-poll-number-results",{buildKey:function(t){return t.id+"-number-results"},defaultState:function(){return{loaded:"new"}},fetchVoters:function(){var t=this,e=this.attrs,l=this.state;"new"===l.loaded&&p({post_id:e.post.id,poll_name:e.poll.get("name")}).then(function(o){l.voters=o[e.poll.get("name")],l.loaded="loaded",t.scheduleRerender()})},html:function(t,e){var l=t.poll,o=l.get("public"),n=l.get("options").reduce(function(t,e){return t+parseInt(e.html,10)*parseInt(e.votes,10)},0),i=l.voters,s=0===i?0:b(n/i,-2),r=I18n.t("poll.average_rating",{average:s}),a=[d("div.poll-results-number-rating",new h({html:"<span>"+r+"</span>"}))];return o&&(this.fetchVoters(),a.push(this.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+l.get("name")},totalVotes:l.get("voters"),pollVoters:e.voters||[],postId:t.post.id,pollName:l.get("name"),pollType:l.get("type")}))),a}}),c("discourse-poll-container",{tagName:"div.poll-container",html:function(t){var e=this,l=t.poll;if(t.showResults){var o="number"===l.get("type")?"number":"standard";return this.attach("discourse-poll-"+o+"-results",t)}var n=l.get("options");return n?d("ul",n.map(function(l){return e.attach("discourse-poll-option",{option:l,isMultiple:t.isMultiple,vote:t.vote})})):void 0}}),c("discourse-poll-info",{tagName:"div.poll-info",multipleHelpText:function(t,e,l){if(e>0)if(t===e){if(t>1)return I18n.t("poll.multiple.help.x_options",{count:t})}else{if(t>1)return l>e?I18n.t("poll.multiple.help.between_min_and_max_options",{min:t,max:e}):I18n.t("poll.multiple.help.at_least_min_options",{count:t});if(l>=e)return I18n.t("poll.multiple.help.up_to_max_options",{count:e})}},html:function(t){var e=t.poll,l=e.get("voters"),o=[d("p",[d("span.info-number",l.toString()),d("span.info-text",I18n.t("poll.voters",{count:l}))])];if(t.isMultiple)if(t.showResults){var n=e.get("options").reduce(function(t,e){return t+parseInt(e.votes,10)},0);o.push(d("p",[d("span.info-number",n.toString()),d("span.info-text",I18n.t("poll.total_votes",{count:n}))]))}else{var i=this.multipleHelpText(t.min,t.max,e.get("options.length"));i&&o.push(new h({html:"<span>"+i+"</span>"}))}return!t.showResults&&t.poll.get("public")&&o.push(d("p",I18n.t("poll.public.title"))),o}}),c("discourse-poll-buttons",{tagName:"div.poll-buttons",html:function(t){var e=[],l=t.poll,o=t.post,n=o.get("topic.archived"),i="closed"===l.get("status"),s=i||n;if(t.isMultiple&&!s){var r=!t.canCastVotes;e.push(this.attach("button",{className:"btn cast-votes "+(r?"":"btn-primary"),label:"poll.cast-votes.label",title:"poll.cast-votes.title",disabled:r,action:"castVotes"})),e.push(" ")}return t.showResults?e.push(this.attach("button",{className:"btn toggle-results",label:"poll.hide-results.label",title:"poll.hide-results.title",icon:"eye-slash",disabled:s,action:"toggleResults"})):e.push(this.attach("button",{className:"btn toggle-results",label:"poll.show-results.label",title:"poll.show-results.title",icon:"eye",disabled:0===l.get("voters"),action:"toggleResults"})),!this.currentUser||this.currentUser.get("id")!==o.get("user_id")&&!this.currentUser.get("staff")||n||(i?e.push(this.attach("button",{className:"btn toggle-status",label:"poll.open.label",title:"poll.open.title",icon:"unlock-alt",action:"toggleStatus"})):e.push(this.attach("button",{className:"btn toggle-status btn-danger",label:"poll.close.label",title:"poll.close.title",icon:"lock",action:"toggleStatus"}))),e}}),a["default"]=c("discourse-poll",{tagName:"div.poll",buildKey:function(t){return t.id},buildAttributes:function(t){var e=t.poll;return{"data-poll-type":e.get("type"),"data-poll-name":e.get("name"),"data-poll-status":e.get("status"),"data-poll-public":e.get("public")}},defaultState:function(t){var e=t.poll,l=t.post;return{loading:!1,showResults:e.get("isClosed")||l.get("topic.archived")}},html:function(t,e){var l=e.showResults,o=jQuery.extend({},t,{showResults:l,canCastVotes:this.canCastVotes(),min:this.min(),max:this.max()});return d("div",[this.attach("discourse-poll-container",o),this.attach("discourse-poll-info",o),this.attach("discourse-poll-buttons",o)])},isClosed:function(){return"closed"===this.attrs.poll.get("status")},min:function(){var t=parseInt(this.attrs.poll.min,10);return(isNaN(t)||1>t)&&(t=1),t},max:function(){var t=parseInt(this.attrs.poll.max,10),e=this.attrs.poll.options.length;return(isNaN(t)||t>e)&&(t=e),t},canCastVotes:function(){var t=this.state,e=this.attrs;if(this.isClosed()||t.showResults||t.loading)return!1;var l=e.vote.length;return e.isMultiple?l>=this.min()&&l<=this.max():l>0},toggleStatus:function(){var t=this,e=this.state,l=this.attrs,o=l.poll,n="closed"===o.get("status");bootbox.confirm(I18n.t(n?"poll.open.confirm":"poll.close.confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(i){i&&!function(){e.loading=!0;var i=n?"open":"closed";m("/polls/toggle_status",{type:"PUT",data:{post_id:l.post.get("id"),poll_name:o.get("name"),status:i}}).then(function(){o.set("status",i),t.scheduleRerender()})["catch"](function(){bootbox.alert(I18n.t("poll.error_while_toggling_status"))})["finally"](function(){e.loading=!1})}()})},toggleResults:function(){this.state.showResults=!this.state.showResults},showLogin:function(){var t=this.register.lookup("route:application");t.send("showLogin")},toggleOption:function(t){if(!this.isClosed()){this.currentUser||this.showLogin();var e=this.attrs,l=e.vote,o=l.indexOf(t.id);return e.isMultiple||(l.length=0),-1!==o?l.splice(o,1):l.push(t.id),e.isMultiple?void 0:this.castVotes()}},castVotes:function(){if(this.canCastVotes()){if(!this.currentUser)return this.showLogin();var t=this.attrs,e=this.state;return e.loading=!0,m("/polls/vote",{type:"PUT",data:{post_id:t.post.id,poll_name:t.poll.name,options:t.vote}}).then(function(){e.showResults=!0})["catch"](function(){bootbox.alert(I18n.t("poll.error_while_casting_votes"))})["finally"](function(){e.loading=!1})}}})}),define("discourse/plugins/poll/controllers/poll-ui-builder",["ember-addons/ember-computed-decorators","discourse/models/input-validation","exports"],function(t,e,l){"use strict";function o(t){for(var e={},l=0;l<t.length;l++){var o=t[l],n=o.decorators,i=o.key;if(delete o.key,delete o.decorators,o.enumerable=!0,o.configurable=!0,("value"in o||o.initializer)&&(o.writable=!0),n)for(var s=0;s<n.length;s++){var r=n[s];if("function"!=typeof r)throw new TypeError("The decorator for method "+o.key+" is of the invalid type "+typeof r);o=r(e,i,o)||o}o.initializer&&(o.value=o.initializer.call(e)),Object.defineProperty(e,i,o)}return e}var n=t["default"],i=t.observes,s=e["default"];l["default"]=Ember.Controller.extend(o([{key:"numberPollType",initializer:function(){return"number"}},{key:"multiplePollType",initializer:function(){return"multiple"}},{key:"init",value:function(){this._super(),this._setupPoll()}},{key:"pollTypes",decorators:[n("numberPollType","multiplePollType")],value:function(t,e){var l=[];return l.push({name:I18n.t("poll.ui_builder.poll_type.number"),value:t}),l.push({name:I18n.t("poll.ui_builder.poll_type.multiple"),value:e}),l}},{key:"isMultiple",decorators:[n("pollType","pollOptionsCount","multiplePollType")],value:function(t,e,l){return t===l&&e>0}},{key:"isNumber",decorators:[n("pollType","numberPollType")],value:function(t,e){return t===e}},{key:"showMinMax",decorators:[n("isNumber","isMultiple")],value:function(t,e){return t||e}},{key:"pollOptionsCount",decorators:[n("pollOptions")],value:function(t){if(0===t.length)return 0;var e=0;return t.split("\n").forEach(function(t){0!==t.length&&(e+=1)}),e}},{key:"_setPollMax",decorators:[i("isMultiple","isNumber","pollOptionsCount")],value:function(){var t=this.get("isMultiple"),e=this.get("isNumber");(t||e)&&(t?this.set("pollMax",this.get("pollOptionsCount")):e&&this.set("pollMax",this.siteSettings.poll_maximum_options))}},{key:"pollMinOptions",decorators:[n("isMultiple","isNumber","pollOptionsCount")],value:function(t,e,l){return t||e?t?this._comboboxOptions(1,l+1):e?this._comboboxOptions(1,this.siteSettings.poll_maximum_options+1):void 0:void 0}},{key:"pollMaxOptions",decorators:[n("isMultiple","isNumber","pollOptionsCount","pollMin","pollStep")],value:function(t,e,l,o,n){if(t||e){var i=parseInt(o)||1;if(t)return this._comboboxOptions(i+1,l+1);if(e){var s=parseInt(n)||1;return this._comboboxOptions(i+1,i+this.siteSettings.poll_maximum_options*s)}}}},{key:"pollStepOptions",decorators:[n("isNumber","pollMax")],value:function(t,e){return t?this._comboboxOptions(1,(parseInt(e)||1)+1):void 0}},{key:"pollOutput",decorators:[n("isNumber","showMinMax","pollType","publicPoll","pollOptions","pollMin","pollMax","pollStep")],value:function(t,e,l,o,n,i,s,r){var a="[poll",u="",p=this.get("toolbarEvent").getText().match(/\[poll(\s+name=[^\s\]]+)*.*\]/gim);return p&&(a+=" name=poll"+(p.length+1)),l&&(a+=" type="+l),i&&e&&(a+=" min="+i),s&&(a+=" max="+s),t&&(a+=" step="+r),o&&(a+=" public=true"),a+="]",u+=a+"\n",n.length>0&&!t&&n.split("\n").forEach(function(t){0!==t.length&&(u+="* "+t+"\n")}),u+="[/poll]"}},{key:"disableInsert",decorators:[n("pollOptionsCount","isNumber","pollMin","pollMax")],value:function(t,e,l,o){return l>=o||(e?!1:2>t)}},{key:"minMaxValueValidation",decorators:[n("pollMin","pollMax")],value:function(t,e){var l={ok:!0};return t>=e&&(l={failed:!0,reason:I18n.t("poll.ui_builder.help.invalid_values")}),s.create(l)}},{key:"minNumOfOptionsValidation",decorators:[n("disableInsert")],value:function(t){var e={ok:!0};return t&&(e={failed:!0,reason:I18n.t("poll.ui_builder.help.options_count")}),s.create(e)}},{key:"_comboboxOptions",value:function(t,e){return _.range(t,e).map(function(t){return{value:t,name:t}})}},{key:"_setupPoll",value:function(){this.setProperties({pollType:null,publicPoll:!1,pollOptions:"",pollMin:1,pollMax:null,pollStep:1})}},{key:"actions",initializer:function(){return{insertPoll:function(){this.get("toolbarEvent").addText(this.get("pollOutput")),this.send("closeModal"),this._setupPoll()}}}}]))}),define("discourse/plugins/poll/lib/even-round",["exports"],function(t){"use strict";function e(t){return 100===t.map(function(t){return Math.floor(t)}).reduce(function(t,e){return t+e})}t["default"]=function(t){for(var l=t.map(function(t){return t%1}),o=Math.ceil(l.reduce(function(t,e){return t+e})),n=0,i=l.length;o>n&&i>n;n++){for(var s=0,r=0,a=0;a<l.length;a++)l[a]>s&&(r=a,s=l[a]);if(++t[r],l[r]=0,e(t))break}return t.map(function(t){return Math.floor(t)})}}),define("discourse/plugins/poll/lib/discourse-markdown/poll",["pretty-text/pretty-text","exports"],function(t,e){"use strict";function l(t){t.whiteList(["div.poll","div.poll-info","div.poll-container","div.poll-buttons","div[data-*]","span.info-number","span.info-text","a.button.cast-votes","a.button.toggle-results","li[data-*]"]),t.replaceBlock({start:/\[poll((?:\s+\w+=[^\s\]]+)*)\]([\s\S]*)/gim,stop:/\[\/poll\]/gim,emitter:function(e,l){var o=this,n=[];if(e.length)for(var i=function(t){if("string"==typeof t||t instanceof String){var e=o.processInline(String(t));e.length&&n.push(["p"].concat(e))}else n.push(t)},s=void 0;void 0!==(s=e.shift());)this.processBlock(s,e).forEach(i);var r={"class":"poll"};r[g+"status"]="open",r[g+"name"]=b,(l[1].match(x)||[]).forEach(function(e){var l=e.split("="),o=m(l,2),n=o[0],i=o[1],s=t.escape(i.replace(/["']/g,""));r[g+n]=s});var a=parseInt(r[g+"min"],10),u=parseInt(r[g+"max"],10),p=parseInt(r[g+"step"],10);if("number"===r[g+"type"]){isNaN(a)&&(a=1),isNaN(u)&&(u=t.getOptions().pollMaximumOptions),isNaN(p)&&(p=1),n.push(["bulletlist"]);for(var c=a;u>=c;c+=p)n[0].push(["listitem",String(c)])}if(1!==n.length||n[0].length<=1||"numberlist"!==n[0][0]&&"bulletlist"!==n[0][0])return["div"].concat(n);for(var c=1;c<n[0].length;c++)if("listitem"!==n[0][c][0])return["div"].concat(n);for(var c=1;c<n[0].length;c++){var d={};d[g+"option-id"]=h(JSON.stringify(n[0][c].slice(1))),n[0][c].splice(1,0,d)}var f=["div",r],v=["div"],y=["div",{"class":"poll-container"}].concat(n);v.push(y);var _=["div",{"class":"poll-info"}];if(_.push(["p",["span",{"class":"info-number"},"0"],["span",{"class":"info-text"},I18n.t("poll.voters",{count:0})]]),"multiple"===r[g+"type"]){var w=n[0].length-1;(isNaN(a)||1>a)&&(a=1),(isNaN(u)||u>w)&&(u=w);var k=void 0;u>0&&(a===u?a>1&&(k=I18n.t("poll.multiple.help.x_options",{count:a})):a>1?k=w>u?I18n.t("poll.multiple.help.between_min_and_max_options",{
min:a,max:u}):I18n.t("poll.multiple.help.at_least_min_options",{count:a}):w>=u&&(k=I18n.t("poll.multiple.help.up_to_max_options",{count:u}))),k&&_.push(["p",k])}"true"===r[g+"public"]&&_.push(["p",I18n.t("poll.public.title")]),v.push(_);var T=["div",{"class":"poll-buttons"}];return"multiple"===r[g+"type"]&&T.push(["a",{"class":"button cast-votes",title:I18n.t("poll.cast-votes.title")},I18n.t("poll.cast-votes.label")]),T.push(["a",{"class":"button toggle-results",title:I18n.t("poll.show-results.title")},I18n.t("poll.show-results.label")]),f.push(v),f.push(T),f}})}function o(t,e){var l=t[0],o=t[1],n=t[2],u=t[3];l=i(l,o,n,u,e[0],7,-680876936),u=i(u,l,o,n,e[1],12,-389564586),n=i(n,u,l,o,e[2],17,606105819),o=i(o,n,u,l,e[3],22,-1044525330),l=i(l,o,n,u,e[4],7,-176418897),u=i(u,l,o,n,e[5],12,1200080426),n=i(n,u,l,o,e[6],17,-1473231341),o=i(o,n,u,l,e[7],22,-45705983),l=i(l,o,n,u,e[8],7,1770035416),u=i(u,l,o,n,e[9],12,-1958414417),n=i(n,u,l,o,e[10],17,-42063),o=i(o,n,u,l,e[11],22,-1990404162),l=i(l,o,n,u,e[12],7,1804603682),u=i(u,l,o,n,e[13],12,-40341101),n=i(n,u,l,o,e[14],17,-1502002290),o=i(o,n,u,l,e[15],22,1236535329),l=s(l,o,n,u,e[1],5,-165796510),u=s(u,l,o,n,e[6],9,-1069501632),n=s(n,u,l,o,e[11],14,643717713),o=s(o,n,u,l,e[0],20,-373897302),l=s(l,o,n,u,e[5],5,-701558691),u=s(u,l,o,n,e[10],9,38016083),n=s(n,u,l,o,e[15],14,-660478335),o=s(o,n,u,l,e[4],20,-405537848),l=s(l,o,n,u,e[9],5,568446438),u=s(u,l,o,n,e[14],9,-1019803690),n=s(n,u,l,o,e[3],14,-187363961),o=s(o,n,u,l,e[8],20,1163531501),l=s(l,o,n,u,e[13],5,-1444681467),u=s(u,l,o,n,e[2],9,-51403784),n=s(n,u,l,o,e[7],14,1735328473),o=s(o,n,u,l,e[12],20,-1926607734),l=r(l,o,n,u,e[5],4,-378558),u=r(u,l,o,n,e[8],11,-2022574463),n=r(n,u,l,o,e[11],16,1839030562),o=r(o,n,u,l,e[14],23,-35309556),l=r(l,o,n,u,e[1],4,-1530992060),u=r(u,l,o,n,e[4],11,1272893353),n=r(n,u,l,o,e[7],16,-155497632),o=r(o,n,u,l,e[10],23,-1094730640),l=r(l,o,n,u,e[13],4,681279174),u=r(u,l,o,n,e[0],11,-358537222),n=r(n,u,l,o,e[3],16,-722521979),o=r(o,n,u,l,e[6],23,76029189),l=r(l,o,n,u,e[9],4,-640364487),u=r(u,l,o,n,e[12],11,-421815835),n=r(n,u,l,o,e[15],16,530742520),o=r(o,n,u,l,e[2],23,-995338651),l=a(l,o,n,u,e[0],6,-198630844),u=a(u,l,o,n,e[7],10,1126891415),n=a(n,u,l,o,e[14],15,-1416354905),o=a(o,n,u,l,e[5],21,-57434055),l=a(l,o,n,u,e[12],6,1700485571),u=a(u,l,o,n,e[3],10,-1894986606),n=a(n,u,l,o,e[10],15,-1051523),o=a(o,n,u,l,e[1],21,-2054922799),l=a(l,o,n,u,e[8],6,1873313359),u=a(u,l,o,n,e[15],10,-30611744),n=a(n,u,l,o,e[6],15,-1560198380),o=a(o,n,u,l,e[13],21,1309151649),l=a(l,o,n,u,e[4],6,-145523070),u=a(u,l,o,n,e[11],10,-1120210379),n=a(n,u,l,o,e[2],15,718787259),o=a(o,n,u,l,e[9],21,-343485551),t[0]=f(l,t[0]),t[1]=f(o,t[1]),t[2]=f(n,t[2]),t[3]=f(u,t[3])}function n(t,e,l,o,n,i){return e=f(f(e,t),f(o,i)),f(e<<n|e>>>32-n,l)}function i(t,e,l,o,i,s,r){return n(e&l|~e&o,t,e,i,s,r)}function s(t,e,l,o,i,s,r){return n(e&o|l&~o,t,e,i,s,r)}function r(t,e,l,o,i,s,r){return n(e^l^o,t,e,i,s,r)}function a(t,e,l,o,i,s,r){return n(l^(e|~o),t,e,i,s,r)}function u(t){/[\x80-\xFF]/.test(t)&&(t=unescape(encodeURI(t)));var e,l=t.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)o(n,p(t.substring(e-64,e)));t=t.substring(e-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)i[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(o(n,i),e=0;16>e;e++)i[e]=0;return i[14]=8*l,o(n,i),n}function p(t){var e,l=[];for(e=0;64>e;e+=4)l[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return l}function c(t){for(var e="",l=0;4>l;l++)e+=_[t>>8*l+4&15]+_[t>>8*l&15];return e}function d(t){for(var e=0;e<t.length;e++)t[e]=c(t[e]);return t.join("")}function f(t,e){return t+e&4294967295}function h(t){return d(u(t))}var m=function(){function t(t,e){var l=[],o=!0,n=!1,i=void 0;try{for(var s,r=t[Symbol.iterator]();!(o=(s=r.next()).done)&&(l.push(s.value),!e||l.length!==e);o=!0);}catch(a){n=!0,i=a}finally{try{!o&&r["return"]&&r["return"]()}finally{if(n)throw i}}return l}return function(e,l){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,l);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.setup=l;var v=t.registerOption,g="data-poll-",b="poll",y=["type","name","min","max","step","order","status","public"],x=new RegExp("("+y.join("|")+")=['\"]?[^\\s\\]]+['\"]?","g");v(function(t,e){var l=e.getCurrentUser&&e.getCurrentUser(e.userId)||e.currentUser,o=l&&l.staff;e.features.poll=!!t.poll_enabled||o,e.pollMaximumOptions=t.poll_maximum_options});var _="0123456789abcdef".split("")});
//# sourceMappingURL=/assets/plugin-0a5f9ba96b558f4061c39583fa16e5ba94afa535ac1dfb6a0d43d76f47bde9be.js.map