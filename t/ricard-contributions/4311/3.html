<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/ricard-contributions/4311/3 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jul 2023 04:28:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Ricard contributions - Community Library - Axoloti Community</title>
    <meta name="description" content="I&amp;#39;ve uploaded some non-audio objects which I&amp;#39;ve devised while porting the Axoloti to run on the Audiothingies P6 . 

The P6 has 6 rotary encoders, which together with 9 push buttons (and 6 push buttons in the encoders) a&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="../4311.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Ricard contributions&#39;" href="../4311.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/user_avatar/community.axoloti.com/ricard/200/163_1.png" />
<meta property="og:image" content="http://community.axoloti.com/user_avatar/community.axoloti.com/ricard/200/163_1.png" />
<meta property="og:url" content="http://community.axoloti.com/t/ricard-contributions/4311/3" />
<meta name="twitter:url" content="http://community.axoloti.com/t/ricard-contributions/4311/3" />
<meta property="og:title" content="Ricard contributions" />
<meta name="twitter:title" content="Ricard contributions" />
<meta property="og:description" content="Hi and thanks for your interest!   First, you need a patched version of the Axoloti firmware which adds support for the P6, mainly when it comes to differing clock crystal rates, UART assignment, and the different DAC used in the P6, but also removes support for things like the ADC since the STM32 analog inputs are not used in the P6.   The firmware is available in my Github repository, at github.com/polluxsynth/axoloti, on the p6 branch. Basically, you check out that branch (which is just a for..." />
<meta name="twitter:description" content="Hi and thanks for your interest!   First, you need a patched version of the Axoloti firmware which adds support for the P6, mainly when it comes to differing clock crystal rates, UART assignment, and the different DAC used in the P6, but also removes support for things like the ADC since the STM32 analog inputs are not used in the P6.   The firmware is available in my Github repository, at github.com/polluxsynth/axoloti, on the p6 branch. Basically, you check out that branch (which is just a for..." />

      <link rel="next" href="../43114658.html?page=2">

  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html"><img src="../../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="../4311.html">Ricard contributions</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../../c/community-library.html" itemprop="url">
        <span itemprop="title">Community Library</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-03-04T22:02:13Z' itemprop='datePublished'>
             2018-03-04 22:02:13 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I've uploaded some non-audio objects which I've devised while porting the Axoloti to run on the Audiothingies P6 .</p>

<p>The P6 has 6 rotary encoders, which together with 9 push buttons (and 6 push buttons in the encoders) are connected to 74HC165 shift registers using an SPI-like interface (although in the P6 it is bit-banged rather than using an SPI interface in the STM32 chip).</p>

<p>There's also a quadrature decoder object for decoding the outputs from the rotary encoders, which takes two inputs and produces an up clock and a down clock, which output clocks depending on which way the encoder is turned. There's also a step output which outputs clocks independent of the direction of rotation.</p>

<p>Objects:<br>objects/ricard/gpio/in/165ctrl v.axo (control object specifying the pins used and number of bits employed (8 per 74HC165 chip), as well as the scanning rate.<br>objects/ricard/gpio/in/165in.axo (actual bit input object generating a boolean signal)<br>objects/ricard/logic/qdecode.axo (quadrature decoder)</p>

<p>The P6 also uses a 74HC595 shift register for controlling 8 of the LEDs on the front panel.</p>

<p>Objects:<br>objects/ricard/gpio/out/595ctrl.axo (control object specifying the pins used and number of bits employed (8 per 74HC595 chip).<br>objects/ricard/gpio/out/595out.axo (actual bit output object)</p>

<p>The P6 has a 2x24 character LCD, and I've devised a pair of objects for printing to the LCD. The connection is rather rudimentary, utilizing the 4-bit mode of the display, with no status readout, hence a 6 wire interface suffices, with RS, E and 4 data bits D4..D7. The R/W pin is assumed permanently low (i.e. write).</p>

<p>Objects:<br>objects/ricard/disp/lcdctrl.axo (control object specifying the pins used and size of the print queue (number of strings that may be printed at once and which will be printed in order as the display becomes available)<br>objects/ircard/disp/lcdprint.axo (output object outputting the string input to the module when the clock input goes high)</p>

<p>The strings can contain rudimentary cursor control using control characters, see the object definition for more details.</p>

<p>Finally a rather trivial object, which converts a vector of bits into a single bit masked output value, with a 9 bit input. I seem to remember there being an 8 bit version among the factory patches but I cannot find it now.</p>

<p>Object:<br>objects/ricard/logic/bitval 9.axo</p>

<p>Please note that for the control objects, more pins can be selected than normally on Axoloti modules, simply because I want to be able to run these objects on the P6, where some of the pins used are not available for general use in the Axoloti. So exercise caution when using the modules so you don't select pins which are not actually available.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
            <a href="../../creating-a-menu-system/7181/3.html">Creating A Menu System</a>
            <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/lokki.html'><b itemprop='author'>lokki</b></a>
           
           <time datetime='2018-03-04T22:15:19Z' itemprop='datePublished'>
             2018-03-04 22:15:19 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hi ricard, great work! i have a p6 collecting dust and would be very interested in this. so what is the procedure? how do i "update" my p6? how do i upload patches? generally, what works, what not?</p>

<p>cheers</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-03-04T23:41:44Z' itemprop='datePublished'>
             2018-03-04 23:41:44 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi and thanks for your interest!</p>

<p>First, you need a patched version of the Axoloti firmware which adds support for the P6, mainly when it comes to differing clock crystal rates, UART assignment, and the different DAC used in the P6, but also removes support for things like the ADC since the STM32 analog inputs are not used in the P6.</p>

<p>The firmware is available in my Github repository, at github.com/polluxsynth/axoloti, on the p6 branch. Basically, you check out that branch (which is just a fork of the official Axoloti firmware), and build just as you would the standard Axoloti firmware.</p>

<p>To flash the P6, first start the Axoloti UI as usual, connect it to the P6 using a USB cable, and then set the P6 to DFU boot mode by holding the BOOT button inside the P6 and switching it on. Go into the Board -&gt; Firmware -&gt; Flash (rescue) menu in the Axoloti UI to flash the P6; the progress will be indicated in the main Axoloti log window. (For some reason which I haven't  been able to figure out, upgrading to a newer version must be done in the same way, rather than use Board -&gt; Firmware -&gt; Flash .)</p>

<p>After that, it basically works the same as with the standard Axoloti, taking into consideration the limitations of the P6 hardware. MIDI input and output, also over USB, works directly in the platform, using the corresponding Axoloti objects. The LCD and other user interface elements require the special objects described above to access them. There's no audio input of course, since the P6 has no ADC, and there is no SD card, and no DRAM. So objects which use these elements won't work. Apart from the, there's the same DSP and RAM capacity as on the Axoloti hardware. In particular, the Patch -&gt; Upload to internal flash function works, which is really nice on a box with its own user interface.</p>

<p>I just uploaded my test patch, patches/ricard/p6/p6test.axp which basically implements a complete P6 UI, with three embedded objects implementing user interface menus, parameter management, and a state machine for menu navigation. There's also an object which implements rudimentary patch storage in the P6 on-board 24C512 EEPROM. Mind you, these are patches in the UI sense of the embedded objects in the patch, not storage of true Axoloti patches. The reason for this is that my end goal was to implement a synth where only a subset parameters are user controllable, in order to make the user interface more managable, as on any pre-configured synth (such as the P6).</p>

<p>In order for the UI to have something to control, there's a very rudimentary synth implemented as a subpatch, a far cry from a real P6, basically just something to test the user interface on.</p>

<p>Just to be clear, neither the p6 branch of the firmware nor the p6test patch can load original P6 patches or anything, I'm just aiming for something with the same look and feel, as I really like the P6 UI approach.</p>

<p>I haven't done a lot of work on this lately, partly because I'm not fully convinced like things like the LCD and encoder control should be patcher objects, because I feel the Axoloti patcher environment is not ideal for things like state machines and things that are triggered from user buttons, as opposed to DSP code which does something useful all the time, The EEPROM support for instance is implemented partly in the firmware on the p6 branch, and then has a (currently embedded) object for the actual patcher interface, and a similar approach might be more viable for the LCD for instance. At the same time, the current approach means that the objects can be used for other, custom, hardware as well, which is a plus from a community perspective.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
            <a href="../../axoloti-controller-plan-encoders-touch-screen-tft/5092/6.html">Axoloti controller plan - encoders, touch screen TFT</a>
            <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/lokki.html'><b itemprop='author'>lokki</b></a>
           
           <time datetime='2018-03-05T06:33:35Z' itemprop='datePublished'>
             2018-03-05 06:33:35 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>thanks, ok will have a go at this sometime i think. time to setup an axoloti build environment.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-03-05T13:08:20Z' itemprop='datePublished'>
             2018-03-05 13:08:20 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Fortunately, the Axoloti seems to be one of the user friendliest builds I've seen, not that I've seen many though. There's a lot of stuff it does, but it's basically download and go for the most part.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/lokki.html'><b itemprop='author'>lokki</b></a>
           
           <time datetime='2018-03-05T22:41:01Z' itemprop='datePublished'>
             2018-03-05 22:41:01 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hmm, i don't see your objects or patches anywhere in the contrib section...</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-03-06T05:38:07Z' itemprop='datePublished'>
             2018-03-06 05:38:07 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>That's strange. I assume you've pulled from the repository recently, I uploaded them just a couple of days ago. Or else I've made some mistake; I pushed them to the 1.0.12 branch which seems to be the default one. Checked by cloning the axoloti-contrib repository just now and they are there.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/lokki.html'><b itemprop='author'>lokki</b></a>
           
           <time datetime='2018-03-06T06:43:51Z' itemprop='datePublished'>
             2018-03-06 06:43:51 UTC
           </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>all good, it is there. sorry stupid mistake from my side. somehow syncing libraries got disabled at startup. and since i was so used to that i did not even check...</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-05-10T21:45:26Z' itemprop='datePublished'>
             2018-05-10 21:45:26 UTC
           </time>
        </span>
        <span itemprop='position'>#9</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I have updated my quadrature decoder object. It now features configurable debouncing, and configurable knob acceleration (output toggles at an accelerated rate when knob is turned faster). The configuration of the object is now is now in a separate configuration object, so the configuration does not have to be repeated when there are several quadrature decoders in the patch.</p>

<p>I've updated the P6 test patch (p6test.axp) to reflect this, and also added a new P6 patch with a basic single sawtooth oscillator patch, yielding 16 voices of polyphony (it would actually be more, but the Axoloti UI limits polyphony to 16).</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-05-20T23:03:43Z' itemprop='datePublished'>
             2018-05-20 23:03:43 UTC
           </time>
        </span>
        <span itemprop='position'>#10</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Inspired by <a class="mention" href="../../../u/smashedtransistors-2.html">@SmashedTransistors</a> (tiar), I started out with his DP2Saw oscillator, then read this article by Vesa Välimäki et al:</p>

<p><a href="https://www.researchgate.net/publication/236616321_Reducing_Aliasing_from_Synthetic_Audio_Signals_Using_Polynomial_Transition_Regions" class="onebox" target="_blank" rel="nofollow noopener">https://www.researchgate.net/publication/236616321_Reducing_Aliasing_from_Synthetic_Audio_Signals_Using_Polynomial_Transition_Regions</a></p>

<p>on the more optimal PTR algorithm, resulting the following third order PTR sawtooth oscillator:</p>

<ul><li>ricard/osc/PTRSaw.axo</li></ul>

<p>(Note: What SmashedTransistors calls a 'second order DPW' algorithm I believe is actually a third order algorithm, since both the polynomial and differentiation functions match the third-order cases in <a href="https://www.researchgate.net/publication/224557976_Alias-Suppressed_Oscillators_Based_on_Differentiated_Polynomial_Waveforms" rel="nofollow noopener">https://www.researchgate.net/publication/224557976_Alias-Suppressed_Oscillators_Based_on_Differentiated_Polynomial_Waveforms</a> (again by Välimäki and associates).)</p>

<p>What utterly fascinates me is how just making a few changes to the waveform in the sawtooth reset period reduces the aliasing to negligible levels. It becomes very obvious in the PTR algorithm, as the only actual waveform mangling takes place in the reset region, even though the actual output waveform is identical to the DPW algorithm (used in DP2Saw). However, due to the way the computation is performed, numerical precision isn't as important with PTR compared to DPW. Indeed, DP2Saw is quite noisy at lower frequencies which PTRSaw isn't.</p>

<p>A lot of research papers contain a lot of hairy math and are not immediately suitable for conversion to code, however, the above one is an exception, also providing ideas for a PWM oscilator which I have yet to realize.</p>

<p>Another paper which I found immediately useful is this one:</p>

<aside class="onebox whitelistedgeneric">
  <header class="source">
    <a href="https://www.semanticscholar.org/paper/Improved-Polynomial-Transition-Regions-Algorithm-Ambrits/7d31b9d62daa97980edd0284bdcf70e6c0161ddd" target="_blank" rel="nofollow noopener">semanticscholar.org</a>
  </header>
  <article class="onebox-body">
    <img src="../../../../www.semanticscholar.org/img/semantic_scholar_og.html" width="695" height="364" class="thumbnail">

<h3><a href="https://www.semanticscholar.org/paper/Improved-Polynomial-Transition-Regions-Algorithm-Ambrits/7d31b9d62daa97980edd0284bdcf70e6c0161ddd" target="_blank" rel="nofollow noopener">Improved Polynomial Transition Regions Algorithm for Alias-suppressed Signal...</a></h3>

<p>One of the building blocks of virtual analog synthesizers is the oscillator algorithm producing simple geometric waveforms, such as saw or triangle. An important requirement for such a digital oscillator is that its spectrum is similar to that of the...</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>


<p>(also available as <a href="http://home.mit.bme.hu/~bank/publist/smc13.pdf" rel="nofollow noopener">http://home.mit.bme.hu/~bank/publist/smc13.pdf</a>)</p>

<p>outlining how to make a triangle wave oscillator with variable symmetry. Sadly, it only covers the second order case, but the level of harmonics in triangle waves is lower than in sawtooth or square waves to start with, so the results seem fairly usable anyway. Indeed, during some quick tests, the level of aliasing in both the third order PTR above and the second order EPTR oscillators below are less than the build-in BLEP based Axoloti oscillators. From the aforementioned paper I've derived the following implementations:</p>

<ul>
<li>ricard/osc/EPTRSaw.axo : Second order EPTR sawtooth. Less alias than the Axoloti build in sawtooth, but more than the third order PTR above.</li>
<li>ricard/osc/EPTRTri.axo :  Second order EPTR triangle oscillator, a rather crude proof-of-concept implementation just as a test of the EPTR algorithm.</li>
<li>ricard/osc/EPTRAsymTri.axo : Second order EPTR Asymmetric triangle. The waveform generation has been refined, but the symmetry control needs work to be useful, as it is there's much too much action around the zero point of the bipolar control.</li>
</ul>

<p>All of these are work-in-progress, especially EPTRSaw and EPTRTri which are really just stopgaps while getting myself familiar with the algorithms. I've just made some quick tests, there might be weird quirks lingering in the code somewhere.</p>

<p>Indeed, with a combination of methods to make essentially alias free waveforms for both waveforms with discontinuities (e.g. sawtooth and square/pulse waves) as well as with discontinuities in the first derivative (i.e. the waveform is not discontinuous but changes direction, like the triangle wave does), a lot of interesting analog-synth-like waveforms could be constructed from piecewise linear waveform segments, since the PTR/EPTR algorithms only require adjustments of the corresponding trivial waveforms near the transition regions.</p>

<p>The advent of intrinsic hardware floating point capability in microcontrollers such as the STM32F4 means that it's much easier to implement efficient algorithms without having to convert everything to fixed point or integer math. This means that purely analytical measures can be used to calculate the exact sample points, in contrast to the practical implementation of algorithms such as BLEP which rely on pre-computed tables with the residual waves, suffering from limited phase resolution, rendering the in principle alias free BLEP algorithm not as alias free as intended.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:3'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/SmashedTransistors.html'><b itemprop='author'>SmashedTransistors</b></a>
           
           <time datetime='2018-05-21T20:04:09Z' itemprop='datePublished'>
             2018-05-21 20:04:09 UTC
           </time>
        </span>
        <span itemprop='position'>#11</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I'm still surprised to read that Prof Valimaki invented DPW.</p>

<p>This is one of the oldest anti aliasing method !!!</p>

<p>Integrals have been used to calculate mean values since they have been invented !<br>Anti aliasing with them is a basic and direct application.<br>The fact that higher order integration can be used to calculate means of means is also as old as Calculus.<br>Thus only Sir Isaac and Herr Gottfried Wilhelm should be allowed to claim for this !</p>

<p>Back in 1998, I used this trivial method in an exam for my students.<br>Here is an archived thread triggered by one of my student:<br><aside class="onebox whitelistedgeneric">
  <header class="source">
    <a href="https://www.kvraudio.com/forum/viewtopic.php?p=1710116" target="_blank" rel="nofollow noopener">kvraudio.com</a>
  </header>
  <article class="onebox-body">
    <img src="../../../../static.kvraudio.com/i/b/kvraudio-300x300-grey-eeeeee.png" width="" height="" class="thumbnail">

<h3><a href="https://www.kvraudio.com/forum/viewtopic.php?p=1710116" target="_blank" rel="nofollow noopener">KVR Forum: obscure antialiased saw code [Ancient thread bumped; see page 3]...</a></h3>

<p>KVR Audio Forum - obscure antialiased saw code [Ancient thread bumped; see page 3] (Topic in the 'DSP and Plug-in Development' forum)</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>

<p>along with a discussion about state changes and clicks... note the archive date...</p>

<p>I do not claim anything about DPW, I just want to say that It is one of the oldest aliasing limiting method.</p>

<p>The first time i heard about DPW was in an application note for the Motorola DSP 56001 back in 1995.</p>

<p>The aliasing scheme of the D-5 D-10 D-50 Linear Arithmetic Synthesizers by Roland (1987) is consistent with DPW.</p>

<p>The 2D equivalent of pre integration for anti aliasing is known as <a href="https://en.wikipedia.org/wiki/Summed-area_table">"Summed-Area Tables"</a> and was invented in 1984.</p>

<hr>

<p>On the other hand, I don't really get his PTR gibberish.</p>

<p>Instead of calculating the value of a function at a sampled time,<br>fifferentiation of pre intergrated wave functions work by calculating mean values over the time segment between two samples (thanks to integrals).</p>

<p>The application of integrals to hard sync is straight forward: when you have a hard sync event, you split the calculus in two subsample segments instead of one:</p>

<ul>
<li>the segment before the sync </li>
<li>the segment after the sync</li>
</ul>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-05-21T22:47:10Z' itemprop='datePublished'>
             2018-05-21 22:47:10 UTC
           </time>
        </span>
        <span itemprop='position'>#12</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I don't want to take sides as to who invented DPW either. Despite my engineering background, I'm really a noob when it comes to this type of math. My gut feeling though is that even though integration followed by differentiation itself is old as the hills, the theoretical basis for this when it comes to cyclic waveforms has been sketchy, i.e. the math has to hold not only for the waveform itself but also for the discontinuity that appears as it looped, which is not obvious to me anyway.</p>

<p>As I understand it, PTR is not a new algorithm, it's just a mathematical rewrite of DPW, including the realization that the differential of an integrated waveform is identical to the waveform itself, with an offset, except for the transition regions. For the transition regions, instead of actually performing an integration/differentiation operation, the actual resulting sample values can be directly calculated using suitable formulae, the whole point being that over a complete cycle, the amount of CPU time for PTR will be less than DPW. From my point of view, it's appealing that waveforms can be constructed without pre-integration, just a couple of highly specific calculations at the transitions.</p>

<p>One advantage of PTR over DPW seems to be that there is less noise with finite resolution at low frequencies, indeed, other DPW implementations I've seen go for doubles to alleviate this.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/SmashedTransistors.html'><b itemprop='author'>SmashedTransistors</b></a>
           
           <time datetime='2018-05-22T23:07:47Z' itemprop='datePublished'>
             2018-05-22 23:07:47 UTC
           </time>
        </span>
        <span itemprop='position'>#13</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Sorry for polluting this thread with this kind of issues.<br>I think it is very important to state that these methods are "good old methods" and "state of the art" to avoid that some people have the idea to patent them.<br>As a concrete example, symmetric BLEPs have been patented by Korg in 2005 even if it was used by others before (EdgE algorithm by Canam Computers Quartz Audio, but as it has never been published, I think that Korg's patent is valid). I think that's why many people use asymmetric BLEPs or BLITs.</p>

<hr>

<p>The differentiation causes issues when the step is small (ie for low frequencies). In this case, anti aliasing is not needed and you need a way to soft switch from DPW to trivial. That's what I do in my DPW distortions and phase modulated oscillator objects.</p>

<p>Example from distortion DP typeIIA:</p>

<pre><code>  if(fabs(dx) &gt; 0.005f){                     //&lt;---- DP if the segment is 
    y0 = 1.5f * x0*x0 / (1 + x0*x0);                 large enough
    float dy = y1 - y0;                                   /
    outlet_out[i] = arm::float_to_q(dy / dx, 27);  &lt;-----/
  } else {
    float inv = 1/(1 + x0*x0);                                     else
    y0 = 1.5f * x0*x0 * inv;
    outlet_out[i] = arm::float_to_q(3*x0*inv*inv , 27);   //&lt;----- direct value
  }</code></pre>

<hr>

<p>The problem with higher order DPW is that it induces high frequency filtering (as it works as mean values over sample to sample segments).<br>So, i think that the best strategy consists in using oversampling combined with the integro diff scheme.</p>

<p>As far as i experimented simple precision floats are enough for </p>

<ul>
<li>second order (ie two differentiation) for simple oscillators, and </li>
<li>first order (ie one differentiation) for distortions and phase modulated oscillators</li>
</ul>

<p>double precision can be used for second order (two differentiations) for distortions and PM osc, but it is quite tricky to get the glitchless switching conditions (I got some working in jsfx / Reaper)</p>

<hr>

<p>BLITs (and BLEPs) are generally "sharp" in the spectral domain and have Gibbs ondulations in the temporal domain. Thus, they are not good if the signal goes through distortions or saturations that would chop off these ondulations.<br>DPW do not cause these Gibbs overshoots. So the signal can be post distorted without too much trouble.</p>

<p>Note that it may be possible to design "soft" BLITs (or BLEPs) that will behave quite like DPW.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:2'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-05-23T04:58:06Z' itemprop='datePublished'>
             2018-05-23 04:58:06 UTC
           </time>
        </span>
        <span itemprop='position'>#14</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="13" data-topic="4311" data-full="true"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../user_avatar/community.axoloti.com/smashedtransistors/40/3147_1.jpg" class="avatar">SmashedTransistors:</div>
<blockquote><p>Sorry for polluting this thread with this kind of issues.</p></blockquote></aside>

<p>Well, I suppose this is as good a place as any to discuss the issue.<br></p>

<p><aside class="quote"><blockquote><p>I think it is very important to state that these methods are "good old methods" and "state of the art" to avoid that some people have the idea to patent them.<br>As a concrete example, symmetric BLEPs have been patented by Korg in 2005 even if it was used by others before (EdgE algorithm by Canam Computers Quartz Audio, but as it has never been published, I think that Korg's patent is valid). I think that's why many people use asymmetric BLEPs or BLITs.</p></blockquote></aside></p>

<p>That's amazing that Korg managed to patent that. I wonder if it's because its tricky to understand the small details of these algorithms and the fact that a lot of stuff is found in research papers rather than patents that it can slip through the patent system (notwithstanding the fact that a lot of patented stuff should never had made it that far).</p>

<p>I would think though that asymmetric BLEPs (which I'm assuming is not necessarily the same as minBLEPs although the minimum-phase reconstruction of the BLEP does result in a fully causal and asymmetric BLEP) as used in the Axoloti factory oscillators, have the computational advantage that nothing needs to be added before transitions, which otherwise would require some form of waveform lag or lookahead in order to insert the BLEP at the correct point. </p>

<p><aside class="quote"><blockquote><p>The differentiation causes issues when the step is small (ie for low frequencies). In this case, anti aliasing is not needed and you need a way to soft switch from DPW to trivial. </p></blockquote></aside></p>

<p>Yes, I didn't think of that, that would take care of that issue. I still find the PTR algorithm elegant. The whole waveform generation for the PTRSaw oscillator comes out as:</p>

<pre><code>p += dp; p -= (p &gt; 1);
if (p &lt; dp) { D = p/dp; y = (2 * dp - D) * D + 1; }
else if (p &lt; 2*dp) { D = p/dp; y = (D + 2 * dp - 4) * D + 3; }
else y = 2*p - 1;
y -= 2 * dp;</code></pre>

<p>(there's probably still room for optimizations. EDIT: Only calculate D when actually needed.).</p>

<p><aside class="quote"><blockquote><p>DPW do not cause these Gibbs overshoots.</p></blockquote></aside></p>

<p>This is something that fascinates me. From what I can tell, the magic lies in moving the phase of the harmonics around causing the ringings to dissolve. There's also a slight spectral droop with DPW from what I understand, but not enough to explain the complete lack of Gibbs ringings. But doesn't the altered relative phase positions have some form of drawback? After all, from a signal processing point of view, we've run a mathematically correct bandlimited oscillator through a filter whose major contribution is that it messes up the phase response.</p>

<p><aside class="quote"><blockquote><p>Note that it may be possible to design "soft" BLITs (or BLEPs) that will behave quite like DPW.</p></blockquote></aside></p>

<p>Do you mean using the minimum-phase reconstructed residual instead of the obvious BLIT or BLEP?</p>

<p>I may be wrong, but it seems to me that the main problem in a system with limited processing power such as the Axoloti, that it's not possible to generate the BLIT or BLEP in real time, thus it must be added in the form of a waveform, which brings in the additional complexity of how to handle interpolation, for instance by oversampling the BLEP obtaining a polyphase BLEP.  The resulting phase error for the BLEP in a practical implementation limits the antialiasing response, indeed, the Axoloti factory oscillators seem to have a lot more aliasing that the DPW (or PTR) algorithm to my ears. In contrast, DPW and PTR calculate to the available precision the exact sample points.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/SmashedTransistors.html'><b itemprop='author'>SmashedTransistors</b></a>
           
           <time datetime='2018-05-23T06:15:50Z' itemprop='datePublished'>
             2018-05-23 06:15:50 UTC
           </time>
        </span>
        <span itemprop='position'>#15</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>To me the PTR very looks like a two point BLEP consisting of a parabola.</p>

<hr>

<p>I think that good candidates for smooth band limited impulse can be taken from window functions (as they are designed with the same criterion):<br><aside class="onebox wikipedia">
  <header class="source">
    <a href="https://en.wikipedia.org/wiki/Window_function" target="_blank" rel="nofollow noopener">en.wikipedia.org</a>
  </header>
  <article class="onebox-body">
    <img src="../../../../upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Spectral_leakage_from_a_sinusoid_and_rectangular_window.png/480px-Spectral_leakage_from_a_sinusoid_and_rectangular_window.png" class="thumbnail">

<h3><a href="https://en.wikipedia.org/wiki/Window_function" target="_blank" rel="nofollow noopener">Window function</a></h3>

<p>In signal processing, a window function (also known as an apodization function or tapering function) is a mathematical function that is zero-valued outside of some chosen interval. For instance, a function that is constant inside the interval and zero elsewhere is called a rectangular window, which describes the shape of its graphical representation. When another function or waveform/data-sequence is multiplied by a window function, the product is also zero-valued outside the interval: all tha In...</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>

<p>(I think that PTR corresponds to a two point welsh window.)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2018-05-23T08:37:22Z' itemprop='datePublished'>
             2018-05-23 08:37:22 UTC
           </time>
        </span>
        <span itemprop='position'>#16</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Loving this debate. All though I dont understand all of it, its interesting. </p>

<p>Thanks guys <img src="../../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-05-23T22:05:08Z' itemprop='datePublished'>
             2018-05-23 22:05:08 UTC
           </time>
        </span>
        <span itemprop='position'>#17</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="15" data-topic="4311" data-full="true"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../user_avatar/community.axoloti.com/smashedtransistors/40/3147_1.jpg" class="avatar">SmashedTransistors:</div>
<blockquote><p>To me the PTR very looks like a two point BLEP consisting of a parabola.</p></blockquote></aside>

<p>From what I can tell, it was derived by analyzing how each output sample in the corresponding-order DPW algorithm is related to the input (i.e. trivial waveform) samples. So it is mathematically identical to DPW if I understand correctly.</p>

<p>I would think that it's not unlikely that there are different ways to arrive at essentially  the same sample values in the transition region, since all algorithms have the same goal of minimizing frequencies beyond half Nyquist.</p>

<p><aside class="quote"><blockquote><p>I think that good candidates for smooth band limited impulse can be taken from window functions (as they are designed with the same criterion). I think that PTR corresponds to a two point welsh window.)</p></blockquote></aside></p>

<p>Interesting. Have you or do you know of anyone else has elaborated further on this in the form of a paper or other report?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/SmashedTransistors.html'><b itemprop='author'>SmashedTransistors</b></a>
           
           <time datetime='2018-05-23T23:03:38Z' itemprop='datePublished'>
             2018-05-23 23:03:38 UTC
           </time>
        </span>
        <span itemprop='position'>#18</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="17" data-topic="4311"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../user_avatar/community.axoloti.com/ricard/40/163_1.jpg" class="avatar">ricard:</div>
<blockquote><p>Have you or do you know of anyone else has elaborated further on this in the form of a paper or other report?</p></blockquote></aside>

<p>Well... mmm... The BLEP described by Korg in their drawings have no Gibbs overshoot.<br><a href="https://patents.google.com/patent/US20060145733A1" class="onebox" target="_blank">https://patents.google.com/patent/US20060145733A1</a></p>

<p>Anyway, it's not an issue to use a smooth symetric BLIT and integrate it.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-05-24T04:49:10Z' itemprop='datePublished'>
             2018-05-24 04:49:10 UTC
           </time>
        </span>
        <span itemprop='position'>#19</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I would think it would be very difficult to enforce such a patent. Given an arbitrary bandlimited sawtooth oscillator, I would think it impossible to see in the output waveform how the bandlimiting was actually acheived; one would need to look at the actual algorithm for that.</p>

<p>Anyway, back to the thread, I've now uploaded the optimized version of the PTR sawtooth oscillator as described a few posts back.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:2'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2018-05-28T04:41:57Z' itemprop='datePublished'>
             2018-05-28 04:41:57 UTC
           </time>
        </span>
        <span itemprop='position'>#20</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Finally got my PWM oscillator working yesterday:</p>

<ul><li>ricard/osc/PTRPulse.axo</li></ul>

<p>PWM input (and PWM parameter) has a range of -64 to +64, from maximally short negative to maximually short positive pulse, to the point that the oscillator actually goes silent at the extremes. With PWM at 0, the output is a square wave.</p>

<p>The PTR antialising means that the amplitude drops for small pulse widths at high frequencies. I'm thinking about adding a function to optionally limit the minimum pulse width in a frequency-dependent manner so that this doesn't happen, as at high frequencies the harmonics are not really discernible anyway, so the deviation from the intended pulse width would not be noticeable. On the other hand, an analog PW oscillator tends to behave in a similar manner due to limited slew rates, so perhaps it wouldn't buy much.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Ricard contributions'>
      <hr>
  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement'>
      <span itemprop='url'><b><a rel="next" itemprop="name" href="../43114658.html?page=2">next page →</a></b></span>
  </div>





    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../../index.html'>Home</a>
        <a href="../../../categories.html">Categories</a>
        <a href="../../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../../tos.html">Terms of Service</a>
        <a href="../../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/ricard-contributions/4311/3 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jul 2023 04:28:44 GMT -->
</html>
