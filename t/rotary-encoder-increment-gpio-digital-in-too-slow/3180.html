<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/rotary-encoder-increment-gpio-digital-in-too-slow/3180 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Jul 2023 18:46:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Rotary Encoder Increment - GPIO Digital In too slow? - Hardware - Axoloti Community</title>
    <meta name="description" content="Hello everyone! 

I&amp;#39;m working on a project where we use this kind of rotary encoder connected to the axoloti: 
 

The sensor has a Z pin that sends a pulse for every rotation. We use this pulse to trigger a musical note &amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="3180.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Rotary Encoder Increment - GPIO Digital In too slow?&#39;" href="3180.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/rotary-encoder-increment-gpio-digital-in-too-slow/3180" />
<meta name="twitter:url" content="http://community.axoloti.com/t/rotary-encoder-increment-gpio-digital-in-too-slow/3180" />
<meta property="og:title" content="Rotary Encoder Increment - GPIO Digital In too slow?" />
<meta name="twitter:title" content="Rotary Encoder Increment - GPIO Digital In too slow?" />
<meta property="og:description" content="Hello everyone!   I&#39;m working on a project where we use this kind of rotary encoder connected to the axoloti:     The sensor has a Z pin that sends a pulse for every rotation. We use this pulse to trigger a musical note in axoloti. The value of the Z pin is captures using GPIO PA0 through the gpio/in/digital object.   This system works well when the rotation is relatively slow (0-5 Hz). But if the rotation gets faster (5+ Hz) , it seems that gpio/in/digital doesn&#39;t always catch the pulses. It ra..." />
<meta name="twitter:description" content="Hello everyone!   I&#39;m working on a project where we use this kind of rotary encoder connected to the axoloti:     The sensor has a Z pin that sends a pulse for every rotation. We use this pulse to trigger a musical note in axoloti. The value of the Z pin is captures using GPIO PA0 through the gpio/in/digital object.   This system works well when the rotation is relatively slow (0-5 Hz). But if the rotation gets faster (5+ Hz) , it seems that gpio/in/digital doesn&#39;t always catch the pulses. It ra..." />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="http://community.axoloti.com/uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="3180.html">Rotary Encoder Increment - GPIO Digital In too slow?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/hardware.html" itemprop="url">
        <span itemprop="title">Hardware</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/DominicThibault.html'><b itemprop='author'>DominicThibault</b></a>
           
           <time datetime='2017-04-05T02:14:43Z' itemprop='datePublished'>
             2017-04-05 02:14:43 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hello everyone!</p>

<p>I'm working on a project where we use this kind of rotary encoder connected to the axoloti:<br><aside class="onebox whitelistedgeneric">
  <header class="source">
    <a href="https://www.sparkfun.com/products/11102" rel="nofollow noopener">sparkfun.com</a>
  </header>
  <article class="onebox-body">
    <img src="https://cdn.sparkfun.com/r/92-92/assets/parts/6/5/2/7/11102-01.jpg" width="92" height="92" class="thumbnail">

<h3><a href="https://www.sparkfun.com/products/11102" rel="nofollow noopener">Rotary Encoder - 1024 P/R (Quadrature) - COM-11102 - SparkFun Electronics</a></h3>

<p>COM-11102: This 1024 pulse per rotation rotary encoder outputs [gray code](http://en.wikipedia.org/wiki/Gray_code) which you can interpret using a microcontroller and</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>

<p>The sensor has a Z pin that sends a pulse for every rotation. We use this pulse to trigger a musical note in axoloti. The value of the Z pin is captures using GPIO PA0 through the <em>gpio/in/digital</em> object.</p>

<p>This system works well when the rotation is relatively slow (0-5 Hz). But if the rotation gets faster (5+ Hz) , it seems that <em>gpio/in/digital</em> doesn't always catch the pulses. It randomly catches one in four pulses. My guess is that the pulses get too short for the k-rate. Am I wrong in thinking this?</p>

<p>Would any of you know how to make sure my axoloti patch catches the Z pulses up to 25 Hz or so? In another environment, I would add an <em>interrupt</em> function after the Z changes value, just to be sure it gets caught. Can I do this in axoloti?</p>

<p>Thank you for your help!</p>

<p>Best,<br>Dominic</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Rotary Encoder Increment - GPIO Digital In too slow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Gavin.html'><b itemprop='author'>Gavin</b></a>
           
           <time datetime='2017-04-05T03:04:18Z' itemprop='datePublished'>
             2017-04-05 03:04:18 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This encoder is very different to the ones I have mentioned in posts.<br>But looking at the specs, it says its maximum is 6000 rpm with 1024 pulses per rotation, I guess if I am doing this right, that comes out at about 102400 pulses per second.<br>But when you read the comments on the Item below, one comment is made about having to use an FPGA at much higher speeds than a normal Arduino etc to read 4 encoders at 50rpm.<br>Not sure if this is the problem though...<br>One thing you could try is the order of the objects in the patch, this can have interesting impacts, also do you have other rotary encoder types to test and see if the same thing happens ? <img src="http://community.axoloti.com/images/emoji/emoji_one/grin.png?v=3" title=":grin:" class="emoji" alt=":grin:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Rotary Encoder Increment - GPIO Digital In too slow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/DominicThibault.html'><b itemprop='author'>DominicThibault</b></a>
           
           <time datetime='2017-04-05T03:36:48Z' itemprop='datePublished'>
             2017-04-05 03:36:48 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi Gavin, </p>

<p>thanks for your help. Yes, the encoder also has A &amp; B pins that spit out 1024 pulses per rotation. We use that to control LED strips with a Teensy board (it does wonderfully). For the music, we intended to only use the Z pin, which spits out a single pulse per rotation. Much easier to deal with....<br><aside class="onebox wikipedia">
  <header class="source">
    <a href="https://en.wikipedia.org/wiki/Rotary_encoder#Incremental_rotary_encoder" rel="nofollow noopener">en.wikipedia.org</a>
  </header>
  <article class="onebox-body">
    <img src="http://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Gray_code_rotary_encoder_13-track_opened.jpg/220px-Gray_code_rotary_encoder_13-track_opened.jpg" class="thumbnail" width="89" height="170">

<h3><a href="https://en.wikipedia.org/wiki/Rotary_encoder#Incremental_rotary_encoder" rel="nofollow noopener">Rotary encoder | Incremental rotary encoder</a></h3>

<p>An incremental rotary encoder provides cyclical outputs (only) when the encoder is rotated. They can be either mechanical, optical or magnetic. The mechanical type requires debouncing and is typically used as digital potentiometers on equipment including consumer devices. Most modern home and car stereos use mechanical rotary encoders for volume control. Due to the fact the mechanical switches require debouncing, the mechanical type are limited in the rotational speeds they can handle. The increm...</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>

<p>It just seemed odd to me that past 5-10Hz, the axoloti couldn't catch those pulses. I tested and experienced the same problem on 2 rotary encoders of the same model. So I doubt it's a problem with the sensor.</p>

<p>I was hoping to maybe find a way of bettering the rate of the gpio digital in. Or, could I use the dc-coupled audio in on the axoloti and therefore sample the sensor at s-rate?</p>

<p>best,</p>

<p>Dom</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='Rotary Encoder Increment - GPIO Digital In too slow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/TheSlowGrowth.html'><b itemprop='author'>TheSlowGrowth</b></a>
           
           <time datetime='2017-04-05T13:29:10Z' itemprop='datePublished'>
             2017-04-05 13:29:10 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>catching signals like this is tricky from such a high level programming environment. You can try to install your own interrupt for something like this, but it requires some serious hacking and a deeper understanding of the firmware source code to get it done. Though I can definitely see a wider use for a "high speed trigger catch" object.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Rotary Encoder Increment - GPIO Digital In too slow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Gavin.html'><b itemprop='author'>Gavin</b></a>
           
           <time datetime='2017-04-05T22:41:29Z' itemprop='datePublished'>
             2017-04-05 22:41:29 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Are you able to set it up so the encoder can send a signal to an external scope as well as the scope in a patch, that way you could compare the differences ?<br>Or maybe instead of running the encoder at a certain speed, use it to set the speed and tell an LFO what speed to run at ?<br>I am sure there is a solution, maybe not in the way you originally intended  ..<img src="http://community.axoloti.com/images/emoji/emoji_one/grin.png?v=3" title=":grin:" class="emoji" alt=":grin:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Rotary Encoder Increment - GPIO Digital In too slow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2017-04-05T23:02:04Z' itemprop='datePublished'>
             2017-04-05 23:02:04 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Nice encoder!</p>

<aside class="quote" data-post="3" data-topic="3180"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="http://community.axoloti.com/user_avatar/community.axoloti.com/dominicthibault/40/3942_1.png" class="avatar">DominicThibault:</div>
<blockquote><p>It just seemed odd to me that past 5-10Hz, the axoloti couldn't catch those pulses. I tested and experienced the same problem on 2 rotary encoders of the same model. So I doubt it's a problem with the sensor.</p></blockquote></aside>

<p>That is odd indeed, <code>gpio/in/digital</code> reads them at 3000Hz. If you have access to a "real" oscilloscope, please verify the encoder output waveform. Maybe it needs a pullup resistor or something?</p>

<aside class="quote" data-post="1" data-topic="3180"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="http://community.axoloti.com/user_avatar/community.axoloti.com/dominicthibault/40/3942_1.png" class="avatar">DominicThibault:</div>
<blockquote><p>In another environment, I would add an interrupt function after the Z changes value, just to be sure it gets caught. Can I do this in axoloti?</p></blockquote></aside>

<p>GPIO interrupts are not exposed in Axoloti. It could be done but not in an elegant way (far from...). <br>A more elegant way than using interrupts is programming a hardware timer, there is a mode to deal specifically with incremental encoders, refer to chapter "18.3.12 Encoder interface mode" in the "RM0090" STM32F427 reference manual. That should be able to handle 100000 pulses/s and maintain a position counter that does not skip a single step, without causing an interrupt storm.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Rotary Encoder Increment - GPIO Digital In too slow?'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/rotary-encoder-increment-gpio-digital-in-too-slow/3180 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Jul 2023 18:46:41 GMT -->
</html>
