<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/working-with-8bit-integers/2432 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:51:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Working with 8bit integers - AxoObject coding - Axoloti Community</title>
    <meta name="description" content="I wanted to try something fancy: convert an input signal to 8bit (maybe applying some dither) and doing further processing on it (i wanted to build some sort of glitch-esque sample looper-mangler, hoping not to turn it i&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="2432.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Working with 8bit integers&#39;" href="2432.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/working-with-8bit-integers/2432" />
<meta name="twitter:url" content="http://community.axoloti.com/t/working-with-8bit-integers/2432" />
<meta property="og:title" content="Working with 8bit integers" />
<meta name="twitter:title" content="Working with 8bit integers" />
<meta property="og:description" content="I wanted to try something fancy: convert an input signal to 8bit (maybe applying some dither) and doing further processing on it (i wanted to build some sort of glitch-esque sample looper-mangler, hoping not to turn it into vapor). As far as my coding understanding goes: conversion between two types of variable is resource-expensive, but i can try to contain conversions to the minimum.   now, will it be an advantage to use 8bit? (cpu-wise and memory-wise) I was thinking to use both sdram and sra..." />
<meta name="twitter:description" content="I wanted to try something fancy: convert an input signal to 8bit (maybe applying some dither) and doing further processing on it (i wanted to build some sort of glitch-esque sample looper-mangler, hoping not to turn it into vapor). As far as my coding understanding goes: conversion between two types of variable is resource-expensive, but i can try to contain conversions to the minimum.   now, will it be an advantage to use 8bit? (cpu-wise and memory-wise) I was thinking to use both sdram and sra..." />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="2432.html">Working with 8bit integers</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/axoobject-code.html" itemprop="url">
        <span itemprop="title">AxoObject coding</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Sputnki.html'><b itemprop='author'>Sputnki</b></a>
           
           <time datetime='2016-10-21T08:38:34Z' itemprop='datePublished'>
             2016-10-21 08:38:34 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I wanted to try something fancy: convert an input signal to 8bit (maybe applying some dither) and doing further processing on it (i wanted to build some sort of glitch-esque sample looper-mangler, hoping not to turn it into vapor).<br>As far as my coding understanding goes: conversion between two types of variable is resource-expensive, but i can try to contain conversions to the minimum.</p>

<p>now, will it be an advantage to use 8bit? (cpu-wise and memory-wise)<br>I was thinking to use both sdram and sram, so i'll need to rework some objects to do the trick. Should i expect an increase in cpu load?</p>

<p>Edit: i also noticed that uint8_t and int8_t don't seem to work. <img src="../../images/emoji/emoji_one/confused30f4.png?v=3" title=":confused:" class="emoji" alt=":confused:">  does this have something to do with the compiler or the firmware?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Working with 8bit integers'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-10-21T09:59:45Z' itemprop='datePublished'>
             2016-10-21 09:59:45 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>The CPU registers and SRAM memory buses are 32 bits wide, if a performance advantage can be found, it is by using a 32 bit value as a packed array of four 8 bit values. But there are only a few processor instructions that can deal with such packed arrays: </p>

<ul>
<li>(signed/unsigned) (halving/not-halving) (add/substract)<br><code>SADD8</code>, <code>SSUB8</code>, <code>SHADD8</code>, <code>SHSUB8</code>, <code>UADD8</code>, <code>USUB8</code>, <code>UHADD8</code>, <code>UHSUB8</code>
</li>
<li>Unsigned Sum of Absolute Differences and Unsigned Sum of Absolute Differences and Accumulate<br><code>USAD8</code>, <code>USADA8</code>
</li>
<li>and bitwise manipulations like AND also operate (implicitly) on packed array of four 8 bit values</li>
</ul>

<p>But there is no 8 bit multiply instruction, which limits the practical use of 8-bit signal processing.</p>

<p><a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0553aCHDHCBHA.html">instruction set reference</a></p>

<p>The situation is quite different for two 16 bit "halfwords" packed into a 32 bit word, for instance the <code>SMLALD</code> instruction effectively computes two multiplies and two additions in a single instruction cycle. The <code>filter/convolution</code> object takes benefit of this.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Working with 8bit integers'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-10-21T11:07:16Z' itemprop='datePublished'>
             2016-10-21 11:07:16 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I've used int8_t variables in custom objects a lot without any problems.</p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Working with 8bit integers'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Sputnki.html'><b itemprop='author'>Sputnki</b></a>
           
           <time datetime='2016-10-22T09:20:45Z' itemprop='datePublished'>
             2016-10-22 09:20:45 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../users/toneburst.html">@toneburst</a> Did you use them just internally or did you find the way to use them in output?</p>

<p><a class="mention" href="../../users/johannes.html">@johannes</a> those instructions might suffice, actually. I might try doing multiplication outside the 8-bit world and then use the resulting variables just to store and recall data without fancy editing</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Working with 8bit integers'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-10-22T09:54:20Z' itemprop='datePublished'>
             2016-10-22 09:54:20 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="4" data-topic="2432"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/sputnki/40/175_1.png" class="avatar">Sputnki:</div>
<blockquote><p>Did you use them just internally or did you find the way to use them in output?</p></blockquote></aside>

<p>Both, I think. I usually bit-shifted up for output.</p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Working with 8bit integers'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Sputnki.html'><b itemprop='author'>Sputnki</b></a>
           
           <time datetime='2016-10-22T10:37:01Z' itemprop='datePublished'>
             2016-10-22 10:37:01 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>That's odd, i tried outputting an int8_t to an integer outlet and output was always zero</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Working with 8bit integers'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-10-22T10:49:09Z' itemprop='datePublished'>
             2016-10-22 10:49:09 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>That is strange. I've definitely used int outlets with 8-bit ints before. I'll dig out some code later (can't get to my Axoloti at the moment).</p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Working with 8bit integers'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Sputnki.html'><b itemprop='author'>Sputnki</b></a>
           
           <time datetime='2016-10-26T16:58:13Z' itemprop='datePublished'>
             2016-10-26 16:58:13 UTC
           </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I started working with the 32 bit / 4 x 8bit packed array<br>I'm still not sure about the cpu advantage of such approach, but it definitely cuts down memory usage. <br>A 4-track looper is starting to take form, however i still need to get grip with the 2-complement representation of numbers.</p>

<p>I'll explain:<br>the conversion from 32bit to 8 bit is done this way: </p>

<p>There are 4 s-rate inputs (32bit, signed, Q27 format) <br>Each one is bitshifted to take the fractional part in the correct position and then bitwise and-ed with a mask</p>

<p>For example input1 must be fit into the leftmost 8 bits, so it's bitshifted left 5 bits and and-ed with the number 0b11111111000000000000000000000000 (it's a bit mask)</p>

<p><strong>As my current understanding of 2-complement notation goes, this operation should saturate and preserve sign</strong> (but stop me here if my current understanding is wrong)<br>Experiments made summing two 8-bit numbers (with sign) obtained this way showed that the approach is somewhat correct.</p>

<p>I iterate this procedure for all 4 inputs, so</p>

<pre><code>A = (input1&lt;&lt;5 ) &amp; 11111111000000000000000000000000
B = (input2&gt;&gt;3 ) &amp; 00000000111111110000000000000000
C = (input3&gt;&gt;11) &amp; 00000000000000001111111100000000
D = (input4&gt;&gt;19) &amp; 00000000000000000000000011111111</code></pre>

<p>the 4x8bit packet is finally obtained or-ing A, B, C, D (actually it's all done in one line of code) and sent to an sdram array</p>

<p>As i mentioned before, operations made with ARM functions perform how they're expected.</p>

<p><strong>The problem</strong> comes when it's time to convert the packed array back to 32bit format, in particular when the 8bit word has negative sign (which i'd be happy to use to take full advantage of SHADD8, since it's the only way i have to control volume)</p>

<p>what currently happens in the "unpacker" object is this:</p>

<pre><code>   outlet_o1= (bitmask1&amp;attr_table.array[pos])&gt;&gt;5;
   outlet_o2= (bitmask2&amp;attr_table.array[pos])&lt;&lt;3;
   outlet_o3= (bitmask3&amp;attr_table.array[pos])&lt;&lt;11;
   outlet_o4= (bitmask4&amp;attr_table.array[pos])&lt;&lt;19;</code></pre>

<p>attr_table.array[pos] is the 32bit 4x8bit packet created with the first procedure from the table record object.<br>Say i want to retrieve the second 8-bit word (the one which goes in outlet_o2:</p>

<pre><code>attr_table.array[pos] = xxxxxxxxwordwordyyyyyyyyzzzzzzzz //(just to let you see where the 8-bit word is)
bitmask2 = 00000000111111110000000000000000
NUMBER = attr_table.array[pos] &amp; bitmask2 = 00000000wordword0000000000000000
outlet_o2 = NUMBER &lt;&lt; 3 = 00000wordword0000000000000000000 //take it back to Q27 format</code></pre>

<p>You can see now, that if the word i'm retrieving had sign, that is forever gone thanks to those 5 zeros before it.</p>

<p>Is there some clever way to retain sign in this conversion?</p>

<p>Sorry for the very long post, you know, the 20 characters limitation <img src="../../images/emoji/emoji_one/grin30f4.png?v=3" title=":grin:" class="emoji" alt=":grin:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Working with 8bit integers'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Sputnki.html'><b itemprop='author'>Sputnki</b></a>
           
           <time datetime='2016-10-28T21:59:41Z' itemprop='datePublished'>
             2016-10-28 21:59:41 UTC
           </time>
        </span>
        <span itemprop='position'>#9</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I found a relatively simple way to solve the problem: saving the 8bit words into temporary variables and then casting to int32_t and bitshifting.</p>

<p>i made a patch, you can find it in library/community/sptnk/4x8bit looper.axp</p>

<p>The next thing i want to do is to acquire transient data (i have to figure some way to implement this, i guess i might edit the table/alloc object) and make a granular quantized looper (is this going vapor?)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Working with 8bit integers'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/working-with-8bit-integers/2432 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:51:14 GMT -->
</html>
