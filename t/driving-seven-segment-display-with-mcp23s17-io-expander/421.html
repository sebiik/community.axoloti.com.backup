<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/driving-seven-segment-display-with-mcp23s17-io-expander/421 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:03:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Driving seven-segment display with MCP23S17 IO expander - Hardware - Axoloti Community</title>
    <meta name="description" content="Hello everyone, I&amp;#39;ve been playing with my axoloti and imagining some potential hardware designs for it, and I picked up a few components to use in a mono-synth box I want to build. I have a rotary encoder and 2-digit sev&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="421.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Driving seven-segment display with MCP23S17 IO expander&#39;" href="421.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/optimized/1X/29ae9896193102f10226207a2f6bf8d23485545e_1_666x500.jpg" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/optimized/1X/29ae9896193102f10226207a2f6bf8d23485545e_1_666x500.jpg" />
<meta property="og:url" content="http://community.axoloti.com/t/driving-seven-segment-display-with-mcp23s17-io-expander/421" />
<meta name="twitter:url" content="http://community.axoloti.com/t/driving-seven-segment-display-with-mcp23s17-io-expander/421" />
<meta property="og:title" content="Driving seven-segment display with MCP23S17 IO expander" />
<meta name="twitter:title" content="Driving seven-segment display with MCP23S17 IO expander" />
<meta property="og:description" content="Hello everyone, I&#39;ve been playing with my axoloti and imagining some potential hardware designs for it, and I picked up a few components to use in a mono-synth box I want to build. I have a rotary encoder and 2-digit seven-segment display that I&#39;d like to use for patch or parameter changes, and I picked up a an MCP23S17 16-bit digital IO expander (datasheet here) so as not to use up 14 pins for the display alone. So I&#39;ve been trying for two days now and still can&#39;t get any output from the GPIO p..." />
<meta name="twitter:description" content="Hello everyone, I&#39;ve been playing with my axoloti and imagining some potential hardware designs for it, and I picked up a few components to use in a mono-synth box I want to build. I have a rotary encoder and 2-digit seven-segment display that I&#39;d like to use for patch or parameter changes, and I picked up a an MCP23S17 16-bit digital IO expander (datasheet here) so as not to use up 14 pins for the display alone. So I&#39;ve been trying for two days now and still can&#39;t get any output from the GPIO p..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="3 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="12 â¤" />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="421.html">Driving seven-segment display with MCP23S17 IO expander</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/hardware.html" itemprop="url">
        <span itemprop="title">Hardware</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/matthewcieplak.html'><b itemprop='author'>matthewcieplak</b></a>
           
           <time datetime='2015-09-06T21:24:56Z' itemprop='datePublished'>
             2015-09-06 21:24:56 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hello everyone,<br>I've been playing with my axoloti and imagining some potential hardware designs for it, and I picked up a few components to use in a mono-synth box I want to build. I have a rotary encoder and 2-digit seven-segment display that I'd like to use for patch or parameter changes, and I picked up a an MCP23S17 16-bit digital IO expander (<a href="http://ww1.microchip.com/downloads/en/DeviceDoc/21952b.pdf" rel="nofollow">datasheet here</a>) so as not to use up 14 pins for the display alone. So I've been trying for two days now and still can't get any output from the GPIO pins. <img src="../../images/emoji/emoji_one/confuseda4f0.png?v=0" title=":confused:" class="emoji" alt="confused"> </p>

<p>I should say that I'm a computer programmer by trade but have never really done embedded/serial/chip programming (or much of anything in C) so a lot of my confusion is just my inexperience. I put together a patch and script based on the LKM1638 example patch Johannes recommended, as well as some elements from <a class="mention" href="../../users/paul.html">@paul</a>'s 74HC595 shift register patch. I also took the register addresses from <a href="http://www.ermicro.com/blog/?p=1846" rel="nofollow">this tutorial</a>.</p>

<p>I know that the chip select, SPI clock, and data output/input pins should be PA4, PA5, PA6, and PA7, but their arrangement seems to inconsistent between patches. I've tried several combinations, but is this documented somewhere?</p>

<p>Below is a photo of my breadboard and the patch is also attached. I'm sure there are some obvious mistakes throughout. I can get segments to light up if I connect the "interrupt output" pins (19 or 20) to the display, so it clearly has power, but otherwise no dice. Can someone point me in the right direction?</p>

<p><div class="lightbox-wrapper"><a data-download-href="//community.axoloti.com/uploads/default/29ae9896193102f10226207a2f6bf8d23485545e" href="../../uploads/default/original/1X/29ae9896193102f10226207a2f6bf8d23485545e.jpg" class="lightbox" title="IMG_20150906_140429.jpg"><img src="../../uploads/default/optimized/1X/29ae9896193102f10226207a2f6bf8d23485545e_1_666x500.jpg" width="666" height="500"><div class="meta">
<span class="filename">IMG_20150906_140429.jpg</span><span class="informations">2592x1944 1.68 MB</span><span class="expand"></span>
</div></a></div> </p>

<p><a class="attachment" href="../../uploads/default/original/1X/mcp23s17%20io%20expander.axp">mcp23s17 io expander.axp</a> (3.1 KB) </p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:2'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
            <a href="../connecting-lcd-to-axoloti/545/2.html">Connecting LCD to Axoloti</a>
            <hr>
            <a href="../the-xylobox-wavetable-synthesizer-hardware-patches/1353/19.html">The Xylobox Wavetable Synthesizer (hardware + patches)</a>
            <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/rvense.html'><b itemprop='author'>rvense</b></a>
           
           <time datetime='2015-09-06T21:37:43Z' itemprop='datePublished'>
             2015-09-06 21:37:43 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I don't know the chip and I can't test your patch right now, but the data sheet says its maximum clock is 10MHz. As I remember, the default SPI settings give a clock of 20MHz, try setting it slower in the SPI config object. The SPI pinout is always the same: PA4 is the chip select, PA5 is clock, PA6 is input (from the point of view of Axoloti) and PA7 is output.</p>

<p>Do you have access to an oscilloscope of any sort? Seeing the signals as you poke around will make this much easier for you.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2015-09-06T21:53:56Z' itemprop='datePublished'>
             2015-09-06 21:53:56 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Pin out is as rvsense says<br>PA6 is most often called "MISO" : master input, slave output. <br>PA7 is "MOSI", master output, slave input.<br>Axoloti is the master. </p>

<p>Where do you find contradicting info? I'd like to correct/clear up confusing info.</p>

<p>Are you using DMA capable memory in your code? All data buffers used in spiSend(), spiReceive or spiExchange must be declared like this:</p>

<pre><code>static uint8_t _txbuf[8] __attribute__ ((section (".sram2")));
static uint8_t _rxbuf[8] __attribute__ ((section (".sram2")));</code></pre>

<p>You're just hooking wire into the prototyping holes of Axoloti? That will not give a reliable connection. I suggest soldering a strip of female headers into the holes of Axoloti, that is the common way to do it in arduino world. Still, inserting an unstranded wire into a female header strip comes loose very quickly, I am not a big fan. An alternative is soldering a male pinheader strip to the bottom side of Axoloti Core, and then plugging that into your solderless breadboard.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/matthewcieplak.html'><b itemprop='author'>matthewcieplak</b></a>
           
           <time datetime='2015-09-06T22:20:18Z' itemprop='datePublished'>
             2015-09-06 22:20:18 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks for the quick replies!  I think the documentation is probably consistent, but PA6 and PA7 are variously called DIO, MOSI, and "SPI output" in people's demo patches, so I was confused as to whether they were switched depending on configuration.</p>

<p>Clock speed could definitely be a culprit â€“ will try the lowest baudrates first. I do have an old cathode ray scope I could hook up, but I have no probes for it at the moment (have just been using it for A/V graphics stuff).</p>

<p>Yes, the bare wire is probably not helping either. It makes a solid enough connection for analog stuff (operates smoothly when turning potentiometers for example), but now that I know the pinout properly I can just solder some leads on for now. Header strip is not a bad idea â€“ though I think I'll want a big ribbon cable connector when I actually prototype it. Do you know offhand if there's an appropriate molex-type header at 2.54mm pitch?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/matthewcieplak.html'><b itemprop='author'>matthewcieplak</b></a>
           
           <time datetime='2015-09-06T22:26:22Z' itemprop='datePublished'>
             2015-09-06 22:26:22 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>And yes, I think the buffer is correctly declared â€“ that part I copied directly from the LKM patch. It's a [32] byte array at the moment â€“ perhaps that's the issue. Here's the script as of now:</p>

<pre><code>  // MCP23S17 I/O EXPANDER SPI
  // by matthew cieplak

  uint8_t *txbuf;

  #define MCP_IODIRA 0x00
  #define MCP_IODIRB 0x01
  #define MCP_IOCONA 0x0A
  #define MCP_GPPUA  0x0C
  #define MCP_GPPUB  0x0D
  #define MCP_GPIOA  0x12
  #define MCP_GPIOB  0x13

  void setup(void){
  	
  	static uint8_t _txbuf[32] __attribute__ ((section (".sram2")));
  	txbuf = _txbuf;

  	mcp_send_command(MCP_IOCONA,0x28);   // I/O Control Register: BANK=0, SEQOP=1, HAEN=1 (Enable Addressing)
  	mcp_send_command(MCP_IODIRA,0x00);   // GPIOA As Output
  	mcp_send_command(MCP_IODIRB,0x00);   // GPIOB As Output
  	mcp_send_command(MCP_GPIOA,0x00);    // Reset Output on GPIOA
  	mcp_send_command(MCP_GPIOB,0x00);    // Reset Output on GPIOA
  	
  }

  void mcp_send_command(uint8_t reg, uint8_t val){
  	spiSelect(&amp;SPID1);
  	txbuf[0] = reg;
  	txbuf[1] = val;
  	spiSend(&amp;SPID1,2, txbuf);
  	spiUnselect(&amp;SPID1);
  }

  void loop(void){
  	spiSelect(&amp;SPID1);
  	//txbuf[0] = (in1&gt;&gt;8);     // FOR PATCH INPUT
  	//txbuf[1] = (in1);	   // FOR PATCH INPUT
  	txbuf[0] = MCP_GPIOB;
  	txbuf[1] = 0xff;
  	spiSend(&amp;SPID1,2,txbuf);
  	spiUnselect(&amp;SPID1);
  	chThdSleepMilliseconds(1);
  }</code></pre>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2015-09-06T22:46:38Z' itemprop='datePublished'>
             2015-09-06 22:46:38 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="4" data-topic="421"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/matthewcieplak/40/280_1.html" class="avatar">matthewcieplak:</div>
<blockquote><p>called DIO</p></blockquote></aside>

<p>In the lkm1638 case, MOSI and MISO are wired together for bidirectional communication, and then called "Digital Input Output"...</p>

<aside class="quote" data-post="4" data-topic="421"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/matthewcieplak/40/280_1.html" class="avatar">matthewcieplak:</div>
<blockquote><p>"SPI output"</p></blockquote></aside>

<p>output of the master or output of the slave, can be confusing. I like MOSI/MISO best. But SPI is really a "jungle standard"...</p>

<p>Oh I think you need to address the mcp23S17 too...</p>

<pre><code>// MCP23S17 SPI Slave Device
#define SPI_SLAVE_ID    0x40
#define SPI_SLAVE_ADDR  0x00      // A2=0,A1=0,A0=0
#define SPI_SLAVE_WRITE 0x00
#define SPI_SLAVE_READ  0x01

      void mcp_send_command(uint8_t reg, uint8_t val){
        spiSelect(&amp;SPID1);
        txbuf[0] = SPI_SLAVE_ID | ((SPI_SLAVE_ADDR &lt;&lt; 1) &amp; 0x0E)| SPI_SLAVE_WRITE;
        txbuf[1] = reg;
        txbuf[2] = val;
        spiSend(&amp;SPID1,3, txbuf);
        spiUnselect(&amp;SPID1);
      }</code></pre>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/matthewcieplak.html'><b itemprop='author'>matthewcieplak</b></a>
           
           <time datetime='2015-09-07T22:16:59Z' itemprop='datePublished'>
             2015-09-07 22:16:59 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks for the help, guys! Addressing the chip properly, lowering the baudrate and double-checking the connections seems to work. It's still very brittle (sometimes turns off after a few minutes use) but I'll chalk that up to my horrendous connectors... </p>

<p>Next I need figure out how to convert float input from the script object into int array indices for the truth table (just counting change events now...) Then I'll breadboard the encoder input circuit and then I can get to prototyping.</p>

<p><img src="../../uploads/default/original/1X/da26673dda9d5f1164aab3c129f938ee54c1e607.gif" width="240" height="135"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2015-09-07T22:51:12Z' itemprop='datePublished'>
             2015-09-07 22:51:12 UTC
           </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I recommend putting a 100nF capacitor across VDD and VSS of the mcp23s17, as close to that chip as possible, for decoupling. May not make a difference in stability now, but it is common good practice.</p>

<p>What sort of encoder and input circuit do you have in mind? Just a rotary quadrature encoder?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/matthewcieplak.html'><b itemprop='author'>matthewcieplak</b></a>
           
           <time datetime='2015-09-13T08:13:03Z' itemprop='datePublished'>
             2015-09-13 08:13:03 UTC
           </time>
        </span>
        <span itemprop='position'>#9</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Yep, just a regular rotary quadrature encoder. I built the input circuit and patch today, just following the recommended "input filter circuit" from the manufacturer's <a href="http://www.mouser.com/ds/2/54/PEC12R-221222.pdf" rel="nofollow">datasheet</a>. (just some 10k resistors in parallel and 0.01uF caps to ground). I connected Terminal A and B to 2 digital input pads on axoloti, and the below patch decodes into an increment/decrement pair it pretty perfectly, even at high speeds. </p>

<p><img src="../../uploads/default/original/1X/e0eee82cef97ed0b391ee0d43002729a1a2bc2ce.png" width="608" height="258"> </p>

<p><a class="attachment" href="../../uploads/default/original/1X/encoder_quadrature.axp">encoder_quadrature.axp</a> (3.1 KB) </p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
            <a href="../relative-encoders-midi/491/8.html">Relative encoders (midi)</a>
            <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2015-09-13T11:00:44Z' itemprop='datePublished'>
             2015-09-13 11:00:44 UTC
           </time>
        </span>
        <span itemprop='position'>#10</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>You can skip the 10k resistors if you configure the gpio/in/digital mode to "pulldown", and probably can skip the 0.01uF caps too.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/matthewcieplak.html'><b itemprop='author'>matthewcieplak</b></a>
           
           <time datetime='2015-09-21T06:58:25Z' itemprop='datePublished'>
             2015-09-21 06:58:25 UTC
           </time>
        </span>
        <span itemprop='position'>#11</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Finally got this thing working properly. I took my display and encoder circuits and built a protoboard with them (my first project that didn't involve electrical tape!). It looks like this:</p>

<p><div class="lightbox-wrapper"><a data-download-href="//community.axoloti.com/uploads/default/49202244760cb063b940aced5d5abde694e88217" href="../../uploads/default/original/1X/49202244760cb063b940aced5d5abde694e88217.jpg" class="lightbox" title="IMG_20150920_233156.jpg"><img src="../../uploads/default/optimized/1X/49202244760cb063b940aced5d5abde694e88217_1_666x500.jpg" width="666" height="500"><div class="meta">
<span class="filename">IMG_20150920_233156.jpg</span><span class="informations">1000x750 438 KB</span><span class="expand"></span>
</div></a></div> </p>

<p>It took me a whole lot of head scratching (and a run to the store for IC sockets) to figure out that the reset pin (labeled as an output on the MCP23S17 block diagram) is actually an input that must be externally biased (to +3v/5v) to keep sync with the master SPI clock. (Thought I'd fried the IC, but turns out I'd just failed to read the datasheet...) After that incidient, it was pretty easy to convert the encoder output into 2 digits for the display, and now it works like a charm!</p>

<p><img src="../../uploads/default/original/1X/cd64991b56243aa37398a79659ddd2f641121059.gif" width="320" height="180"> </p>

<p>Now I'm off to figure out where to buy potentiometers in bulk. The patch is included below for anyone trying to work this out later:</p>

<p><a class="attachment" href="../../uploads/default/original/1X/mcp23s17_seven_segment.axp">mcp23s17_seven_segment.axp</a> (7.8 KB)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:4'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2015-09-21T12:20:39Z' itemprop='datePublished'>
             2015-09-21 12:20:39 UTC
           </time>
        </span>
        <span itemprop='position'>#12</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="11" data-topic="421"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/matthewcieplak/40/280_1.html" class="avatar">matthewcieplak:</div>
<blockquote><p>It took me a whole lot of head scratching (and a run to the store for IC sockets) to figure out that the reset pin (labeled as an output on the MCP23S17 block diagram) is actually an input that must be externally biased (to +3v/5v) to keep sync with the master SPI clock.</p></blockquote></aside>

<p>Reset is to reset the complete state of the MCP23S17, for syncing, connect the CS input to NSS (not slave select) of the stm32 SPI peripheral.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/philoop.html'><b itemprop='author'>philoop</b></a>
           
           <time datetime='2016-07-07T18:04:12Z' itemprop='datePublished'>
             2016-07-07 18:04:12 UTC
           </time>
        </span>
        <span itemprop='position'>#13</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Could i drive this 8*8 dot matrix too with the MCP23S17?<br><a href="https://www.led-tech.de/de/Displays-und-Matrixen/Dotmatrixen/Dotmatrix-Anzeige-8x8-60x60mm-LT-1374_127_130.html" class="onebox" target="_blank" rel="nofollow">https://www.led-tech.de/de/Displays-und-Matrixen/Dotmatrixen/Dotmatrix-Anzeige-8x8-60x60mm-LT-1374_127_130.html</a><br>I noticed that your counter only goes to 64, so it is somehow similar..<br>And what if i would like to drive a 3 7segment display?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/matthewcieplak.html'><b itemprop='author'>matthewcieplak</b></a>
           
           <time datetime='2016-07-07T21:19:51Z' itemprop='datePublished'>
             2016-07-07 21:19:51 UTC
           </time>
        </span>
        <span itemprop='position'>#14</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Yes, I think you could drive the 8x8 dot matrix with the MCP23s17, but for complex shapes you would have to do line-by-line scan (multiplexing) within the axoloti code. So it might be better to use a matrix driver chip. Ditto for 3-digit displays, as you would need 21 output pins to manage it in an analog fashion as I have done with the MCP. Here is an example multiplexed setup with the MSP430:<br><a href="http://forum.allaboutcircuits.com/blog/msp430-multiplexed-7-segment-displays.559/" class="onebox" target="_blank" rel="nofollow">http://forum.allaboutcircuits.com/blog/msp430-multiplexed-7-segment-displays.559/</a></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Driving seven-segment display with MCP23S17 IO expander'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/driving-seven-segment-display-with-mcp23s17-io-expander/421 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:03:48 GMT -->
</html>
