<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/append-to-file-with-f-lseek/4303 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:05:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Append to file with f_lseek - AxoObject coding - Axoloti Community</title>
    <meta name="description" content="hi, 

i use this example code: 

http://elm-chan.org/fsw/ff/res/app1.c 

to append data to a file that is already on sdcard. it works, but i get some random wrong written bytes when i append big chunks (ca. 1500 bytes or&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="4303.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Append to file with f_lseek&#39;" href="4303.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/append-to-file-with-f-lseek/4303" />
<meta name="twitter:url" content="http://community.axoloti.com/t/append-to-file-with-f-lseek/4303" />
<meta property="og:title" content="Append to file with f_lseek" />
<meta name="twitter:title" content="Append to file with f_lseek" />
<meta property="og:description" content="hi,   i use this example code:   http://elm-chan.org/fsw/ff/res/app1.c   to append data to a file that is already on sdcard. it works, but i get some random wrong written bytes when i append big chunks (ca. 1500 bytes or more)   here is the object i created. non appending mode does work as intended. as soon as i try to append, things go strange. with small arrays it works with big ones it fails. any clues on this? the wrong bytes are not in the beginning of the appended data, but somewhere in th..." />
<meta name="twitter:description" content="hi,   i use this example code:   http://elm-chan.org/fsw/ff/res/app1.c   to append data to a file that is already on sdcard. it works, but i get some random wrong written bytes when i append big chunks (ca. 1500 bytes or more)   here is the object i created. non appending mode does work as intended. as soon as i try to append, things go strange. with small arrays it works with big ones it fails. any clues on this? the wrong bytes are not in the beginning of the appended data, but somewhere in th..." />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="4303.html">Append to file with f_lseek</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/axoobject-code.html" itemprop="url">
        <span itemprop="title">AxoObject coding</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/lokki.html'><b itemprop='author'>lokki</b></a>
           
           <time datetime='2018-03-03T20:56:07Z' itemprop='datePublished'>
             2018-03-03 20:56:07 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hi,</p>

<p>i use this example code:</p>

<p><a href="http://elm-chan.org/fsw/ff/res/app1.c" class="onebox" target="_blank" rel="nofollow noopener">http://elm-chan.org/fsw/ff/res/app1.c</a></p>

<p>to append data to a file that is already on sdcard. it works, but i get some random wrong written bytes when i append big chunks (ca. 1500 bytes or more)</p>

<p>here is the object i created. non appending mode does work as intended. as soon as i try to append, things go strange. with small arrays it works with big ones it fails. any clues on this? the wrong bytes are not in the beginning of the appended data, but somewhere in the middle. the file has the right length. for example 3 bytes might get inserted at one place and 3 bytes are omitted in another place... very strange.</p>

<p><a class="attachment" href="../../uploads/default/original/2X/6/lpcwizard3.axo">lpcwizard3.axo</a> (3.7 KB)</p>

<p>on a related note, there is a flag FA_OPEN_APPEND in fatfs r0.12a and higher, any chance axoloti would incorporate the new version?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Append to file with f_lseek'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/lokki.html'><b itemprop='author'>lokki</b></a>
           
           <time datetime='2018-03-04T19:27:31Z' itemprop='datePublished'>
             2018-03-04 19:27:31 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>ok to make this a little easier, i created a patch with the object embedded and already filled with data.</p>

<p>just take the patch live, once with append set to no once with append set to yes.</p>

<p><a class="attachment" href="../../uploads/default/original/2X/7/lpcwizardwithdata.axp">lpcwizardwithdata.axp</a> (12.6 KB)</p>

<p>and here is a version with the same data doubled. take this patch live (only once) and the data should be identical to the first version. however they are not. only the second one is ok. you can check this easily with a hex editor...</p>

<p><a class="attachment" href="../../uploads/default/original/2X/3/lpcwizardwithdatadoubled.axp">lpcwizardwithdatadoubled.axp</a> (20.6 KB)</p>

<p>since the data is written correctly with the second version, i think there is a bug with f_lseek on axoloti/chibios? this happens with two sdcards i have tried.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Append to file with f_lseek'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/lokki.html'><b itemprop='author'>lokki</b></a>
           
           <time datetime='2018-03-05T12:12:52Z' itemprop='datePublished'>
             2018-03-05 12:12:52 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>anyone? <a class="mention" href="../../u/johannes.html">@johannes</a> or <a class="mention" href="../../u/thetechnobear.html">@thetechnobear</a>? this is driving me insane...(and not in a good way)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Append to file with f_lseek'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2018-03-05T22:08:51Z' itemprop='datePublished'>
             2018-03-05 22:08:51 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I'm working on migrating the Axoloti firmware to Chibios 18.2.0, that will also upgrade the FatFS library to revision 0.13. It's just not ready for consumption yet...<br>I read your code, but did not spot issues, but I have not tried to reproduce or debug this issue yet.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Append to file with f_lseek'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/lokki.html'><b itemprop='author'>lokki</b></a>
           
           <time datetime='2018-03-05T22:11:18Z' itemprop='datePublished'>
             2018-03-05 22:11:18 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>ok, thanks! i hope the FA_OPEN_APPEND will work as intended once you update chibios. if you find the time to test my issue with the current firmware, that would be great.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Append to file with f_lseek'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/append-to-file-with-f-lseek/4303 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:05:56 GMT -->
</html>
