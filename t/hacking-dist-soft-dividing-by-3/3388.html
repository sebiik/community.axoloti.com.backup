<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/hacking-dist-soft-dividing-by-3/3388 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:22:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Hacking dist/soft (dividing by 3) - AxoObject coding - Axoloti Community</title>
    <meta name="description" content="I realise this is more of a general programming question to a certain extent but it&amp;#39;s related to the specifics of the processor and peculiarities of the Axoloti number range. I hope someone will humour me but please dele&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="3388.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://sebiik.github.io/community.axoloti.com.backup","potentialAction":{"@type":"SearchAction","target":"https://sebiik.github.io/community.axoloti.com.backup/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Hacking dist/soft (dividing by 3)&#39;" href="3388.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="https://sebiik.github.io/community.axoloti.com.backup/t/hacking-dist-soft-dividing-by-3/3388" />
<meta name="twitter:url" content="https://sebiik.github.io/community.axoloti.com.backup/t/hacking-dist-soft-dividing-by-3/3388" />
<meta property="og:title" content="Hacking dist/soft (dividing by 3)" />
<meta name="twitter:title" content="Hacking dist/soft (dividing by 3)" />
<meta property="og:description" content="I realise this is more of a general programming question to a certain extent but it&#39;s related to the specifics of the processor and peculiarities of the Axoloti number range. I hope someone will humour me but please delete this if it&#39;s considered to be off topic.   I&#39;m trying to make a &quot;no gain&quot; version of dist/soft for use in things like feedback loops. Using a graphing calculator I&#39;ve worked out that what I need is x-(x^3)/3, what I&#39;m actually wondering is if anyone knows a shortcut to working..." />
<meta name="twitter:description" content="I realise this is more of a general programming question to a certain extent but it&#39;s related to the specifics of the processor and peculiarities of the Axoloti number range. I hope someone will humour me but please delete this if it&#39;s considered to be off topic.   I&#39;m trying to make a &quot;no gain&quot; version of dist/soft for use in things like feedback loops. Using a graphing calculator I&#39;ve worked out that what I need is x-(x^3)/3, what I&#39;m actually wondering is if anyone knows a shortcut to working..." />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="3388.html">Hacking dist/soft (dividing by 3)</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/axoobject-code.html" itemprop="url">
        <span itemprop="title">AxoObject coding</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/SirPrimalform.html'><b itemprop='author'>SirPrimalform</b></a>
           
           <time datetime='2017-06-06T11:10:28Z' itemprop='datePublished'>
             2017-06-06 11:10:28 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I realise this is more of a general programming question to a certain extent but it's related to the specifics of the processor and peculiarities of the Axoloti number range. I hope someone will humour me but please delete this if it's considered to be off topic.</p>

<p>I'm trying to make a "no gain" version of dist/soft for use in things like feedback loops. Using a graphing calculator I've worked out that what I need is x-(x^3)/3, what I'm actually wondering is if anyone knows a shortcut to working out the /3 bit.</p>

<p>As I understand it, division is quite expensive, so avoiding directly dividing would be beneficial. One idea I had was to use init to store a number in a variable, that when used with ___SMMUL would be like multiplying by 0.33333. Is that the best approach or is there a better one? </p>

<p>So sort of a programming question, but hopefully not an annoying "teach me C++ pls" post.<br>Cheers,<br>SPF</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Hacking dist/soft (dividing by 3)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Sputnki.html'><b itemprop='author'>Sputnki</b></a>
           
           <time datetime='2017-06-06T11:35:24Z' itemprop='datePublished'>
             2017-06-06 11:35:24 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Division by a constant should not be too expensive. Alternatively you could multiply (with smmul) by (1/3)*2^27</p>

<p>Like this: ___SMMUL(x3 &lt;&lt;3, 44739243 &lt;&lt;2)</p>

<p>What you're trying to do however is exactly what dist soft does. I think it's sufficient to simply copy the code</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Hacking dist/soft (dividing by 3)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/SirPrimalform.html'><b itemprop='author'>SirPrimalform</b></a>
           
           <time datetime='2017-06-06T11:41:47Z' itemprop='datePublished'>
             2017-06-06 11:41:47 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Cool thanks, I'll give that a go. That's similar to what I was suggesting but using a precomputed "0.3333", I was going to try and calculate it in init. Would I gain a tiny bit of precision by calculating the coefficient 'pre-scaled' so that the bitshift isn't required in the ___SMMUL operation?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Hacking dist/soft (dividing by 3)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Sputnki.html'><b itemprop='author'>Sputnki</b></a>
           
           <time datetime='2017-06-06T12:03:21Z' itemprop='datePublished'>
             2017-06-06 12:03:21 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I guess you could put the whole &lt;&lt;5 bitshifting inside the constant and perform the operation in one take. It would surely be more precise (less truncation errors)and to some extent more efficient.<br>Even though both effects are quite negligible.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Hacking dist/soft (dividing by 3)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/SirPrimalform.html'><b itemprop='author'>SirPrimalform</b></a>
           
           <time datetime='2017-06-06T12:35:22Z' itemprop='datePublished'>
             2017-06-06 12:35:22 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>So I think the constant I want is 1431655765, ___SMMUL-ing that with a number should divide it by a third, no bitshifting required. Does that sound right? I used the binary mode in the windows calculator to divide 1&lt;&lt;32 by 3, effectively building the &lt;&lt;5 into it.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Hacking dist/soft (dividing by 3)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Sputnki.html'><b itemprop='author'>Sputnki</b></a>
           
           <time datetime='2017-06-06T12:41:31Z' itemprop='datePublished'>
             2017-06-06 12:41:31 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Sounds pretty reasonable to me. Try to smmul it and see if it smmuls correctly.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Hacking dist/soft (dividing by 3)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2017-06-10T05:47:03Z' itemprop='datePublished'>
             2017-06-10 05:47:03 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Sounds like a good approach to me too.</p>

<p>If you have an expression like</p>

<p>___SMMUL(x3 &lt;&lt;3, 44739243 &lt;&lt;2)</p>

<p>then the x3 &lt;&lt; 3 and 44739243 &lt;&lt; 2 are evaluated before __SMMUL is called, so it doesn't matter if you have those calculations in the function call or somewhere else. Computationally, the values will be calculated first, then __SMMUL will be called in either case. In that respect, calculating the actual value of the constant and putting it in an init section can be beneficial, because you can tweak the exact value to get exactly the gain you need, down to the last bit. </p>

<p>What I'm getting at is that since you are trying to get a zero gain function for feedback loops, you might want to tweak the exact value to compensate for other rounding errors so that you get a total gain of exactly one for the whole loop.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Hacking dist/soft (dividing by 3)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/SirPrimalform.html'><b itemprop='author'>SirPrimalform</b></a>
           
           <time datetime='2017-06-10T15:09:33Z' itemprop='datePublished'>
             2017-06-10 15:09:33 UTC
           </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Good suggestiong Ricard, thanks! I forgot to come back and say it worked as expected, but yes tweaking that constant may be helpful due to rounding errors.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Hacking dist/soft (dividing by 3)'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/hacking-dist-soft-dividing-by-3/3388 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:22:44 GMT -->
</html>
