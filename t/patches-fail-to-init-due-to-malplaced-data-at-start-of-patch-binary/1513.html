<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/patches-fail-to-init-due-to-malplaced-data-at-start-of-patch-binary/1513 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:15:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Patches fail to init due to malplaced data at start of patch binary - Helpdesk - Axoloti Community</title>
    <meta name="description" content="This thread: http://community.axoloti.com/t/maximum-patch-size/1483/12 started out as a question about the maximum size of a patch, but in the end I determined that there is bug in ramlink.ld, which puts a couple of arra&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="1513.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Patches fail to init due to malplaced data at start of patch binary&#39;" href="1513.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/patches-fail-to-init-due-to-malplaced-data-at-start-of-patch-binary/1513" />
<meta name="twitter:url" content="http://community.axoloti.com/t/patches-fail-to-init-due-to-malplaced-data-at-start-of-patch-binary/1513" />
<meta property="og:title" content="Patches fail to init due to malplaced data at start of patch binary" />
<meta name="twitter:title" content="Patches fail to init due to malplaced data at start of patch binary" />
<meta property="og:description" content="This thread: http://community.axoloti.com/t/maximum-patch-size/1483/12 started out as a question about the maximum size of a patch, but in the end I determined that there is bug in ramlink.ld, which puts a couple of arrays before the patch init function. The net result is that when the firmware calls PATCHMAINLOC to initialize the patch, the data in the arrays (pointers) are interpreted as code, which is then run before the actual init function, which can potentially wreck havoc with patch initi..." />
<meta name="twitter:description" content="This thread: http://community.axoloti.com/t/maximum-patch-size/1483/12 started out as a question about the maximum size of a patch, but in the end I determined that there is bug in ramlink.ld, which puts a couple of arrays before the patch init function. The net result is that when the firmware calls PATCHMAINLOC to initialize the patch, the data in the arrays (pointers) are interpreted as code, which is then run before the actual init function, which can potentially wreck havoc with patch initi..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="2 â¤" />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="1513.html">Patches fail to init due to malplaced data at start of patch binary</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/helpdesk.html" itemprop="url">
        <span itemprop="title">Helpdesk</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2016-04-16T21:05:18Z' itemprop='datePublished'>
             2016-04-16 21:05:18 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This thread: <a href="../maximum-patch-size/1483/12.html">http://community.axoloti.com/t/maximum-patch-size/1483/12</a> started out as a question about the maximum size of a patch, but in the end I determined that there is bug in ramlink.ld, which puts a couple of arrays before the patch init function. The net result is that when the firmware calls PATCHMAINLOC to initialize the patch, the data in the arrays (pointers) are interpreted as code, which is then run before the actual init function, which can potentially wreck havoc with patch initialization.</p>

<p>Problems I've seen include:</p>

<ul>
<li>Axoloti Core crashes and/or restarts</li>
<li>Patch performs init properly but refuses to run</li>
</ul>

<p>The fix is simple, simply put the arrays in question after the text segment in the patch binary, so that PATCHMAINLOC is actually the start of the patch init function.</p>

<p>I've got a patch ready in my github repository (https://github.com/polluxsynth/axoloti/tree/fix-patch-init) which I've tested with complete success in my own setup. <a class="mention" href="../../users/johannes.html">@johannes</a>, let me know if you want me to rework it, or raise an issue in the Axoloti github repository, etc.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Patches fail to init due to malplaced data at start of patch binary'>
      <hr>
            <a href="../maximum-patch-size/1483/26.html">Maximum patch size?</a>
            <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2016-04-16T21:15:22Z' itemprop='datePublished'>
             2016-04-16 21:15:22 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>you can issue a pull request, which <a class="mention" href="../../users/johannes.html">@johannes</a> can then accept</p>

<p>as per other thread, it might be worth (as well as moving ctor/dtor, who's position is arbitrary) , adding a </p>

<pre><code>    PROVIDE(__code_start = .);</code></pre>

<p>and then the patch start can be derived from that... rather than hardcode the start address.<br>(I think this will work,  however, Ive not tried it)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Patches fail to init due to malplaced data at start of patch binary'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2016-04-16T21:49:15Z' itemprop='datePublished'>
             2016-04-16 21:49:15 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="2" data-topic="1513" data-full="true"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/thetechnobear/40/6_1.html" class="avatar">thetechnobear:</div>
<blockquote><p>you can issue a pull request, which <a class="mention" href="../../users/johannes.html">@johannes</a> can then accept</p></blockquote></aside>

<p>Yeah, I thought of just doing that, but then I read the patch submission guidelines and it mentioned bringing up the corresponding issue here and subsequently as an issue in the github patch tracking system, so I thought I'd go that way unless <a class="mention" href="../../users/johannes.html">@johannes</a> is fine with skipping some parts of the process in this case.</p>

<p>I've commented on the other stuff in the original thread.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='Patches fail to init due to malplaced data at start of patch binary'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2016-04-17T06:59:18Z' itemprop='datePublished'>
             2016-04-17 06:59:18 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="3" data-topic="1513"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/ricard/40/163_1.html" class="avatar">ricard:</div>
<blockquote><p>ah, I thought of just doing that, but then I read the patch submission guidelines and it mentioned bringing up the corresponding issue here and subsequently as an issue in the github patch tracking system,</p></blockquote></aside>

<p>I wrote that <img src="../../images/emoji/emoji_one/winka4f0.png?v=0" title=":wink:" class="emoji" alt=":wink:"> <br>I suspect <a class="mention" href="../../users/johannes.html">@johannes</a> has already read this, so is aware of the issue,so a bit redundant.</p>

<p>but if you want to be fully correct, raise an issue on the github issue, and you can then just link to the post here. then raise a pull request, and cross reference the issues  (you can check in with a fix/closes #issue number) </p>

<p>reality is, on one here raises github issues, so its never a complete list... and I don't have time, to raise an issue for every bug mentioned on here, then fix, then close it. so the github issues tends to be used for things we know about, but are not fixing now.</p>

<p>alternatively, I can always add the change to the PR, I already have open....</p>

<p>(I think <a class="mention" href="../../users/johannes.html">@johannes</a> is probably away/busy, as unusually, he has not merged my latest PR yet)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Patches fail to init due to malplaced data at start of patch binary'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2016-04-17T11:25:02Z' itemprop='datePublished'>
             2016-04-17 11:25:02 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="4" data-topic="1513" data-full="true"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/thetechnobear/40/6_1.html" class="avatar">thetechnobear:</div>
<blockquote>
<aside class="quote" data-post="3" data-topic="1513"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/ricard/40/163_1.html" class="avatar">ricard:</div>
<blockquote><p>ah, I thought of just doing that, but then I read the patch submission guidelines and it mentioned bringing up the corresponding issue here and subsequently as an issue in the github patch tracking system,</p></blockquote></aside><p>I wrote that <img src="../../images/emoji/emoji_one/winka4f0.png?v=0" title=":wink:" class="emoji" alt=":wink:"> </p>
</blockquote></aside>

<p>Ah. <img src="../../images/emoji/emoji_one/smilea4f0.png?v=0" title=":smile:" class="emoji" alt=":smile:"> </p>

<p><aside class="quote"><blockquote><p>reality is, on one here raises github issues, so its never a complete list... and I don't have time, to raise an issue for every bug mentioned on here, then fix, then close it. so the github issues tends to be used for things we know about, but are not fixing now.<br>[ ... ]<br>(I think <a class="mention" href="../../users/johannes.html">@johannes</a> is probably away/busy, as unusually, he has not merged my latest PR yet)</p></blockquote></aside></p>

<p>Ok, I submitted a pull request, which was apparently merged within five minutes, so either <a class="mention" href="../../users/johannes.html">@johannes</a> is back, or there is some form of automatic merge functionality (but then why would your PR not have been merged).</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Patches fail to init due to malplaced data at start of patch binary'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-04-17T14:08:10Z' itemprop='datePublished'>
             2016-04-17 14:08:10 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks for the detailed diagnosis and the pull request with a fix!<br>I was away, merging pull requests is done manually.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Patches fail to init due to malplaced data at start of patch binary'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2016-04-18T04:30:04Z' itemprop='datePublished'>
             2016-04-18 04:30:04 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Ok. Thanks <a class="mention" href="../../users/johannes.html">@johannes</a>!</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Patches fail to init due to malplaced data at start of patch binary'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/patches-fail-to-init-due-to-malplaced-data-at-start-of-patch-binary/1513 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:15:04 GMT -->
</html>
