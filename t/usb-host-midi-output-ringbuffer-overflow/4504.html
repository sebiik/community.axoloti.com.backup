<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/usb-host-midi-output-ringbuffer-overflow/4504 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:03:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Usb host midi output ringbuffer overflow? - AxoObject coding - Axoloti Community</title>
    <meta name="description" content="Hello :=) 

I am trying to make Axoloti talk to a Launchpad mini MkII and I am experiencing an error with blue text, which as far as I know is related to the connected USB device.  

The error: usb host midi output ringb&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="4504.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Usb host midi output ringbuffer overflow?&#39;" href="4504.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/usb-host-midi-output-ringbuffer-overflow/4504" />
<meta name="twitter:url" content="http://community.axoloti.com/t/usb-host-midi-output-ringbuffer-overflow/4504" />
<meta property="og:title" content="Usb host midi output ringbuffer overflow?" />
<meta name="twitter:title" content="Usb host midi output ringbuffer overflow?" />
<meta property="og:description" content="Hello :=)   I am trying to make Axoloti talk to a Launchpad mini MkII and I am experiencing an error with blue text, which as far as I know is related to the connected USB device.    The error: usb host midi output ringbuffer overflow   ..... Which just keeps repeating the message in the log until I disconnect and reconnect the Launchpad. then it works for a few minuts and I get the same error again.   The data I am sending from Axoloti to Launch and back is data for the LED&#39;s. I do send quite a..." />
<meta name="twitter:description" content="Hello :=)   I am trying to make Axoloti talk to a Launchpad mini MkII and I am experiencing an error with blue text, which as far as I know is related to the connected USB device.    The error: usb host midi output ringbuffer overflow   ..... Which just keeps repeating the message in the log until I disconnect and reconnect the Launchpad. then it works for a few minuts and I get the same error again.   The data I am sending from Axoloti to Launch and back is data for the LED&#39;s. I do send quite a..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="3 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="3 ❤" />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="4504.html">Usb host midi output ringbuffer overflow?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/axoobject-code.html" itemprop="url">
        <span itemprop="title">AxoObject coding</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2018-04-28T09:24:30Z' itemprop='datePublished'>
             2018-04-28 09:24:30 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hello :=)</p>

<p>I am trying to make Axoloti talk to a Launchpad mini MkII and I am experiencing an error with blue text, which as far as I know is related to the connected USB device. </p>

<p>The error:<br>usb host midi output ringbuffer overflow</p>

<p>..... Which just keeps repeating the message in the log until I disconnect and reconnect the Launchpad. then it works for a few minuts and I get the same error again.</p>

<p>The data I am sending from Axoloti to Launch and back is data for the LED's. I do send quite a lot of data, since there are 64 pads that needs to be updated on the Launchpad. </p>

<p>My solution has been for now to use a counter which counts at k-rate, updates the LED's 3000 times a second. I am not that technical, so I am not sure if my expectations are to high here? Could it be because the LED update at krate is too fast, that I get the error?</p>

<p>I did a bit of research on the topic in the forum, and the only place I found it mentioned was<br>in  <a class="mention" href="../../u/thetechnobear.html">@thetechnobear</a>'s comment here:</p>

<aside class="quote" data-topic="625" data-slug="linnstrument-axoloti-first-tests" data-post="25"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/thetechnobear/40/6_1.html" class="avatar"><a href="../linnstrument-axoloti-first-tests/625/25.html" rel="nofollow noopener">Linnstrument + Axoloti first tests</a>
</div>
<blockquote><p>ok, so I tested with my Eigenharp... and no issues, even when I started sending all data as 14 bit , no decimation. (thats a lot of data, in fact, I had to send 6 parameters per note, without decimation, to start seeing ring buffer overflows )   BUT.... I realised my test was flawed  ...   the issue, in the above test, is Im not receiving data on the usb host port <img src="../../images/emoji/twitter/frowningae52.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"> on both axoloti 1 &amp; 2, I was receiving the data on the device port, and only writing to the host port.  (ok, it succeede…</p></blockquote></aside>

<p>Technobear mention decimation in that thread, as a mean to prevent the ringbuffer overflowing. Are there any examples of this in the community library?</p>

<p><a class="mention" href="../../u/johannes.html">@johannes</a>, do you have a suggestion to what I can do to work around this issue?</p>

<p>The patch is pretty complicated, so if someone wants an example, I can probably wrap up a simple version for testing. Let me know if you need it.</p>

<p>Oh, btw, the LaunchPad Mini MkII is connecte over to the USB host port of Axoloti. I have also tried sending the data over the device port, but this results in Axoloti disconneting randomly, which is worse than the Launchpad disconneting, imo.</p>

<p>Thanks and have a great day <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2018-04-28T09:58:06Z' itemprop='datePublished'>
             2018-04-28 09:58:06 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Ahh found this too:<br><aside class="quote" data-post="1" data-topic="3397">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/dazzlingduke/40/985_1.png" class="avatar">
    <a href="../usb-overflow-using-novation-launchkey-mini-mk2/3397a94c.html?source_topic_id=4504" rel="nofollow noopener">USB Overflow using Novation Launchkey Mini MK2</a> <a class="badge-wrapper  bullet" href="../../c/hardware.html"><span class="badge-category-bg" style="background-color: #AB9364;"></span><span style="color: #FFFFFF;" class="badge-category clear-badge" title="This category is intended for discussion about the Axoloti hardware and connecting to other hardware, including , connecting midi controllers and other hardware, related hardware projects.">Hardware</span></a>
  </div>
  <blockquote>
    I'm having an issue connecting a Novation Launchkey Mini MK2 to the Axoloti core on a Windows 10 Surface Book using Axoloti build version 1.0.12-0. 

When using the knobs faster than a slow speed, I "crash" the patch. No more midi messages will be interpreted until the controller is power cycled by removing the USB cable between the Axoloti and the MK2. I've tried two different Axoloti core boards, I've cycled through 5 different USB cables that I've used on development projects and am relativel…
  </blockquote>
</aside>
</p>

<p>Argh....... I really hope this can be fixed somehow. I have been putting all my time into this project over the last week and I am really happy about it, but its basically not worth much if I cant fix this issue.</p>

<p><a class="mention" href="../../u/beat.html">@beat</a><br>I have been looking a bit into your launch mini sequencer too and it seems like I am not getting the error when using your sequencer. What did you do to fix this cause I can se you also had the same issue at some point?</p>

<p>Edit: ohh.. it just happened with <span class="mention">@beats</span> version too, now. After the sequencers have been running for 5 minuts it suddenly froze. No ringbuffer error, just a freeze.... argh...</p>

<p>Thanks!</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2018-04-28T10:18:58Z' itemprop='datePublished'>
             2018-04-28 10:18:58 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>its a simple fix, you have to throttle the data<br>i.e. send some of the data, wait a while , send some more</p>

<p>also, the api, has a call which tells you how much space is left on the queue, you should not be sending data when it says its full .. actually id back off a bit, before that to give some headroom. </p>

<p>the reason is simple... midi data is not sent in the audio thread (for obvious reasons), therefore it has to be stored/queued - this takes memory (aka ring buffer), which has to be 'finite' , we could allow more , but then you'd have less space for your patch <img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"> </p>

<p>(the amount i chose was a compromise, for large messages and midi 'bursts', and the fact that in 'normal' operation there usually is only one or two messages 'in flight')</p>

<p>in my experience (when i did this for the Push1) the issue is, when you want to initialise a grids leds, you send a load of messages in one go... way more than you would in normal midi use.</p>

<p>as i say, the easy solution is send at a rate where the queue does not build up too fast, <br>don't worry, this is fast enough, that  in practice, as a user of the grid, you won't even see this.</p>

<p>for the push 1 , i had to not only initialise all pads, but buttons and the LCD, and even though i throttled the data, it still 'appeared' to be instantaneously initialised.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2018-04-28T10:27:36Z' itemprop='datePublished'>
             2018-04-28 10:27:36 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="1" data-topic="4504"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/jaffasplaffa/40/5808_1.png" class="avatar">jaffasplaffa:</div>
<blockquote><p>My solution has been for now to use a counter which counts at k-rate, updates the LED's 3000 times a second. I am not that technical, so I am not sure if my expectations are to high here? Could it be because the LED update at krate is too fast, that I get the error?</p></blockquote></aside>

<p>if your saying, your sending a whole bunch of midi messages every k-rate cycle, then yes thats unrealistic. <br>probably (unfortunately) a too  simplistic solution.<br>im sure i do something rather similar in my push code, and in that i only have to send messages out when the user does something, and then i try to minimise them.</p>

<p>(generally, even if this did work... to get best performance, you really want to keep IO to a minimum , this is even true on desktops!)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2018-04-28T11:48:07Z' itemprop='datePublished'>
             2018-04-28 11:48:07 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="3" data-topic="4504"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/thetechnobear/40/6_1.html" class="avatar">thetechnobear:</div>
<blockquote><p>its a simple fix, you have to throttle the data<br>i.e. send some of the data, wait a while , send some more</p></blockquote></aside>

<p>Cool, I will look into this <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> </p>

<aside class="quote" data-post="4" data-topic="4504"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/thetechnobear/40/6_1.html" class="avatar">thetechnobear:</div>
<blockquote><p>if your saying, your sending a whole bunch of midi messages every k-rate cycle, then yes thats unrealistic. <br>probably (unfortunately) a too  simplistic solution.</p></blockquote></aside>

<p>Yeah I had a feeling that might be the issue. I based my solution on what <a class="mention" href="../../u/blindsmyth-2.html">@Blindsmyth</a> did here, using a square lfo to update the Launchpad. But that didnt update it fast enough, so I tried with a krate counter, which was probably a bit over the top <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> But it looked damn good, all LED's looks steady <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> </p>

<p>Blindsmyth solution with the square lfo:<br><aside class="quote" data-topic="1309" data-slug="launchpad-s-bidirectional-communication-with-axoloti" data-post="10"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v2/letter/b/2acd7d/40.png" class="avatar"><a href="../launchpad-s-bidirectional-communication-with-axoloti/1309/10.html" rel="nofollow noopener">Launchpad S – bidirectional communication with axoloti</a>
</div>
<blockquote><p><a class="mention" href="../../users/anorchidtexture.html"></a><a class="mention" href="../../u/anorchidtexture.html">@anorchidtexture</a> <a class="mention" href="../../users/mcpepe.html"></a><a class="mention" href="../../u/mcpepe.html">@mcpepe</a> No LP1 is not class compliant. Launchpad S and Mini (Mk1 and Mk2) are however so they will work, with 1.0.9. also work with full LED feedback.  <a class="mention" href="../../users/thetechnobear.html"></a><a class="mention" href="../../u/thetechnobear.html">@thetechnobear</a> Thanks for your suggestion, I've looked into your patch but don't really get how it works. You use the index of table  for the different values, like note, velocity etc. Where do you store where the value is in time? My first intuitive aproach was using the index of the table for time, or like wich step.  Since I…</p></blockquote></aside></p>

<p>So ill first try and slow the update rate down a bit, maybe simply just try with a square lfo again.</p>

<p>Thanks <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2018-04-28T12:13:10Z' itemprop='datePublished'>
             2018-04-28 12:13:10 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Yay, I think slowing it down helped here. It froze one time, then I lowered the speed a little bit more and it has gone several minuts now without freezing now <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2018-04-28T12:14:33Z' itemprop='datePublished'>
             2018-04-28 12:14:33 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="5" data-topic="4504"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/jaffasplaffa/40/5808_1.png" class="avatar">jaffasplaffa:</div>
<blockquote><p>But that didnt update it fast enough, so I tried with a krate counter, which was probably a bit over the top <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> But it looked damn good, all LED's looks steady <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p></blockquote></aside>

<p>this statement confuses me ...<br>surely the LP does not need constant midi messages to keep the pad on... thats seems extremely unlikely.<br>i.e. you should just set the pad colour (with a cc/note ?) and then its stays like that till, you tell it otherwise (or turn it off <img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:">)<br>so there should be no flicker at any update rate.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2018-04-28T12:21:24Z' itemprop='datePublished'>
             2018-04-28 12:21:24 UTC
           </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>btw, just had a quick look at the manual<br><a href="https://github.com/Granjow/launchpad-mini/blob/master/doc/launchpad-programmers-reference.pdf" class="onebox" target="_blank">https://github.com/Granjow/launchpad-mini/blob/master/doc/launchpad-programmers-reference.pdf</a></p>

<p>last paragraph of first page is important, and probably the source of the issues you've seen</p>

<p><div class="lightbox-wrapper"><a data-download-href="//community.axoloti.com/uploads/default/65bfc410513908e8b8cbb528188d34434e2854c5" href="../../uploads/default/original/2X/6/65bfc410513908e8b8cbb528188d34434e2854c5.jpg" class="lightbox" title="Screen Shot 2018-04-28 at 14.20.19.jpg"><img src="../../uploads/default/optimized/2X/6/65bfc410513908e8b8cbb528188d34434e2854c5_1_690x272.jpg" width="690" height="272"><div class="meta">
<span class="filename">Screen Shot 2018-04-28 at 14.20.19.jpg</span><span class="informations">737x291 89 KB</span><span class="expand"></span>
</div></a></div></p>

<p>so these features should be used to help keep the message count down, due to its low usb speeds.<br>(note: I dont have a LP , so this is just from a quick look at the manual)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2018-04-28T12:40:57Z' itemprop='datePublished'>
             2018-04-28 12:40:57 UTC
           </time>
        </span>
        <span itemprop='position'>#9</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="7" data-topic="4504"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/thetechnobear/40/6_1.html" class="avatar">thetechnobear:</div>
<blockquote><p>this statement confuses me ...<br>surely the LP does not need constant midi messages to keep the pad on... thats seems extremely unlikely.</p></blockquote></aside>

<p>I tried several approaches. The first one I tried I had to use a midi out object for each pad and that worked as you say, I just send a single note to the midi out and it turn on the pad...  </p>

<p>But problem was with this I could not get it to work with just a single midi/note/out object, I had to use one for each pad and there are 64 of them.</p>

<p>So instead of of using 64 midi/note/out objects, I use ONE single midi/note/out object and then I use the counter we talked about to scan through the pads 0-64 at a reasonable high rate.... and update them all with only one midi/out/note. That seemed the most efficient.</p>

<p>But yeah, this is based on my humble programming skills. I am sure someone else could come up with a much smater solution, like the one you suggest form the manual</p>

<p>But I see the notes from the manual. I dont fully understand how to do that, but Ill look into it. Seems like there might be an even simpler way there ,that have even less chance of overloading.</p>

<p>But for now lowering the speed have helped <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>

<p>Thanks again!</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/beat.html'><b itemprop='author'>beat</b></a>
           
           <time datetime='2018-04-28T14:02:17Z' itemprop='datePublished'>
             2018-04-28 14:02:17 UTC
           </time>
        </span>
        <span itemprop='position'>#10</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi jaffasplaffa,<br>it took me a long time to finally find a good solution working with the pixel matrix of the Launchpad.</p>

<p>I wrote a simple class representing the pixel-information of the launchpad and provides simple methods to set single pixels.</p>

<p>Here is the code:</p>

<pre><code>class LP {
private:
int8_t pixel [80];
int8_t buffer [80];
bool change [80];

int8_t ptr = 0;
int counter = 0;

void next () {ptr = (ptr+1)%80;}
bool hasChanged (int8_t p) {
	if (change[ptr]){
		change[ptr] = false;
		return true;
	}
	return false;
}

public:
LP () {
	for (int i=0; i&lt;80; i++) {
		pixel[i] = Off;
	}
}

void kRate () {
	if (MidiGetOutputBufferPending(MIDI_DEVICE_USB_HOST)&gt;0) return;

	swap();

	for (int8_t c=0; c&lt;80; c++) {
		next();
		if (hasChanged(ptr)) {
			if (ptr&lt;64) MidiSend3(MIDI_DEVICE_USB_HOST,0,MIDI_NOTE_ON, posToLp[ptr],pixel[ptr]);
			else if (ptr&lt;72) MidiSend3(MIDI_DEVICE_USB_HOST,0,MIDI_CONTROL_CHANGE, posToLp[ptr],pixel[ptr]);
			else if (ptr&lt;80) MidiSend3(MIDI_DEVICE_USB_HOST,0,MIDI_NOTE_ON, posToLp[ptr],pixel[ptr]);
			return;
		}
	}
}

void set (int8_t pos, int8_t color) {
	if (pos&lt;0 || pos&gt;79) return;
	buffer[pos] = color;
}

void swap () {
	for (int p=0; p&lt;80; p++) {
		if (buffer[p]!=pixel[p]) {
			pixel[p] = buffer[p];
			change[p] = true;
		}
	}
}

void clear (int8_t start, int8_t area) {
	for (int8_t p = start; p&lt;start+area; p++) set(p,Off);
}

void clear (int8_t start, int8_t area, bool c) {
	for (int8_t p = start; p&lt;start+area; p++) {
		set(p,Off);
		change[p] = c;
	}
}

static bool isSide (int8_t p) {return (p&gt;=72 &amp;&amp; p&lt;80);}
static bool isTop (int8_t p) {return (p&gt;=64 &amp;&amp; p&lt;72);}
static bool isMatrix (int8_t p) {return (p&gt;=0 &amp;&amp; p&lt;64);}
static bool isTopHalf (int8_t p) {return (p&gt;=0 &amp;&amp; p&lt;32);}
static bool isBottomHalf (int8_t p) {return (p&gt;=32 &amp;&amp; p&lt;64);}
};</code></pre>

<p>Just use copy the code to "Local Data" of your object, create an instance of it and call the "kRate()" method in kRate.</p>

<p>The class just updates changed pixels. To set a pixel just use "set()", where the first argument is the position (matrix: 0-63, top: 64-71, side: 72-79) and the second is the MIDI-color value used by the launchpad.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2018-04-28T14:53:27Z' itemprop='datePublished'>
             2018-04-28 14:53:27 UTC
           </time>
        </span>
        <span itemprop='position'>#11</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hey <a class="mention" href="../../u/beat.html">@beat</a> <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> </p>

<p>Thank you, I'll read it over a few times and give it a go <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
            <a href="../launchcontrol-xl-led-feedback/1360/38.html">Launchcontrol XL Led Feedback</a>
            <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Blindsmyth.html'><b itemprop='author'>Blindsmyth</b></a>
           
           <time datetime='2018-04-28T18:08:41Z' itemprop='datePublished'>
             2018-04-28 18:08:41 UTC
           </time>
        </span>
        <span itemprop='position'>#12</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>He there for LED feedback I have made really good experience storing the state of the leds into tables and sending to the conroller via <a class="mention" href="../../u/rbrt.html">@rbrt</a>'s objects. "vel send" I think. He has a bunch of objects that do this quite nicely. <br>I did this for the launchcontrols, so in case of the XL that is 24buttons / messages though.</p>

<p>Good luck with finding a solution!</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/ivofx.html'><b itemprop='author'>ivofx</b></a>
           
           <time datetime='2020-07-17T14:18:27Z' itemprop='datePublished'>
             2020-07-17 14:18:27 UTC
           </time>
        </span>
        <span itemprop='position'>#13</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I just came across this issue and I found that you can also use <strong>chThdSleepMilliseconds</strong>.<br>Probably not a great solution, changing only the needed LEDs is certainly a good idea. But if you need to change all at once, this is probably the easiest. However I guess it might cause audio dropouts.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Usb host midi output ringbuffer overflow?'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/usb-host-midi-output-ringbuffer-overflow/4504 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:03:36 GMT -->
</html>
