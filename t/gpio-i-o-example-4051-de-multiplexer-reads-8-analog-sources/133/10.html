<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/gpio-i-o-example-4051-de-multiplexer-reads-8-analog-sources/133/10 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:12:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources - Patching - Axoloti Community</title>
    <meta name="description" content="Hi everyone, 

here is a short example for a 4051 de/multiplexer. The 4051 can be used for extra 8 analog outputs or inputs. The Y0-7 pins are choosen by HIGH/LOW state of the S0-2 pins. It&amp;#39;s not the fastest way to expan&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="../133.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://sebiik.github.io/community.axoloti.com.backup","potentialAction":{"@type":"SearchAction","target":"https://sebiik.github.io/community.axoloti.com.backup/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources&#39;" href="../133.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://sebiik.github.io/community.axoloti.com.backup/user_avatar/community.axoloti.com/paul/200/53_1.png" />
<meta property="og:image" content="https://sebiik.github.io/community.axoloti.com.backup/user_avatar/community.axoloti.com/paul/200/53_1.png" />
<meta property="og:url" content="https://sebiik.github.io/community.axoloti.com.backup/t/gpio-i-o-example-4051-de-multiplexer-reads-8-analog-sources/133/10" />
<meta name="twitter:url" content="https://sebiik.github.io/community.axoloti.com.backup/t/gpio-i-o-example-4051-de-multiplexer-reads-8-analog-sources/133/10" />
<meta property="og:title" content="[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources" />
<meta name="twitter:title" content="[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources" />
<meta property="og:description" content="if you can&#39;t get the script working, you can try to trigger the single s0…2 pins by manual patch. It&#39;s maybe not the faster solution but it should work.    you can use MartijnVerhallen clock divider patch and connect the decoding outputs to single digital out objects. clock divider" />
<meta name="twitter:description" content="if you can&#39;t get the script working, you can try to trigger the single s0…2 pins by manual patch. It&#39;s maybe not the faster solution but it should work.    you can use MartijnVerhallen clock divider patch and connect the decoding outputs to single digital out objects. clock divider" />

      <link rel="next" href="../1334658.html?page=2">

  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html"><img src="../../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="../133.html">[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../../c/patching.html" itemprop="url">
        <span itemprop="title">Patching</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/kaos.html'><b itemprop='author'>kaos</b></a>
           
           <time datetime='2015-08-12T20:10:02Z' itemprop='datePublished'>
             2015-08-12 20:10:02 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../../users/paul.html">@paul</a> right sorry. Using a slightly different datasheet. I'm converting my controller from a teensy to Axoloti. I was using this earlier <a href="https://www.pjrc.com/teensy/td_midi.html" rel="nofollow">https://www.pjrc.com/teensy/td_midi.html</a></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/paul.html'><b itemprop='author'>paul</b></a>
           
           <time datetime='2015-08-12T20:16:03Z' itemprop='datePublished'>
             2015-08-12 20:16:03 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>no, I should explain and show it more clearly. Your request improved my explanation. So it's more clearly for others. By the way, the axoloti offers many analog in pins which can be read faster then using a 4051. </p>

<p>The next days, I will add a description for a MCP3208 SPI ADC. At the moment it's working fine with axoloti but the code in the script object has to be optimize.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/kaos.html'><b itemprop='author'>kaos</b></a>
           
           <time datetime='2015-08-12T20:56:36Z' itemprop='datePublished'>
             2015-08-12 20:56:36 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>ok, I soldered everything, but I cannot get it to compile on my previous axoloti (V0.3) It compiles fine on the new one that shipped with kickstarter, unfortunately that one hasn't got 15 pots soldered to it...<br>probably this is not going to be fixed I guess...(as no one else has this board)</p>

<pre><code>../chibios/boards/ST_STM32F4_DISCOVERY -I../chibios/ext/fatfs/src -I../firmware -MD -MP -c xpatch.cpp -o xpatch.o
xpatch.cpp: In member function 'msg_t rootc::instancescript__1::ThreadX2()':
xpatch.cpp:67:17: error: a function-definition is not allowed here before '{' token
 void setup(void){
                 ^
xpatch.cpp:75:16: error: a function-definition is not allowed here before '{' token
 void loop(void){
                ^
xpatch.cpp:102:1: error: expected '}' at end of input
 }
 ^
make: *** [all] Error 1
shell task failed, exit value: 2</code></pre>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/paul.html'><b itemprop='author'>paul</b></a>
           
           <time datetime='2015-08-12T21:09:31Z' itemprop='datePublished'>
             2015-08-12 21:09:31 UTC
           </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>strange. I can't say any about previous board. My STM32 disco board don't work with latest axoloti software. If I want to use the STM32 I have to compline manually the axoloti ver. 1.0 and run it by entering ./axoloti.sh on terminal (mac user). Do your V3 board works normal with other patches?</p>

<p>I checked the 4051 and uploaded it to my stm32 a few minutes ago.</p>

<p>edit: Do you have update the FW of your V3 board? Maybe Johannes can say more about this error.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/kaos.html'><b itemprop='author'>kaos</b></a>
           
           <time datetime='2015-08-12T21:32:59Z' itemprop='datePublished'>
             2015-08-12 21:32:59 UTC
           </time>
        </span>
        <span itemprop='position'>#9</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>the board works with at least some of the demo patches, it's missing USB host and has way less RAM to play with... not a problem for this...<br>now focussing on recompiling the whole thing from source, seems to work, but I have errors in the firmware compilation now. I'll ping Johannes</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/paul.html'><b itemprop='author'>paul</b></a>
           
           <time datetime='2015-08-12T21:48:12Z' itemprop='datePublished'>
             2015-08-12 21:48:12 UTC
           </time>
        </span>
        <span itemprop='position'>#10</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>if you can't get the script working, you can try to trigger the single s0…2 pins by manual patch. It's maybe not the faster solution but it should work. </p>

<p>you can use MartijnVerhallen clock divider patch and connect the decoding outputs to single digital out objects.<br><a href="../../clock-diver-patch-with-rotate-function/170.html">clock divider</a></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/kaos.html'><b itemprop='author'>kaos</b></a>
           
           <time datetime='2015-08-13T07:53:34Z' itemprop='datePublished'>
             2015-08-13 07:53:34 UTC
           </time>
        </span>
        <span itemprop='position'>#11</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>got it working!</p>

<p>very smooth, a bit of jitter though is that why I should "decouple." can you describe how decoupling works?</p>

<p>this is what it looks like, I hope to add the adafruit trellis modules next<br><a href="https://twitter.com/kaosbeat/status/631734735463665664" rel="nofollow"><img src="../../../uploads/default/original/1X/120ab11c71ddb73a43d6832daabe5cc4a11c61e1.jpg" alt="" width="375" height="500"></a></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:3'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/MartijnVerhallen.html'><b itemprop='author'>MartijnVerhallen</b></a>
           
           <time datetime='2015-08-13T08:55:23Z' itemprop='datePublished'>
             2015-08-13 08:55:23 UTC
           </time>
        </span>
        <span itemprop='position'>#12</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>wow! nice looking panel!!!</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/paul.html'><b itemprop='author'>paul</b></a>
           
           <time datetime='2015-08-13T09:40:17Z' itemprop='datePublished'>
             2015-08-13 09:40:17 UTC
           </time>
        </span>
        <span itemprop='position'>#13</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>nice to hear and your panel design looks sweet. </p>

<p>I never studied electrical engineering, so my answer is roughly. a cpacitor needs some time to get its voltage field loaded. The time it's needed to get loaded depends on the voltage, which is feeding to the capacitor  and the capacity of your capacitor. <br>this pic make it more clear (red line is the input voltage; black voltage of capacitor)<br><a href="https://de.wikipedia.org/wiki/Kondensator_(Elektrotechnik)#/media/File:Ladevorgang.svg" rel="nofollow">wikipedia</a> </p>

<p>Together with a potentiometer a capacitor is working as a variable low pass filter. </p>

<p>Shortly, a capacitor nearby the analog input of your 4051 will stabilize the voltage and filters fast voltage drops but capacitor makes it also a bit sluggish. </p>

<p>by the way, the trellis module uses an I2C communication. Can you share your code, if you get it working? Check axoloti archiv dir for a I2C example from johannes.<br>  </p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/kaos.html'><b itemprop='author'>kaos</b></a>
           
           <time datetime='2015-08-14T07:45:31Z' itemprop='datePublished'>
             2015-08-14 07:45:31 UTC
           </time>
        </span>
        <span itemprop='position'>#14</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../../users/paul.html">@paul</a>, <a class="mention" href="../../../users/martijnverhallen.html">@MartijnVerhallen</a>, The panel was stripped from an analog color picture developing machine.</p>

<p><a class="mention" href="../../../users/paul.html">@paul</a>, on the decoupling, I know what a capacitor is and how it works, but  for the sake of clarity is this how it should work?<br><img src="../../../uploads/default/original/1X/4ed9734ef36bd515f47851224c67c2b88a84e409.png" width="220" height="337"> <br>I'll report back on the trellis ASAP</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/paul.html'><b itemprop='author'>paul</b></a>
           
           <time datetime='2015-08-14T08:35:12Z' itemprop='datePublished'>
             2015-08-14 08:35:12 UTC
           </time>
        </span>
        <span itemprop='position'>#15</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../../users/kaos.html">@kaos</a> oh sorry, I misapprehend you. Capacitor should stabilize the input signal. <br>Your circuit seems right, but the other leg of capacitor should be connected to GND not VDD. </p>

<p>How big is the jittering? When I tested my 4051s, there was only a small jittering +/- 0.50. One thing you can try would be, to set a longer delay to select the a channel. It's "chThdSleepMilliseconds(1);" line at the end of the script. By using a higher delay rate (= longer channel selection) with less jittering as before, the jittering would be a problem of the script and not a hardware issue.<br>If a small resoldering is not a huge mess, you can try a mcp3208 adc. With this IC, don't get any jitters. <br>here is a pinout picture: <a href="../../../../os.mbed.com/media/uploads/silbo/x_scaled_mcp3208.png.pagespeed.ic.t0WtkGjVuS.html" rel="nofollow">MCP3208</a></p>

<p>This is my actually working code for the mcp: <a href="http://pastebin.com/F37GZMjw" rel="nofollow">script</a></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/kaos.html'><b itemprop='author'>kaos</b></a>
           
           <time datetime='2015-08-14T09:05:20Z' itemprop='datePublished'>
             2015-08-14 09:05:20 UTC
           </time>
        </span>
        <span itemprop='position'>#16</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>tried 1 ms delay and 50 ms delay. Actually it's quite ok at 5ms  i have way less than +/- 0.5 it's more something like  +/- 0.1. </p>

<p>About resoldering, huge mess I  think <img src="../../../images/emoji/emoji_one/smilea4f0.png?v=0" title=":smile:" class="emoji" alt="smile"> actually I would have to resolder 4 4051s, so no. About the 4 though, I cannot see anywhere in the script where you asign the "z" connection to axo.</p>

<pre><code>int z = adcvalues[8]&lt;&lt;15;</code></pre>

<p>I want to make it </p>

<pre><code>int z1 = adcvalues[8]&lt;&lt;15;	
int z2 = adcvalues[8]&lt;&lt;15;	
int z3 = adcvalues[8]&lt;&lt;15;	
int z4 = adcvalues[8]&lt;&lt;15;</code></pre>

<p>to read out 32 values</p>

<p>is adcvalues an array of GPIOs on axo? where is it documented?</p>

<p>(I'll start a different thread on my trellis efforts soon btw)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/paul.html'><b itemprop='author'>paul</b></a>
           
           <time datetime='2015-08-14T10:31:03Z' itemprop='datePublished'>
             2015-08-14 10:31:03 UTC
           </time>
        </span>
        <span itemprop='position'>#17</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I copied &amp; edited the code "adcvalues[inputpin]" from the object editor of analogin object in axoloti software.<br>the number in the brace stands for a single adc port.</p>

<p>Here is a overview of the GPIOs:<br>the number after equal sign is the variable name of the input pin which should be paste in the braces<br>PA0 (ADC1_IN0)	= 0<br>PA1 (ADC1_IN1)	= 1<br>PA2 (ADC1_IN2) 	= 2<br>PA3 (ADC1_IN3)	= 3<br>PA4 (ADC1_IN4)	= 4<br>PA5 (ADC1_IN5)	= 5<br>PA6 (ADC1_IN6)	= 6<br>PA7 (ADC1_IN7)	= 7<br>PB0 (ADC1_IN8)	= 8<br>PB1 (ADC1_IN9)	= 9<br>PC0 (ADC1_IN10)	= 10<br>PC1 (ADC1_IN11)	= 11<br>PC2 (ADC1_IN12)	= 12<br>PC3 (ADC1_IN13)	= 13<br>PC4 (ADC1_IN14)	= 14</p>

<p>one hint to filter adc jitter by code. you can try to sample the read value and compare upcoming value to the last read one. If it's change by e.g. 5%, the adc should send the new value to the y dials…</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/hesspet.html'><b itemprop='author'>hesspet</b></a>
           
           <time datetime='2015-08-16T00:22:11Z' itemprop='datePublished'>
             2015-08-16 00:22:11 UTC
           </time>
        </span>
        <span itemprop='position'>#18</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Some addtional troubleshooting hints with the 4051:</p>

<p><strong>Important!</strong> Not all versions of the 4051 will work stable in a 3,3 envirionment If Vee == GND.</p>

<p>e.g. the 4051 HCT has specification: <br>VCC-GND         min: 4.5, typical: 5.0 max:5.5      V</p>

<p>e.g. the 4051 HC has specification: <br>VCC-GND         min:2.0, typical: 5.0, max:10.0 V</p>

<p>So when you use the HCT version with the AXO, you'll run into a lot of strange problems . It works, sometimes - but outsite the specification. This is good if you plan to build an Lunetta :-), but for a multiplexer this can be worse.</p>

<p>BTW: 100nf between Vcc and GND could save a lot of problems in such breadboard environments. Put the cap close as possible to the pins!  Or better solder the cap on top over the chip.</p>

<p>FYI: More about the voltages on page 6:<a href="http://www.nxp.com/documents/data_sheet/74HC_HCT4051.pdf" rel="nofollow">http://www.nxp.com/documents/data_sheet/74HC_HCT4051.pdf</a></p>

<p>This is if you like to use DIPs.</p>

<p>But better would be a version like this:<strong>HD74LV4051A</strong></p>

<p>the shortcut <strong>LV / LVC</strong> gives you a hint of LowVoltage. Those Chips are made for the use with 3,3V. They are hard to get sometimes and hard to solder. Only SMD available. If you have luck, SOIC14 is available. This is one of the disadvantages of the 3,3 voltage for tinkerer (and breadboard testing)</p>

<p>Or use a "<strong>level shifter</strong>" between the Axo board and the "normal" CMOS 5V world. <img src="../../../images/emoji/emoji_one/smilea4f0.png?v=0" title=":smile:" class="emoji" alt="smile"> Since I work with 3,3 I allway have some 8 Line Levershifter breakouts in stock......</p>

<p>The last: Be aware, if you use a 4051, you lose aprox. 0,4 of you incomming signal inside the chip. This is normal!</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/paul.html'><b itemprop='author'>paul</b></a>
           
           <time datetime='2015-08-16T13:30:12Z' itemprop='datePublished'>
             2015-08-16 13:30:12 UTC
           </time>
        </span>
        <span itemprop='position'>#19</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hi <a class="mention" href="../../../users/hesspet.html">@hesspet</a>,<br>this is a helpful hint. I will link your explanations on my first post.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/Bohrbug.html'><b itemprop='author'>Bohrbug</b></a>
           
           <time datetime='2015-11-25T14:58:56Z' itemprop='datePublished'>
             2015-11-25 14:58:56 UTC
           </time>
        </span>
        <span itemprop='position'>#20</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-topic="133" data-slug="gpio-i-o-example-4051-de-multiplexer-reads-8-analog-sources" data-post="18"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../user_avatar/community.axoloti.com/hesspet/40/209_1.png" class="avatar">hesspet:</div>
<blockquote><p>Some addtional troubleshooting hints with the 4051:   Important! Not all versions of the 4051 will work stable in a 3,3 envirionment If Vee == GND.   e.g. the 4051 HCT has specification:  VCC-GND         min: 4.5, typical: 5.0 max:5.5      V   e.g. the 4051 HC has specification:  VCC-GND         min:2.0, typical: 5.0, max:10.0 V   So when you use the HCT version with the AXO, you'll run into a lot of strange problems . It works, sometimes - but outsite the specification. This is good if you plan…</p></blockquote></aside>

<p><a class="mention" href="../../../users/hesspet.html">@hesspet</a></p>

<p>Hi Hesspet,</p>

<p>Do you have a link where we can by a HD74LV4051A</p>

<p>Thanks !</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/rbrt.html'><b itemprop='author'>rbrt</b></a>
           
           <time datetime='2016-02-04T17:07:45Z' itemprop='datePublished'>
             2016-02-04 17:07:45 UTC
           </time>
        </span>
        <span itemprop='position'>#21</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi Paul,<br>could you sketch up an example how to write to the 4051's pins,<br>instead of reading them?<br>I want to multiplex the Axoloti's 2 analog outputs (PA4 + PA5),<br>in order to create a simple control-rate patching matrix...</p>

<p>I'm all new to the Axoloti and c-scripting as well,I understand some parts <br>of your script but not enough...</p>

<p>cheers</p>

<p>Robert</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/paul.html'><b itemprop='author'>paul</b></a>
           
           <time datetime='2016-02-09T09:56:40Z' itemprop='datePublished'>
             2016-02-09 09:56:40 UTC
           </time>
        </span>
        <span itemprop='position'>#22</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hi <a class="mention" href="../../../users/rbrt.html">@rbrt</a> ,</p>

<p>sorry, I'm not at home so I can't test the following code example.</p>

<p>You want to route the DAC1 output to any Y output pin of the 4051 like this:<br><div class="lightbox-wrapper"><a data-download-href="//community.axoloti.com/uploads/default/fc93f4a2ebc96d99491089c3f3e5dcde892fdcfd" href="../../../uploads/default/original/2X/f/fc93f4a2ebc96d99491089c3f3e5dcde892fdcfd.png" class="lightbox" title="4051-axoloti-dac-out.png"><img src="../../../uploads/default/optimized/2X/f/fc93f4a2ebc96d99491089c3f3e5dcde892fdcfd_1_690x213.png" width="690" height="213"><div class="meta">
<span class="filename">4051-axoloti-dac-out.png</span><span class="informations">981x303 6.44 KB</span><span class="expand"></span>
</div></a></div></p>

<p>axoloti Patch: <a class="attachment" href="../../../uploads/default/original/2X/b/4051%20DAC%20out%20PA4%2c5.axp">4051 DAC out PA4,5.axp</a> (2.8 KB)<br><img src="../../../uploads/default/original/2X/1/134b26fbcfe181105cb1cdbb4833d9570a0c90c9.png" width="393" height="338"></p>

<p>some parts of the code are from the "./out/analog.axo" object. An other solution will be to use a separate "./out/analog.axo" object and the script object only controls the Y pins of the 4051.</p>

<p><strong>SCRIPT OBJECT CODE:</strong></p>

<blockquote>
<p>/*<br>marked comments with "*" are from axoloti "script" object<br>code isn't tested<br>*/</p>
<p>int i;   // select y-input</p>
<p>void setup(void){<br>	palSetPadMode(GPIOA,0,PAL_MODE_OUTPUT_PUSHPULL);	// s0 Pin of 4051<br>	palSetPadMode(GPIOA,1,PAL_MODE_OUTPUT_PUSHPULL);	// S1 Pin of 4051<br>	palSetPadMode(GPIOA,2,PAL_MODE_OUTPUT_PUSHPULL);	// s2 Pin of 4051</p>
<pre><code>palSetPadMode(GPIOA, 4, PAL_MODE_INPUT_ANALOG);		// DAC OUTPUT PA4*
palSetPadMode(GPIOA, 5, PAL_MODE_INPUT_ANALOG);		// DAC OUTPUT PA5*</code></pre>
<p>RCC-&gt;APB1ENR |= 0x20000000;	// *<br>	DAC-&gt;CR |= 0x00030003;	// *</p>
<pre><code>i = 0;</code></pre>
<p>}</p>
<p>void loop(void){</p>
<pre><code>i = in1;		//script object in1 controls 4051's Y output selection
if (i == 8) {
	i = 0;
}



palWritePad(GPIOA,0,((i&amp; 0x01) &gt; 0));		// write s0
palWritePad(GPIOA,1,(((i&gt;&gt;1)&amp; 0x01) &gt; 0));	// write s1
palWritePad(GPIOA,2,(((i&gt;&gt;2)&amp; 0x01) &gt; 0));	// write s2


// select pin of the 4051 and route the DAC output value to it.
switch (i){
	case 0: 	
		DAC-&gt;DHR12R1 = in2&gt;&gt;15;				// check "input 1" of the "script" object and control DAC PA4 *
		/*DAC-&gt;DHR12R2 = in2&gt;&gt;15;				// check "input 2" of the "script" object and control DAC PA5* */
	break;
}


chThdSleepMilliseconds(5);	// short delay</code></pre>
<p>}</p>
</blockquote>

<p>I hope this may help you.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/rbrt.html'><b itemprop='author'>rbrt</b></a>
           
           <time datetime='2016-02-19T10:59:14Z' itemprop='datePublished'>
             2016-02-19 10:59:14 UTC
           </time>
        </span>
        <span itemprop='position'>#23</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi Paul,<br>thanks a lot for the inspiration!<br>looks like right now I'm rather stuck with my little project:</p>

<p>My intention is to build a 'hardware' patching-matrix using REAL WIRES,<br>something like 4-8 analog outputs and inputs..</p>

<p>so, I've been attempting to multiplex the axo's A4 analog output with the 4051.<br>I actually got there, but I need to sample and hold the 4051's outputs somehow.<br>right now this is done inside the custom object I wrote <br>(you need the 1.07 release version to run the patch!!)</p>

<p>but once I rearrange them WIRES in the REAL WORLD, it's all loosing sync...<br>so, do you have any idea about how to sample and hold the 4051's outputs?</p>

<p><div class="lightbox-wrapper"><a data-download-href="//community.axoloti.com/uploads/default/7233c6c8919b3f9167497f916ce4b1a2046c50ab" href="../../../uploads/default/original/2X/7/7233c6c8919b3f9167497f916ce4b1a2046c50ab.png" class="lightbox" title="4051_multiplexing.PNG"><img src="../../../uploads/default/optimized/2X/7/7233c6c8919b3f9167497f916ce4b1a2046c50ab_1_690x369.png" width="690" height="369"><div class="meta">
<span class="filename">4051_multiplexing.PNG</span><span class="informations">1263x677 45.4 KB</span><span class="expand"></span>
</div></a></div><br>ah,you have to wire things up like this:<br>(I'm referring to your first post)<br>z = A4<br>y0 = A6<br>y1= A7<br>y2=B0<br>y3 =B1</p>

<p><a class="attachment" href="../../../uploads/default/original/2X/d/4051%20multiplexing.axp">4051 multiplexing.axp</a> (7.3 KB)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/paul.html'><b itemprop='author'>paul</b></a>
           
           <time datetime='2016-02-19T14:09:14Z' itemprop='datePublished'>
             2016-02-19 14:09:14 UTC
           </time>
        </span>
        <span itemprop='position'>#24</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I deleted the axoloti 1.0.7 version and I'm using the stable version 1.0.6. Can you upload your axo object here, so I can watch your object code.<br>do you have used an array to store/recall PA4 write values?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='[GPIO I/O] Example 4051 de/multiplexer reads 8 analog sources'>
      <hr>
  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement'>
      <span itemprop='url'><b><a rel="next" itemprop="name" href="../1334658.html?page=2">next page →</a></b></span>
  </div>





    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../../index.html'>Home</a>
        <a href="../../../categories.html">Categories</a>
        <a href="../../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../../tos.html">Terms of Service</a>
        <a href="../../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/gpio-i-o-example-4051-de-multiplexer-reads-8-analog-sources/133/10 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:12:43 GMT -->
</html>
