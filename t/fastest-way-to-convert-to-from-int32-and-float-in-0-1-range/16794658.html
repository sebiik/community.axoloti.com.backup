<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/fastest-way-to-convert-to-from-int32-and-float-in-0-1-range/1679?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:17:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Fastest way to convert to/from int32 and float in 0-1 range - AxoObject coding - Axoloti Community</title>
    <meta name="description" content="The question is in the title, really. I&amp;#39;d like it be able to convert an inlet value (int32) to a floating-point number in the range 0 &amp;gt; 1, then convert that back to an int32 in the correct range. 

Sorry if it&amp;#39;s a naive &amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="16794658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Fastest way to convert to/from int32 and float in 0-1 range&#39;" href="1679.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/fastest-way-to-convert-to-from-int32-and-float-in-0-1-range/1679?page=2" />
<meta name="twitter:url" content="http://community.axoloti.com/t/fastest-way-to-convert-to-from-int32-and-float-in-0-1-range/1679?page=2" />
<meta property="og:title" content="Fastest way to convert to/from int32 and float in 0-1 range" />
<meta name="twitter:title" content="Fastest way to convert to/from int32 and float in 0-1 range" />
<meta property="og:description" content="[image] [image] [image]  This one is more extreme. Think I prefer the previous equation.   a|x" />
<meta name="twitter:description" content="[image] [image] [image]  This one is more extreme. Think I prefer the previous equation.   a|x" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="8 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="9 ❤" />

      <link rel="prev" href="1679.html">
      <link rel="next" href="16799ba9.html?page=3">

  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="1679.html">Fastest way to convert to/from int32 and float in 0-1 range</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/axoobject-code.html" itemprop="url">
        <span itemprop="title">AxoObject coding</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-05-12T20:27:17Z' itemprop='datePublished'>
             2016-05-12 20:27:17 UTC
           </time>
        </span>
        <span itemprop='position'>#21</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="16" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>y=a*(x^4) + (1-a)*(1-(1-x)^4)</p></blockquote></aside>

<p><div class="lightbox-wrapper"><a data-download-href="//community.axoloti.com/uploads/default/588dd1ee396d64676855035e397a263ef3142549" href="../../uploads/default/original/2X/5/588dd1ee396d64676855035e397a263ef3142549.png" class="lightbox" title="Screen Shot 2016-05-12 at 21.26.03.png"><img src="../../uploads/default/optimized/2X/5/588dd1ee396d64676855035e397a263ef3142549_1_690x484.png" width="690" height="484"><div class="meta">
<span class="filename">Screen Shot 2016-05-12 at 21.26.03.png</span><span class="informations">1150x807 74 KB</span><span class="expand"></span>
</div></a></div><br><div class="lightbox-wrapper"><a data-download-href="//community.axoloti.com/uploads/default/cb1e0554c713dda29711aba4bbc7faba0e5163b9" href="../../uploads/default/original/2X/c/cb1e0554c713dda29711aba4bbc7faba0e5163b9.png" class="lightbox" title="Screen Shot 2016-05-12 at 21.25.46.png"><img src="../../uploads/default/optimized/2X/c/cb1e0554c713dda29711aba4bbc7faba0e5163b9_1_690x484.png" width="690" height="484"><div class="meta">
<span class="filename">Screen Shot 2016-05-12 at 21.25.46.png</span><span class="informations">1150x807 72.3 KB</span><span class="expand"></span>
</div></a></div><br><div class="lightbox-wrapper"><a data-download-href="//community.axoloti.com/uploads/default/2718a5ba40536d7e1f73ddffc3bcc2d1e61644f7" href="../../uploads/default/original/2X/2/2718a5ba40536d7e1f73ddffc3bcc2d1e61644f7.png" class="lightbox" title="Screen Shot 2016-05-12 at 21.25.26.png"><img src="../../uploads/default/optimized/2X/2/2718a5ba40536d7e1f73ddffc3bcc2d1e61644f7_1_690x484.png" width="690" height="484"><div class="meta">
<span class="filename">Screen Shot 2016-05-12 at 21.25.26.png</span><span class="informations">1150x807 72.3 KB</span><span class="expand"></span>
</div></a></div></p>

<p>This one is more extreme. Think I prefer the previous equation.</p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2016-05-12T20:38:43Z' itemprop='datePublished'>
             2016-05-12 20:38:43 UTC
           </time>
        </span>
        <span itemprop='position'>#22</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>yeah, I noticed the S at 0.5 too... think id prefer less extreme curves, but with a proper linear behaviour.<br>... I guess, I can just throw one of them in for now, always can be altered/fine tuned later.</p>

<p>I guess the 'efficiency' side, will also depend how you use it... if you only have a few as a function generator (which was the use-case i had in mind originally) its not too critical, but if you want to use if for envelopes with polyphonic voices then its going to have to be efficient, as there are many more in use.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-05-12T20:53:37Z' itemprop='datePublished'>
             2016-05-12 20:53:37 UTC
           </time>
        </span>
        <span itemprop='position'>#23</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="20" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/thetechnobear/40/6_1.html" class="avatar">thetechnobear:</div>
<blockquote><p>-fno-math-errno</p></blockquote></aside>

<p>Don't expect any issues with adding that, pull request welcome!</p>

<aside class="quote" data-post="19" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v2/letter/t/b9e5f3/40.png" class="avatar">toneburst:</div>
<blockquote><p>Gives a slight S-curve at an interpolation factor of 0.5.</p></blockquote></aside>

<p>I don't think the s-shape would be noticeable, I think the most important properties are the derivative continuities at x=0 and x=1.<br>Maybe two parameters would be nice, one for the derivative at x=0 and one for the derivative at x=1?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-05-12T21:17:30Z' itemprop='datePublished'>
             2016-05-12 21:17:30 UTC
           </time>
        </span>
        <span itemprop='position'>#24</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I made a little test with the basic square/square-root approximation.</p>

<p><a class="attachment" href="../../uploads/default/original/2X/d/Interpolations%20Test.axp">Interpolations Test.axp</a> (4.5 KB)</p>

<p>Not sure I have the cycle counter objects setup right, but it seems to be reporting 1 cycle, which seems unlikely.</p>

<p><div class="lightbox-wrapper"><a data-download-href="//community.axoloti.com/uploads/default/24022169cfd47a7869569c45a69b419ee744be8c" href="../../uploads/default/original/2X/2/24022169cfd47a7869569c45a69b419ee744be8c.png" class="lightbox" title="Screen Shot 2016-05-12 at 22.16.26.png"><img src="../../uploads/default/optimized/2X/2/24022169cfd47a7869569c45a69b419ee744be8c_1_690x369.png" width="690" height="369"><div class="meta">
<span class="filename">Screen Shot 2016-05-12 at 22.16.26.png</span><span class="informations">1069x573 52.6 KB</span><span class="expand"></span>
</div></a></div></p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-05-12T21:22:46Z' itemprop='datePublished'>
             2016-05-12 21:22:46 UTC
           </time>
        </span>
        <span itemprop='position'>#25</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="23" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>Maybe two parameters would be nice, one for the derivative at x=0 and one for the derivative at x=1?</p></blockquote></aside>

<p>How about a Cubic Bezier? You'd need 4 parameters, for the X and Y values of the 'handle' for the two points.</p>

<p><a href="http://cubic-bezier.com/" class="onebox" target="_blank" rel="nofollow">http://cubic-bezier.com/</a></p>

<p>You'd probably want to constrain the handles so the curve stayed within the 0 &gt; 1 range.</p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/DrJustice-2.html'><b itemprop='author'>DrJustice</b></a>
           
           <time datetime='2016-05-12T21:40:23Z' itemprop='datePublished'>
             2016-05-12 21:40:23 UTC
           </time>
        </span>
        <span itemprop='position'>#26</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I have some home grown intrinsics that may help with the conversion. I meant to post it earlier today, but got distracted. This ARM generation is much newer than the ones I used to work with back in the days, so someone please look over it. Seems to do the right thing though, taking two cycles.</p>

<pre><code>&lt;code.declaration&gt;&lt;![CDATA[

  __attribute__( ( always_inline ) ) __STATIC_INLINE float ___VCVT_F32_S32 ( int32_t op1, int32_t op2 )
  {
    float result;
    __ASM volatile ( "vmov %0,%1\n"
                     "vcvt.F32.S32  %0, %0, %2\n"
                     : "=w" (result)
                     : "r" (op1), "i" (op2)
                   );
    return(result);
  };

  __attribute__( ( always_inline ) ) __STATIC_INLINE int32_t  ___VCVT_S32_F32 ( float op1, int32_t op2 )
  {
    int32_t result;
    __ASM volatile ( "vcvt.S32.F32 %1, %1, %2\n"
                     "vmov %0,%1\n"
                     : "=r" (result)
                     : "w" (op1), "i" (op2)
                   );
    return(result);
  };

]]&gt;&lt;/code.declaration&gt;</code></pre>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-05-12T21:40:29Z' itemprop='datePublished'>
             2016-05-12 21:40:29 UTC
           </time>
        </span>
        <span itemprop='position'>#27</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="16" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>y=a*(x^4) + (1-a)*(1-(1-x)^4)</p></blockquote></aside>

<p>Is super-expensive, using pow()</p>

<p><code>float outf = pos * (pow(inf, 4)) + (1 - pos) * (1 - pow(1 - inf, 4));</code></p>

<p>Peaks at 40% CPU with my basic test patch.</p>

<p><a class="attachment" href="../../uploads/default/original/2X/b/Interpolations%20Test%202.axp">Interpolations Test 2.axp</a> (4.5 KB)</p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-05-12T21:41:24Z' itemprop='datePublished'>
             2016-05-12 21:41:24 UTC
           </time>
        </span>
        <span itemprop='position'>#28</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hmm, the compiler is probably moving the operations to somewhere else...<br>A quick workaround to prevent this is adding<br><code>asm volatile("mov r0, r0");</code><br>before and after your code. The optimizer can't move code across this barrier. I think I should include it in the cyclecounter object. reference: <a href="http://www.ethernut.de/en/documents/arm-inline-asm.html" rel="nofollow">http://www.ethernut.de/en/documents/arm-inline-asm.html</a></p>

<p>Beziers do not express nicely as an y=f(x) function, they're not strictly single valued.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2016-05-12T21:42:02Z' itemprop='datePublished'>
             2016-05-12 21:42:02 UTC
           </time>
        </span>
        <span itemprop='position'>#29</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="15" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>powf() is very expensive</p></blockquote></aside>

<p>do you think it might be worth linking the CMSIS power methods into the firmware, and comparing...<br>arm_power_q15 , could be interesting to compare.</p>

<p>whats your general thoughts on including more of the CMSIS library? seems it might be handy  and easy to use for many... Im not sure how it efficient it is, but perhaps useful for where performance is not critical, and for 'simpler' uses?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-05-12T21:44:01Z' itemprop='datePublished'>
             2016-05-12 21:44:01 UTC
           </time>
        </span>
        <span itemprop='position'>#30</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="27" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v2/letter/t/b9e5f3/40.png" class="avatar">toneburst:</div>
<blockquote><p>Is super-expensive, using pow()</p></blockquote></aside>

<p>No pow(), expand x^4 to x*x*x*x, hopefully the compiler recognizes this as <code>(x*x)*(x*x)</code> and then it's only two multiplies away.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-05-12T21:50:11Z' itemprop='datePublished'>
             2016-05-12 21:50:11 UTC
           </time>
        </span>
        <span itemprop='position'>#31</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="27" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v2/letter/t/b9e5f3/40.png" class="avatar">toneburst:</div>
<blockquote><p>float outf = pos * (pow(inf, 4)) + (1 - pos) * (1 - pow(1 - inf, 4));</p></blockquote></aside>

<p>Replaced with</p>

<p><code>float outf = pos*(inf*inf*inf*inf)+(1-pos)*(1-(1-inf)*(1-inf)*(1-inf)*(1-inf));</code></p>

<p>Much better!</p>

<p>a|x</p>

<p><a class="attachment" href="../../uploads/default/original/2X/9/Interpolations%20Test%203.axp">Interpolations Test 3.axp</a> (4.5 KB)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-05-12T22:02:33Z' itemprop='datePublished'>
             2016-05-12 22:02:33 UTC
           </time>
        </span>
        <span itemprop='position'>#32</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="29" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/thetechnobear/40/6_1.html" class="avatar">thetechnobear:</div>
<blockquote><p>do you think it might be worth linking the CMSIS power methods into the firmware</p></blockquote></aside>

<p>Do you mean void arm_power_q15()?</p>

<pre><code>/**    
 * @brief Sum of the squares of the elements of a Q15 vector.    
 * @param[in]       *pSrc points to the input vector    
 * @param[in]       blockSize length of the input vector    
 * @param[out]      *pResult sum of the squares value returned here    
 * @return none.    
 */</code></pre>

<p>It's unrelated to the pow(x,y) math function...</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-05-12T22:09:51Z' itemprop='datePublished'>
             2016-05-12 22:09:51 UTC
           </time>
        </span>
        <span itemprop='position'>#33</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This is my variant (in axoloti-contrib/patches/jt/devel/float_workbench.axp):</p>

<pre><code>__attribute__ ( ( always_inline ) ) __STATIC_INLINE float Q27ToF(int32_t op1) {
  float fop1 = *(float*)(&amp;op1);
  __ASM volatile ("VCVT.F32.S32 %0, %0, 27" : "+w" (fop1) );
  return(fop1);
}

__attribute__ ( ( always_inline ) ) __STATIC_INLINE int32_t FToQ27(float fop1) {
  __ASM volatile ("VCVT.S32.F32 %0, %0, 27" : "+w" (fop1) );
  int32_t r = *(int32_t*)(&amp;fop1);
  return(r);
}</code></pre>

<p>This includes the Q27 scaling for free.<br>I left the data move to the freedom of the compiler, the M4 can also move two core registers to two fpu registers in one <a href="http://infocenter.arm.com/help/topic/com.arm.doc.dui0553a/CHDICEHB.html" rel="nofollow">instruction</a>.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-05-12T22:10:20Z' itemprop='datePublished'>
             2016-05-12 22:10:20 UTC
           </time>
        </span>
        <span itemprop='position'>#34</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="28" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>Beziers do not express nicely as an y=f(x) function, they're not strictly single valued.</p></blockquote></aside>

<p>There may be fixed-point/integer implementations though, and you can set the Y coordinate of your end point to an arbitrary number, so you don't need to scale afterwards.</p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-05-12T22:28:23Z' itemprop='datePublished'>
             2016-05-12 22:28:23 UTC
           </time>
        </span>
        <span itemprop='position'>#35</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>The Bezier function:</p>

<pre><code>x(t) = (1 - t)^3*x1 + 3*(1 -  t)^2*t*x2 + 3*(1 -  t)*t^2*x3 + t^3*x4
y(t) = (1 - t)^3*y1 + 3*(1 -  t)^2*t*y2 + 3*(1 -  t)*t^2*y3 + t^3*y4</code></pre>

<p>can you convert that to <br>y=f(x) ?</p>

<p>I believe a solution to <br>"two parameters one for the derivative at x=0 and one for the derivative at x=1?"<br>should exist that is way less complex than bezier.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-05-12T22:38:19Z' itemprop='datePublished'>
             2016-05-12 22:38:19 UTC
           </time>
        </span>
        <span itemprop='position'>#36</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="35" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>y=f(x) ?</p></blockquote></aside>

<p>I'm waaaay out of my depth here, but isn't 't' (time/curve-completion) the value that would be your input, rather than x?</p>

<p>You should be able to simplify the function down to 1D, in which case, you'd only need two parameters for the handles, since start/end points are fixed at 0/[maxvalue].</p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-05-12T22:50:15Z' itemprop='datePublished'>
             2016-05-12 22:50:15 UTC
           </time>
        </span>
        <span itemprop='position'>#37</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="28" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>Beziers do not express nicely as an y=f(x) function, they're not strictly single valued.</p></blockquote></aside>

<p>They <a href="http://blog.demofox.org/2014/08/28/one-dimensional-bezier-curves/" rel="nofollow">can do</a>, apparently...</p>

<p>a|x</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/toneburst.html'><b itemprop='author'>toneburst</b></a>
           
           <time datetime='2016-05-12T22:57:53Z' itemprop='datePublished'>
             2016-05-12 22:57:53 UTC
           </time>
        </span>
        <span itemprop='position'>#38</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This works really well for kicks! Exactly what I had in mind!!</p>

<p>a|x</p>

<p><a class="attachment" href="../../uploads/default/original/2X/7/Kick%20Interpolation.axp">Kick Interpolation.axp</a> (5.7 KB)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/DrJustice-2.html'><b itemprop='author'>DrJustice</b></a>
           
           <time datetime='2016-05-12T23:00:14Z' itemprop='datePublished'>
             2016-05-12 23:00:14 UTC
           </time>
        </span>
        <span itemprop='position'>#39</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="33" data-topic="1679"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>This includes the Q27 scaling for free.I left the data move to the freedom of the compiler, the M4 can also move two core registers to two fpu registers in one instruction.</p></blockquote></aside>

<p>I agree that it's better to let the compiler do the data move. It's still useful be able to pass in the scaling since one does not always want Q27 - the passing of the scaling as an immediate operand is also free in the sense of needing no extra cycles.</p>

<p>Perhaps it would be good to make both  Q27ToF(int32_t op1) and FixToFloat ( int32_t op1, int32_t scale ) variants available in firmware/axoloti_math.h?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-05-12T23:11:55Z' itemprop='datePublished'>
             2016-05-12 23:11:55 UTC
           </time>
        </span>
        <span itemprop='position'>#40</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Ah I missed op2 in your code, I'm surprised it is possible to export that opcode field to a generic C function!<br>Certainly considering inclusion in axoloti_math.h, still I feel it needs a bit more testing to be confident...</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Fastest way to convert to/from int32 and float in 0-1 range'>
      <hr>
  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement'>
      <span itemprop='url'><a rel="prev" itemprop="name" href="1679.html">← previous page</a></span>
      <span itemprop='url'><b><a rel="next" itemprop="name" href="16799ba9.html?page=3">next page →</a></b></span>
  </div>





    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/fastest-way-to-convert-to-from-int32-and-float-in-0-1-range/1679?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:17:44 GMT -->
</html>
