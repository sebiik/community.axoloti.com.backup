<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/usbhost-sysex-with-cme-widi-bud/3895 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jul 2023 03:46:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>USBHost sysex with CME Widi Bud - Developer - Axoloti Community</title>
    <meta name="description" content="Sorry for the vague question. I&amp;#39;ve been messing about with sending sysex to my Roli Seaboard Block the last couple of days. When  I load a patch, I send three sysex messages using MidiSendSysex(), each 16 bytes long (to &amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="3895.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;USBHost sysex with CME Widi Bud&#39;" href="3895-2.html" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/usbhost-sysex-with-cme-widi-bud/3895" />
<meta name="twitter:url" content="http://community.axoloti.com/t/usbhost-sysex-with-cme-widi-bud/3895" />
<meta property="og:title" content="USBHost sysex with CME Widi Bud" />
<meta name="twitter:title" content="USBHost sysex with CME Widi Bud" />
<meta property="og:description" content="Sorry for the vague question. I&#39;ve been messing about with sending sysex to my Roli Seaboard Block the last couple of days. When  I load a patch, I send three sysex messages using MidiSendSysex(), each 16 bytes long (to set midi channel start/end + MPE on/off). With the CME Widi Bud (for bluetooth midi) I get a ring buffer overflow if I send all three at once, but a delay between each fixes that.    Everything behaves as expected with an USB cable, but with the Widi Bud only the first sysex mess..." />
<meta name="twitter:description" content="Sorry for the vague question. I&#39;ve been messing about with sending sysex to my Roli Seaboard Block the last couple of days. When  I load a patch, I send three sysex messages using MidiSendSysex(), each 16 bytes long (to set midi channel start/end + MPE on/off). With the CME Widi Bud (for bluetooth midi) I get a ring buffer overflow if I send all three at once, but a delay between each fixes that.    Everything behaves as expected with an USB cable, but with the Widi Bud only the first sysex mess..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 â¤" />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="3895.html">USBHost sysex with CME Widi Bud</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/developer.html" itemprop="url">
        <span itemprop="title">Developer</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Abhoth.html'><b itemprop='author'>Abhoth</b></a>
           
           <time datetime='2017-11-02T08:11:38Z' itemprop='datePublished'>
             2017-11-02 08:11:38 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Sorry for the vague question. I've been messing about with sending sysex to my Roli Seaboard Block the last couple of days. When  I load a patch, I send three sysex messages using MidiSendSysex(), each 16 bytes long (to set midi channel start/end + MPE on/off). With the CME Widi Bud (for bluetooth midi) I get a ring buffer overflow if I send all three at once, but a delay between each fixes that. </p>

<p>Everything behaves as expected with an USB cable, but with the Widi Bud only the first sysex message works. So whenever a new patch is loaded, the first sysex message works (it doesn't matter which it is), the next ones doesn't. If I keep sending messages after that while the patch is running, some works, some don't, without any obvious pattern.</p>

<p>So, realizing that the Widi Bud is probably to blame here, not Axoloti, what I was hoping for was that someone with a better understanding of what goes on on a low level might have a clue what is causing this. Or, since the first message on a freshly loaded patch consistently works, is there some way to "reset" the USBHost back to that state? So that I could do reset - sysex - reset - sysex - reset - sysex for a reliable transfer?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='USBHost sysex with CME Widi Bud'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2017-11-02T16:36:41Z' itemprop='datePublished'>
             2017-11-02 16:36:41 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="1" data-topic="3895"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/abhoth/40/835_1.png" class="avatar">Abhoth:</div>
<blockquote><p>When  I load a patch, I send three sysex messages using MidiSendSysex(), each 16 bytes long (to set midi channel start/end + MPE on/off). With the CME Widi Bud (for bluetooth midi) I get a ring buffer overflow if I send all three at once, but a delay between each fixes that.</p></blockquote></aside>

<p>this should not happen, there is room on the ring buffer for 64x4 bytes midi messages, so your 3 x 16 bytes would only take a tiny fraction of this - so thats a 'concern', perhaps you are mixing other midi data in the stream?</p>

<p>there is no way to reset the usb host, and i don't think that would work anyway, as this would mean the device initialisation would be done again... i.e. the thing your sending too, what probably act as a disconnect/connect, so require all the MPE messages again.</p>

<p>unfortunately debugging usb really requires a usb protocol analyser, and they are not cheap...<br>you could possibly get a bit more info if you debug the axoloti kernel, but having done this before, its unlikely to throw up much.</p>

<p>the next release of axoloti will have a completely new usb stack, based on chibios rather than stms framework.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='USBHost sysex with CME Widi Bud'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Abhoth.html'><b itemprop='author'>Abhoth</b></a>
           
           <time datetime='2017-11-03T08:21:14Z' itemprop='datePublished'>
             2017-11-03 08:21:14 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>The Seaboard block sends a 11 byte sysex msg twice every second or so, but that is the only other midi I know of. The overflow is only when using the Widi Bud, not with an USB cable, so that is probably the culprit, somehow. The whole thing bugs me a bit simply because I don't see the logic to it. But I don't actually need to get it working, so I'll leave it at this for the time being. I was just experimenting to see what I can expect to be able to do with the Roli Blocks and Axoloti.</p>

<p>Out of curiosity, does the new release/usb stack change anything regarding sysex messages?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='USBHost sysex with CME Widi Bud'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2017-11-03T10:38:45Z' itemprop='datePublished'>
             2017-11-03 10:38:45 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="3" data-topic="3895"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/abhoth/40/835_1.png" class="avatar">Abhoth:</div>
<blockquote><p>The Seaboard block sends a 11 byte sysex msg twice every second or so</p></blockquote></aside>

<p>these are not processed, and do not go on the output queue (so no overflow msg)</p>

<aside class="quote" data-post="3" data-topic="3895"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/abhoth/40/835_1.png" class="avatar">Abhoth:</div>
<blockquote><p>but that is the only other midi I know of. The overflow is only when using the Widi Bud, not with an USB cable</p></blockquote></aside>

<p>my suspicion is that for some reason the output queue is not being read at all... but if you don't retry, I don't understand why the queue would overflow...  unless what is happening is you are assuming the messages are processed, and then continuing to send other midi messages i.e. its not really anything to do with the sysex.... what happens if you don't send the sysex messages at all? do other midi message get thru?</p>

<aside class="quote" data-post="3" data-topic="3895"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/abhoth/40/835_1.png" class="avatar">Abhoth:</div>
<blockquote><p>Out of curiosity, does the new release/usb stack change anything regarding sysex messages?</p></blockquote></aside>

<p>yes, its all changing... and is the reason usb hub will work, obviously the flipside, is that as all the code is new, we don't have the experience with the quantity of devices we did with the old code, , though we have tested the devices we have, and they generally look ok, and have helped highlight a few issues, but we will only know for sure, when its released and others test their devices.<br>(of course, we are assuming, and hopeful that most devices will work perfectly ok)</p>

<p>one change, which I need to get some time to do, is to allow for receiving/processing of sysex... but been a bit busy with other things.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='USBHost sysex with CME Widi Bud'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/usbhost-sysex-with-cme-widi-bud/3895 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jul 2023 03:46:38 GMT -->
</html>
