<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:15:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Building from source for GNU Guix (was: Stuck in DFU mode) - Helpdesk - Axoloti Community</title>
    <meta name="description" content="I&amp;#39;ve built the cross-compiler toolchain and the Axoloti software on GNU Guix, but so far have not been able to successfully upload a patch (as reported here https://github.com/axoloti/axoloti/issues/267). 

Everything lo&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="8114658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Building from source for GNU Guix (was: Stuck in DFU mode)&#39;" href="811.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811?page=2" />
<meta name="twitter:url" content="http://community.axoloti.com/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811?page=2" />
<meta property="og:title" content="Building from source for GNU Guix (was: Stuck in DFU mode)" />
<meta name="twitter:title" content="Building from source for GNU Guix (was: Stuck in DFU mode)" />
<meta property="og:description" content="That&#39;s a good idea.  I&#39;ll try that." />
<meta name="twitter:description" content="That&#39;s a good idea.  I&#39;ll try that." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="5 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="6 ❤" />

      <link rel="prev" href="811.html">

  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="811.html">Building from source for GNU Guix (was: Stuck in DFU mode)</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/helpdesk.html" itemprop="url">
        <span itemprop="title">Helpdesk</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/rekado.html'><b itemprop='author'>rekado</b></a>
           
           <time datetime='2016-01-05T08:19:14Z' itemprop='datePublished'>
             2016-01-05 08:19:14 UTC
           </time>
        </span>
        <span itemprop='position'>#21</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="19" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>Maybe diff the output from arm-none-eabi-objdump disassembling axoloti.elf rather than the binary code?</p></blockquote></aside>

<p>That's a good idea.  I'll try that.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Building from source for GNU Guix (was: Stuck in DFU mode)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-01-05T11:46:10Z' itemprop='datePublished'>
             2016-01-05 11:46:10 UTC
           </time>
        </span>
        <span itemprop='position'>#22</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="20" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/rekado/40/1059_1.jpg" class="avatar">rekado:</div>
<blockquote><p>If I do this in the GUI via normal mode (i.e. the LED is lit) dfu-util starts working, but at the end when it says that the firmware was uploaded successfully the board reboots and the firmware hasn't actually been changed.</p></blockquote></aside>

<p>Normal flashing (not rescue flashing) does not involve dfu-util but uses the firmware/flasher binary.<br>Are you using a self compiled firmware/flasher binary? Normally normal flashing first uploads the firmware image to sdram, then uploads the firmware/flasher binary (as if it was a compiled patch), executes this binary. At this point the usb connection is lost, the firmware flasher takes over the normal firmware duties, green led stays on, the red led blinks during flash erase and programming, and then the board reboots into the new firmware.<br>Sounds like your firmware/flasher binary is invalid similar like your compiler produces an invalid firmware, so nothing is flashed.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Building from source for GNU Guix (was: Stuck in DFU mode)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/rekado.html'><b itemprop='author'>rekado</b></a>
           
           <time datetime='2016-01-06T22:04:08Z' itemprop='datePublished'>
             2016-01-06 22:04:08 UTC
           </time>
        </span>
        <span itemprop='position'>#23</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="22" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/johannes/40/8_1.html" class="avatar">johannes:</div>
<blockquote><p>Sounds like your firmware/flasher binary is invalid similar like your compiler produces an invalid firmware, so nothing is flashed.</p></blockquote></aside>

<p>Yes, this explains it.  I confirmed that using the prebuilt <code>flasher.bin</code> the board accepts the broken firmware and behaves in the same manner.</p>

<p>I have tried many combinations of cross-compiler versions, newlib vs newlib-nano, binutils, etc, but haven't been able to identify the source of these problems yet.  For now I'll use the precompiled binaries for <code>flasher</code>, <code>mounter</code>, and <code>axoloti</code>, but I'd really like to eventually be able to use the binaries I compile myself.</p>

<p>It would be nice if there was a minimal binary I could compare -- even flasher.{elf,bin} is much too large to allow me to compare the two compilers.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Building from source for GNU Guix (was: Stuck in DFU mode)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-01-07T00:10:44Z' itemprop='datePublished'>
             2016-01-07 00:10:44 UTC
           </time>
        </span>
        <span itemprop='position'>#24</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="23" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/rekado/40/1059_1.jpg" class="avatar">rekado:</div>
<blockquote><p>It would be nice if there was a minimal binary I could compare -- even flasher.{elf,bin} is much too large to allow me to compare the two compilers.</p></blockquote></aside>

<p>I recommend comparing the disassembly annotated with sourcecode of the .elf with arm-none-eabi-objdump. The ResetHandler would be the first thing to look at. I can't be of further help here as it drains time away from more important issues, and this is way more related to building compilers than to axoloti itself. Maybe ask <a href="https://launchpad.net/gcc-arm-embedded">here</a>?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Building from source for GNU Guix (was: Stuck in DFU mode)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/rekado.html'><b itemprop='author'>rekado</b></a>
           
           <time datetime='2016-01-07T08:29:50Z' itemprop='datePublished'>
             2016-01-07 08:29:50 UTC
           </time>
        </span>
        <span itemprop='position'>#25</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I understand.  Thank you for the hints and explanations so far!  I think I can go on alone from here.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Building from source for GNU Guix (was: Stuck in DFU mode)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/rekado.html'><b itemprop='author'>rekado</b></a>
           
           <time datetime='2016-01-08T07:15:15Z' itemprop='datePublished'>
             2016-01-08 07:15:15 UTC
           </time>
        </span>
        <span itemprop='position'>#26</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Another update for the record: the flasher and mounter binaries are now identical after making sure that newlib-nano is used as the C library instead of plain newlib.  The difference between the two is the configure flags.</p>

<p>Unfortunately, the axoloti.elf file still differs (and doesn't work), but I'm getting closer to a package for GNU Guix, so all people would have to do is run <code>guix package -i axoloti-patcher</code> to install everything that's needed to use the board on any GNU+Linux system.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Building from source for GNU Guix (was: Stuck in DFU mode)'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/rekado.html'><b itemprop='author'>rekado</b></a>
           
           <time datetime='2016-01-10T20:14:41Z' itemprop='datePublished'>
             2016-01-10 20:14:41 UTC
           </time>
        </span>
        <span itemprop='position'>#27</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Success!  I had to pass <code>--enable-multilib</code> to the build of the cross-compiler and newlib-nano.  Now I have a working setup and a set of package expressions for Guix, which make it easy to install a self-contained environment for Axoloti.</p>

<p>I'll polish the package expressions a little and then publish and announce them.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:3'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Building from source for GNU Guix (was: Stuck in DFU mode)'>
      <hr>
  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement'>
      <span itemprop='url'><a rel="prev" itemprop="name" href="811.html">← previous page</a></span>
  </div>





    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:15:24 GMT -->
</html>
