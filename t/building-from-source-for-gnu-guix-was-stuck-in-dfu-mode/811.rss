<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
    <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811</link>
    <description>I&#39;ve built the cross-compiler toolchain and the Axoloti software on GNU Guix, but so far have not been able to successfully upload a patch (as reported here https://github.com/axoloti/axoloti/issues/267).

Everything looks fine and the logs state that chunks are uploaded, but every time it reports a firmware CRC mismatch.  So I thought that maybe I should try uploading the firmware via DFU mode and I disconnected the device, pressed S1, reconnected, and the device appeared in DFU mode:

`Bus 006 Device 027: ID 0483:df11 SGS Thomson Microelectronics STM Device in DFU Mode`

So I selected Board -&gt; Firmware -&gt; Flash (Rescue) and observed dfu-util do its thing.  Here&#39;s the output:

    Copyright 2005-2009 Weston Schmidt, Harald Welte and OpenMoko Inc.
    Copyright 2010-2014 Tormod Volden and Stefan Schmidt
    This program is Free Software and has ABSOLUTELY NO WARRANTY
    Please report bugs to dfu-util@lists.gnumonks.org

    dfu-util: Invalid DFU suffix signature
    dfu-util: A valid DFU suffix will be required in a future dfu-util release!!!
    Opening DFU capable USB device...
    ID 0483:df11
    Run-time device DFU version 011a
    Claiming USB DFU Interface...
    Setting Alternate Setting #0 ...
    Determining device status: state = dfuERROR, status = 10
    dfuERROR, clearing status
    Determining device status: state = dfuIDLE, status = 0
    dfuIDLE, continuing
    DFU mode device DFU version 011a
    Device returned transfer size 2048
    DfuSe interface name: &quot;Internal Flash  &quot;
    Downloading to address = 0x08000000, size = 570468

    Download	[                         ]   0%            0 bytes
    ...
    Download	[============             ]  50%       288768 bytes
    ...
    Download	[=========================] 100%       570468 bytes
    Download done.
    File downloaded successfully
    Transitioning to dfuMANIFEST state
    Done flashing firmware with DFU.

Now upon disconnecting the board and connecting it again it seems to be dead.  lsusb does not show it, it does not power on, and the only way I can get it to reappear is by pressing S1 while connecting it.  It appears again in DFU mode and I can again flash the rescue firmware as before, but I cannot seem to get it back into normal mode again.

I&#39;m not sure what&#39;s going on here.  In the regular mode uploading firmware had no effect (firmware CRC mismatch, no matter how often I flashed it) and in DFU mode flashing the firmware seems to not do anything either.

I have another board which is still in regular mode and it has the same issue with firmware CRC mismatch warnings, so I don&#39;t think it&#39;s a hardware problem.</description>
    
    <lastBuildDate>Sun, 10 Jan 2016 20:14:41 +0000</lastBuildDate>
    <category>Helpdesk</category>
    <atom:link href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>Success!  I had to pass <code>--enable-multilib</code> to the build of the cross-compiler and newlib-nano.  Now I have a working setup and a set of package expressions for Guix, which make it easy to install a self-contained environment for Axoloti.</p>

<p>I'll polish the package expressions a little and then publish and announce them.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/27">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/27</link>
        <pubDate>Sun, 10 Jan 2016 20:14:41 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-27</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>Another update for the record: the flasher and mounter binaries are now identical after making sure that newlib-nano is used as the C library instead of plain newlib.  The difference between the two is the configure flags.</p>

<p>Unfortunately, the axoloti.elf file still differs (and doesn't work), but I'm getting closer to a package for GNU Guix, so all people would have to do is run <code>guix package -i axoloti-patcher</code> to install everything that's needed to use the board on any GNU+Linux system.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/26">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/26</link>
        <pubDate>Fri, 08 Jan 2016 07:15:15 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-26</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>I understand.  Thank you for the hints and explanations so far!  I think I can go on alone from here.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/25">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/25</link>
        <pubDate>Thu, 07 Jan 2016 08:29:50 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-25</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@johannes johannes]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/johannes">@johannes</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="23" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/rekado/40/1059_1.png" class="avatar">rekado:</div>
<blockquote><p>It would be nice if there was a minimal binary I could compare -- even flasher.{elf,bin} is much too large to allow me to compare the two compilers.</p></blockquote></aside>

<p>I recommend comparing the disassembly annotated with sourcecode of the .elf with arm-none-eabi-objdump. The ResetHandler would be the first thing to look at. I can't be of further help here as it drains time away from more important issues, and this is way more related to building compilers than to axoloti itself. Maybe ask <a href="https://launchpad.net/gcc-arm-embedded">here</a>?</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/24">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/24</link>
        <pubDate>Thu, 07 Jan 2016 00:10:44 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-24</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="22" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/johannes/40/8_1.png" class="avatar">johannes:</div>
<blockquote><p>Sounds like your firmware/flasher binary is invalid similar like your compiler produces an invalid firmware, so nothing is flashed.</p></blockquote></aside>

<p>Yes, this explains it.  I confirmed that using the prebuilt <code>flasher.bin</code> the board accepts the broken firmware and behaves in the same manner.</p>

<p>I have tried many combinations of cross-compiler versions, newlib vs newlib-nano, binutils, etc, but haven't been able to identify the source of these problems yet.  For now I'll use the precompiled binaries for <code>flasher</code>, <code>mounter</code>, and <code>axoloti</code>, but I'd really like to eventually be able to use the binaries I compile myself.</p>

<p>It would be nice if there was a minimal binary I could compare -- even flasher.{elf,bin} is much too large to allow me to compare the two compilers.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/23">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/23</link>
        <pubDate>Wed, 06 Jan 2016 22:04:08 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-23</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@johannes johannes]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/johannes">@johannes</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="20" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/rekado/40/1059_1.png" class="avatar">rekado:</div>
<blockquote><p>If I do this in the GUI via normal mode (i.e. the LED is lit) dfu-util starts working, but at the end when it says that the firmware was uploaded successfully the board reboots and the firmware hasn't actually been changed.</p></blockquote></aside>

<p>Normal flashing (not rescue flashing) does not involve dfu-util but uses the firmware/flasher binary.<br>Are you using a self compiled firmware/flasher binary? Normally normal flashing first uploads the firmware image to sdram, then uploads the firmware/flasher binary (as if it was a compiled patch), executes this binary. At this point the usb connection is lost, the firmware flasher takes over the normal firmware duties, green led stays on, the red led blinks during flash erase and programming, and then the board reboots into the new firmware.<br>Sounds like your firmware/flasher binary is invalid similar like your compiler produces an invalid firmware, so nothing is flashed.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/22">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/22</link>
        <pubDate>Tue, 05 Jan 2016 11:46:10 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-22</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="19" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/johannes/40/8_1.png" class="avatar">johannes:</div>
<blockquote><p>Maybe diff the output from arm-none-eabi-objdump disassembling axoloti.elf rather than the binary code?</p></blockquote></aside>

<p>That's a good idea.  I'll try that.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/21">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/21</link>
        <pubDate>Tue, 05 Jan 2016 08:19:14 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-21</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="19" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/johannes/40/8_1.png" class="avatar">johannes:</div>
<blockquote><p>Uploading the standard firmware or your firmware?</p></blockquote></aside>

<p>Uploading my own firmware.  If I do this in the GUI via normal mode (i.e. the LED is lit) dfu-util starts working, but at the end when it says that the firmware was uploaded successfully the board reboots and the firmware hasn't actually been changed. (It reports a CRC mismatch again and again, and when downloading the firmware from the board I see that it's still the same binary as before.)</p>

<p>Only when flashing in DFU mode the firmware is in fact changed (as shown by downloading the uploaded firmware and comparing it) --- and since my firmware seems to be broken the board never initialises USB, so lsusb doesn't show it.</p>

<p>I find it odd that in normal mode this error does not occur and everything suggests that the firmware was updated, when in fact it was not.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/20">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/20</link>
        <pubDate>Tue, 05 Jan 2016 07:41:53 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-20</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@johannes johannes]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/johannes">@johannes</a> wrote:</p>
          <blockquote>
              <p>Maybe diff the output from arm-none-eabi-objdump disassembling axoloti.elf rather than the binary code?<br>I also suggest to ask on gcc-arm-embedded related discussion lists.</p>

<aside class="quote" data-post="17" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/rekado/40/1059_1.png" class="avatar">rekado:</div>
<blockquote><p>Uploading my firmware in DFU mode causes the board to "die"; lsusb doesn't show that it's connected.  Why doesn't this happen when I upload it via the GUI in normal mode?</p></blockquote></aside>

<p>Uploading the standard firmware or your firmware? Double check the paths involved. How the firmware image is flashed does not matter. If the firmware does not run properly (due to the differences), and does not reach the firmware usb device setup, there will be nothing visible in lsusb.</p>

<p>Anyway thumbs up for getting it running!</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/19">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/19</link>
        <pubDate>Mon, 04 Jan 2016 22:31:40 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-19</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>Quick update: replacing the firmware directory with the one that's bundled in the .deb file I can compile patches and upload them to the board --- and I actually get sound!</p>

<p>So, the compiler seems to work, but the firmware I built is broken.</p>

<p>(The board is lovely and the sound is great!)</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/18">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/18</link>
        <pubDate>Mon, 04 Jan 2016 22:17:56 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-18</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>The first question I'd like to answer is: why does it look like my firmware is uploaded to the board (when in normal mode), but the board never actually retains it?</p>

<p>Whenever I download firmware from the board it is the one version that I successfully uploaded: the one bundled with the .deb archive.</p>

<p>Uploading my firmware in DFU mode causes the board to "die"; <code>lsusb</code> doesn't show that it's connected.  Why doesn't this happen when I upload it via the GUI in normal mode?</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/17">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/17</link>
        <pubDate>Mon, 04 Jan 2016 21:15:44 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-17</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>I downloaded the firmware from the board with dfu-util and indeed there are a couple of difference between the file and axoloti.bin.</p>

<p>A common change is that the downloaded file has hex "0000 0000" where axoloti.bin has "aff3 0080".  According to <a href="http://armconverter.com/conversions.php" rel="nofollow">this page</a> the latter is Thumb-2 hex for <code>NOP.W</code>; don't know why it would be replaced with all zeros upon uploading the firmware.</p>

<p>Yet another often repeated change is from <code>682f</code> (axoloti.bin) to <code>482f</code> (on board).</p>

<p>There are a few other minor changes, but they don't appear to have a simple pattern.  It's often just a change of a single 32 bit word.  I wonder what would cause this change when uploading the binary.</p>

<p>I tried uploading the firmware bundled with the .deb archive and see if there's any differences when downloading it from the board.  (Just as a sanity check.)  There are no such differences in the first 2^14 bytes, so I assume the file stays the same.</p>

<hr>

<p>EDIT: I compared both the original firmware bundled with the .deb and the firmware I downloaded from the board --- and they are the same!  This strongly suggests that my self-compiled firmware was never successfully uploaded.  I will try uploading my custom firmware from the command line via dfu-util.</p>

<p>EDIT: this does work, but the board is stuck in DFU mode again.  The differences I noted above are, in fact, between my self-built firmware and the bundled pre-compiled firmware.  I'm surprised to see how similar the two are.  I'll try to figure out what causes the differences --- and which of them are important.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/16">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/16</link>
        <pubDate>Mon, 04 Jan 2016 19:50:41 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-16</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@johannes johannes]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/johannes">@johannes</a> wrote:</p>
          <blockquote>
              <p>I have no clue about Guix, if you say prebuilt gcc won't work I totally believe you <img src="/images/emoji/emoji_one/smile.png?v=0" title=":smile:" class="emoji" alt=":smile:"></p>

<p>Firmware computes crc32 from internal flash when booting on the microcontroller (in firmware/pconnection.c, in InitPConnection), the GUI computes the crc32 from the file firmware/build/axoloti.bin</p>

<p>They're verified, and also a patch launched will verify, since a mismatch can cause crashes (of just the board, and non-destructive), since firmware symbols could have moved.</p>

<p>firmware/flasher is a binary that loads via the same mechanism as a patch, but rather than being linked to the firmware, it is fully self-contained so it can erase/write a new firmware. This is used in the GUI in the firmware update process.</p>

<p>If you have managed to compile and upload a firmware with your self-compiled gcc, you're pretty close! The crc mismatch, that could come from different padding by the dfu-upload or something. Perhaps do a binary firmware <em>download</em> with dfu-util, and check a binary diff. I also get crc mismatches when launching firmware via gdb/openocd/stlink but haven't studied the origin. In this situation I bypass the patch-firmware crc validation (axoloti/src/main/java/axoloti/Patch.java , remove line 1199 with the return statement).</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/15">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/15</link>
        <pubDate>Sun, 03 Jan 2016 22:43:12 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-15</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>GuixSD doesn't follow the FHS to provide functional package management as well as stateless and declarative system configuration.  Prebuilt binaries won't work as they expect certain libraries to be located in well-known locations.  To make matters worse, I don't think I can easily get a 32 bit glibc on my 64 bit system (the glibc that comes with GuixSD doesn't currently support multilib).</p>

<p>That's why it's easier for me to build the compiler toolchain from source (Guix makes this pretty simple, actually).  The compiler does seem to work (i.e. it builds ARM binaries and links them successfully), but Axoloti claims that the CRC after uploading via dfu-util differs.  I find this rather odd.</p>

<p>I'll try to use the very same commit of "newlib" that is mentioned in the release.txt of the prebuilt gcc-arm-none-eabi tarball next, but I feel I'm soon running out of options.  Maybe diffing the produced binaries themselves will shed some light on what's going on.</p>

<p>How is the hardware CRC computed?  It seems to be the result of something transmitted via USB, but I don't understand the code well enough to know where it really comes from.</p>

<p>What is "firmware/flasher/flasher_build/flasher.bin" used for?  Exactly what binaries are uploaded to the board?  Is there some documentation about this or would it be better if I read the code?</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/14">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/14</link>
        <pubDate>Sun, 03 Jan 2016 22:11:29 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-14</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@johannes johannes]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/johannes">@johannes</a> wrote:</p>
          <blockquote>
              <p>Don't know, haven't ever built arm-none-eabi-gcc myself. What prevents running the gcc-arm-none-eabi distribution?</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/13">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/13</link>
        <pubDate>Sun, 03 Jan 2016 21:07:53 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-13</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>I rebuilt the cross-compiler using the exact same SVN branch and revision, but unfortunately the behaviour is unchanged.  Maybe it's not the compiler that is to be blamed but differences in newlib?</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/12">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/12</link>
        <pubDate>Sun, 03 Jan 2016 20:58:53 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-12</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="10" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/rekado/40/1059_1.png" class="avatar">rekado:</div>
<blockquote><p>I would love to figure out what the difference between the two compilers or C libraries is (and the produced binaries).  I'll investigate.</p></blockquote></aside>

<p>One obvious difference is that I used the regular GCC 4.9.3 sources, but the binary compiler toolchain (gcc-arm-none-eabi-4_9-2015q2-20150609) is based on a different branch of the GCC sources: <a href="https://gcc.gnu.org/svn/gcc/branches/ARM/embedded-4_9-branch/" rel="nofollow">https://gcc.gnu.org/svn/gcc/branches/ARM/embedded-4_9-branch/</a> at revision 224288.</p>

<p>I'll rebuild the cross-compiler with these sources; maybe that's enough to fix it.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/11">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/11</link>
        <pubDate>Sat, 02 Jan 2016 14:15:59 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-11</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>It worked with the firmware contained in the .deb package.</p>

<p>That's both good and bad.  "Good" because the board is back to normal mode, "bad" because it means that my cross-compiler doesn't quite produce the correct binaries (although it seems to be very close).</p>

<p>At least I'm sure now that dfu-util works as it should, and that the boards are not broken <img src="/images/emoji/emoji_one/smile.png?v=0" title=":smile:" class="emoji" alt=":smile:"></p>

<p>I would love to figure out what the difference between the two compilers or C libraries is (and the produced binaries).  I'll investigate.</p>

<p>Thanks for the assistance so far!</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/10">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/10</link>
        <pubDate>Sat, 02 Jan 2016 13:57:28 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-10</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="8" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/johannes/40/8_1.png" class="avatar">johannes:</div>
<blockquote><p>Could you extract it from the .deb package?</p></blockquote></aside>

<p>Oh, yes, I could try that.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/9">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/9</link>
        <pubDate>Sat, 02 Jan 2016 13:35:21 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-9</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@johannes johannes]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/johannes">@johannes</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="7" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/rekado/40/1059_1.png" class="avatar">rekado:</div>
<blockquote><p>share the binary firmware</p></blockquote></aside>

<p>Could you extract it from the .deb package?</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/8">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/8</link>
        <pubDate>Sat, 02 Jan 2016 13:34:52 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-8</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="3" data-topic="811" data-full="true"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/johannes/40/8_1.png" class="avatar">johannes:</div>
<blockquote><p>Are you using the same arm-none-eabi-gcc version as in the build script to build the firmware (gcc-arm-none-eabi-4_9-2015q2-20150609)?</p></blockquote></aside>

<p>I'm not using the prebuilt gcc-arm-none-eabi distribution (primarily because it wouldn't work on my system).  I built the cross compiler (version 4.9.3 for target "arm-none-eabi") and the "newlib" C library (version 2.2.0) from scratch.  It compiles the firmware fine.</p>

<p>If it really is a problem with the firmware binary, would it be possible for you to share the binary firmware and let me try to upload that with dfu-util, rather than the firmware I built?</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/7">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/7</link>
        <pubDate>Sat, 02 Jan 2016 13:32:15 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-7</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@rekado]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/rekado">@rekado</a> wrote:</p>
          <blockquote>
              <p>I have applied the patch to the upstream sources of libusb 1.0.19.  I used the patched version of libusb as an input to "dfu-util" version 0.8.</p>

<p>I followed the build.sh as closely as possible.  I did not pass USB_LIBS and USB_CFLAGS during the configuration phase of dfu-util because there is only the patched version of libusb around at build time (Guix packages are built in a chroot where only declared inputs are visible).</p>

<p>(One additional configure flag that I pass to libusb is "--disable-udev" because uedev depends on libusb indirectly.)</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/6">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/6</link>
        <pubDate>Sat, 02 Jan 2016 13:28:07 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-6</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@johannes johannes]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/johannes">@johannes</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/thetechnobear/40/6_1.png" class="avatar">thetechnobear:</div>
<blockquote><p>the libusb patch</p></blockquote></aside>

<p>missing the libusb patch 'd only cause dfu-util to fail (issue with the rom bootloader in stm32f42x series), but that looks fine in <a class="mention" href="/users/rekado">@rekado</a>'s log</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/5">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/5</link>
        <pubDate>Sat, 02 Jan 2016 13:27:22 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-5</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@thetechnobear Mark Harris]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/thetechnobear">@thetechnobear</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="1" data-topic="811"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//community.axoloti.com/user_avatar/community.axoloti.com/rekado/40/1059_1.png" class="avatar">rekado:</div>
<blockquote><p>dfu-util: Invalid DFU suffix signature<br>dfu-util: A valid DFU suffix will be required in a future dfu-util release!!!<br>Opening DFU capable USB device...<br>ID 0483:df11<br>Run-time device DFU version 011a<br>Claiming USB DFU Interface...<br>Setting Alternate Setting #0 ...<br>Determining device status: state = dfuERROR, status = 10<br>dfuERROR, clearing status</p></blockquote></aside>

<p>ok, dont worry about these 'errors' I get these too.</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/4">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/4</link>
        <pubDate>Sat, 02 Jan 2016 13:26:03 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-4</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
      <item>
        <title>Building from source for GNU Guix (was: Stuck in DFU mode)</title>
        <dc:creator><![CDATA[@johannes johannes]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/u/johannes">@johannes</a> wrote:</p>
          <blockquote>
              <p>Are you using the same arm-none-eabi-gcc version as in the build script to build the firmware (gcc-arm-none-eabi-4_9-2015q2-20150609)?</p>
          </blockquote>
          <p><a href="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/3">Read full topic</a></p>
        ]]></description>
        <link>https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811/3</link>
        <pubDate>Sat, 02 Jan 2016 13:23:40 +0000</pubDate>
        <guid isPermaLink="false">community.axoloti.com-post-811-3</guid>
        <source url="https://sebiik.github.io/community.axoloti.com.backup/t/building-from-source-for-gnu-guix-was-stuck-in-dfu-mode/811.rss">Building from source for GNU Guix (was: Stuck in DFU mode)</source>
      </item>
  </channel>
</rss>
