<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/increasing-the-3khz-control-rate-frequency/6427 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:15:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Increasing the 3khz control rate frequency - Hardware - Axoloti Community</title>
    <meta name="description" content="Hey people, I want to use the axoloti to control the following 40Channel DAC board. https://www.analog.com/en/design-center/evaluation-hardware-and-software/evaluation-boards-kits/eval-ad5370.html#eb-overview 
 
 

As i &amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="6427.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://sebiik.github.io/community.axoloti.com.backup","potentialAction":{"@type":"SearchAction","target":"https://sebiik.github.io/community.axoloti.com.backup/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Increasing the 3khz control rate frequency&#39;" href="6427.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="https://sebiik.github.io/community.axoloti.com.backup/t/increasing-the-3khz-control-rate-frequency/6427" />
<meta name="twitter:url" content="https://sebiik.github.io/community.axoloti.com.backup/t/increasing-the-3khz-control-rate-frequency/6427" />
<meta property="og:title" content="Increasing the 3khz control rate frequency" />
<meta name="twitter:title" content="Increasing the 3khz control rate frequency" />
<meta property="og:description" content="Hey people, I want to use the axoloti to control the following 40Channel DAC board. https://www.analog.com/en/design-center/evaluation-hardware-and-software/evaluation-boards-kits/eval-ad5370.html#eb-overview       As i plan to use the axoloti mainly for controlling those channels I am wondering if there is a way to increase the control rate frequency from 3khz to for example 48 khz or 24khz. I read the following topic and wanted to implement the spi communication similarily but I think that the..." />
<meta name="twitter:description" content="Hey people, I want to use the axoloti to control the following 40Channel DAC board. https://www.analog.com/en/design-center/evaluation-hardware-and-software/evaluation-boards-kits/eval-ad5370.html#eb-overview       As i plan to use the axoloti mainly for controlling those channels I am wondering if there is a way to increase the control rate frequency from 3khz to for example 48 khz or 24khz. I read the following topic and wanted to implement the spi communication similarily but I think that the..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="8 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="5 ❤" />

      <link rel="next" href="64274658.html?page=2">

  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="6427.html">Increasing the 3khz control rate frequency</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/hardware.html" itemprop="url">
        <span itemprop="title">Hardware</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Flub.html'><b itemprop='author'>Flub</b></a>
           
           <time datetime='2020-02-20T09:19:22Z' itemprop='datePublished'>
             2020-02-20 09:19:22 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hey people,<br>I want to use the axoloti to control the following 40Channel DAC board.<br><a href="https://www.analog.com/en/design-center/evaluation-hardware-and-software/evaluation-boards-kits/eval-ad5370.html#eb-overview" class="onebox" target="_blank" rel="nofollow noopener">https://www.analog.com/en/design-center/evaluation-hardware-and-software/evaluation-boards-kits/eval-ad5370.html#eb-overview</a><br><aside class="onebox pdf">
  <header class="source">
    <a href="https://www.analog.com/media/en/technical-documentation/evaluation-documentation/EVAL-AD5370_5372_5373EB.pdf" target="_blank" rel="nofollow noopener">analog.com</a>
  </header>
  <article class="onebox-body">
    <a href="https://www.analog.com/media/en/technical-documentation/evaluation-documentation/EVAL-AD5370_5372_5373EB.pdf" target="_blank" rel="nofollow noopener"><span class="pdf-onebox-logo"></span></a>
<h3><a href="https://www.analog.com/media/en/technical-documentation/evaluation-documentation/EVAL-AD5370_5372_5373EB.pdf" target="_blank" rel="nofollow noopener">EVAL-AD5370_5372_5373EB.pdf</a></h3>

<p class="filesize">232.82 KB</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br><aside class="onebox pdf">
  <header class="source">
    <a href="https://www.analog.com/media/en/technical-documentation/data-sheets/AD5370.pdf" target="_blank" rel="nofollow noopener">analog.com</a>
  </header>
  <article class="onebox-body">
    <a href="https://www.analog.com/media/en/technical-documentation/data-sheets/AD5370.pdf" target="_blank" rel="nofollow noopener"><span class="pdf-onebox-logo"></span></a>
<h3><a href="https://www.analog.com/media/en/technical-documentation/data-sheets/AD5370.pdf" target="_blank" rel="nofollow noopener">AD5370.pdf</a></h3>

<p class="filesize">439.91 KB</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>

<p>As i plan to use the axoloti mainly for controlling those channels I am wondering if there is a way to increase the control rate frequency from 3khz to for example 48 khz or 24khz.<br>I read the following topic and wanted to implement the spi communication similarily but I think that the script objects loop function is called at a rate of 3khz only, isnt it?<br>Or is there a better way to implement that spi code as a pseudo audio object or with a totally different approach which gives even better performance?<br><a href="https://www.analog.com/en/design-center/evaluation-hardware-and-software/evaluation-boards-kits/eval-ad5370.html#eb-overview" class="onebox" target="_blank" rel="nofollow noopener">https://www.analog.com/en/design-center/evaluation-hardware-and-software/evaluation-boards-kits/eval-ad5370.html#eb-overview</a></p>

<p>Thanks in advance,<br>Florian</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2020-02-20T09:51:06Z' itemprop='datePublished'>
             2020-02-20 09:51:06 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Axoloti editor has 2 fans for  putting code for objects into, one for K-rate, which is 3khz and one for S-rate, which is 48khz.</p>

<p>You can probably just put the code in the 48khz fan and it will be updated at 48khz?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/tele_player.html'><b itemprop='author'>tele_player</b></a>
           
           <time datetime='2020-02-20T14:56:50Z' itemprop='datePublished'>
             2020-02-20 14:56:50 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I wonder what is the goal of the 40 channel DAC - to provide 40 channels of audio output?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Flub.html'><b itemprop='author'>Flub</b></a>
           
           <time datetime='2020-02-20T23:47:28Z' itemprop='datePublished'>
             2020-02-20 23:47:28 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I want to control a lot of mini modules which are based around the cem/alfa synthesizer chips using a quite complex midi controller patch I created for the axoloti where it was the sound generator. It sounded not so good thats why I try using that 40 channel DAC Evaluation board to replace the audio objects with hardware. Somehow it is using the axoloti as a very complex and editable midi/CV module</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/weasel79.html'><b itemprop='author'>weasel79</b></a>
           
           <time datetime='2020-02-21T04:54:40Z' itemprop='datePublished'>
             2020-02-21 04:54:40 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="4" data-topic="6427"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v2/letter/f/4af34b/40.png" class="avatar">Flub:</div>
<blockquote><p>40 channel DAC Evaluation board</p></blockquote></aside>

<p>yummy. you got my attention.</p>

<p>are you using electro smith submodules? i got a couple of those and still plan to make an axoloti-controlled analog synth one day. currently only using the fv-1 one.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Flub.html'><b itemprop='author'>Flub</b></a>
           
           <time datetime='2020-02-21T08:04:53Z' itemprop='datePublished'>
             2020-02-21 08:04:53 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>What is a fv-1 ? this one? <a href="http://www.spinsemi.com/products.html" rel="nofollow noopener">http://www.spinsemi.com/products.html</a><br>For what do you use it?<br>I bought the pcbs and parts for a raw implementation of the CEM3340 from Frank Buss <a href="https://hackaday.io/project/160538-cem3340-module" rel="nofollow noopener">https://hackaday.io/project/160538-cem3340-module</a> Now i make a mother pcb for this little board to get the right signal levels and the sine etc.<br>I also bought many of the cem vca vcadsr and vcf chips. The next step is to build a prototype vca, vcadsr and vcf for these too. And if everything is designed well i want to create independant micro modules similar to the one of Frank Buss.<br>And then the last step is to design a routing pcb on which i can just plug those micro modules which could be used in other contexts too.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Flub.html'><b itemprop='author'>Flub</b></a>
           
           <time datetime='2020-02-21T14:52:22Z' itemprop='datePublished'>
             2020-02-21 14:52:22 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I can now control the DAC via bitbanging but somehow the spi functions wont work. Perhaps someone can see the fault.<br>I put the gpio/spi/config object in the top left corner of the patch with the settings:<br>clock_polarity: 0<br>clock_phase: 0<br>baudrate: FPCLK/4<br>format: MSB first</p>

<pre><code>txbuf[0] = 0b11001000;
txbuf[1] = 0x80; 
txbuf[2]= 0b00010011;

palWritePad(GPIOA, CLK, 0); 
palWritePad(GPIOA, CLK, 0); palWritePad(GPIOA,SYNC,1); 
palWritePad(GPIOA,SYNC,0);

spiSelect(&amp;SPID1); 
spiSend(&amp;SPID1,3,txbuf);        
spiUnselect(&amp;SPID1);

palWritePad(GPIOA,SYNC,1); 
palWritePad(GPIOA,SYNC,0);

palWritePad(GPIOA,LDAC,0);
palWritePad(GPIOA,LDAC,1);</code></pre>

<p>When i do it manually it works: </p>

<pre><code>// Bit banging 
palWritePad(GPIOA, CLK, 0); 
palWritePad(GPIOA,SYNC,1); 
palWritePad(GPIOA,SYNC,0);

// Generate 24 falling clock edges	
for(int i=0; i&lt;24; i++) { // MSB First
	// set Data - MSB First 
	if (i&lt;8) { 			
		if (txbuf[0] &amp; (1 &lt;&lt; (7-i))) {
			palWritePad(GPIOA, MOSI, 1);
		} else {
			palWritePad(GPIOA, MOSI, 0);
		}
	} else if(i &lt; 16) {
		if (txbuf[1] &amp; (1 &lt;&lt; (7-(i-8)))) {
			palWritePad(GPIOA, MOSI, 1);
		} else {
			palWritePad(GPIOA, MOSI, 0);
		}
	} else {
		if (txbuf[2] &amp; (1 &lt;&lt; (7-(i-16)))) {
			palWritePad(GPIOA, MOSI, 1);
		} else {
			palWritePad(GPIOA, MOSI, 0);
		}
	}
	
	palWritePad(GPIOA, CLK, 1);
	palWritePad(GPIOA, CLK, 0); 	 
}

palWritePad(GPIOA,SYNC,1); 
palWritePad(GPIOA,SYNC,0);

palWritePad(GPIOA,LDAC,0);
palWritePad(GPIOA,LDAC,1);</code></pre>

<p>I need 24 falling clock edges while SYNC/NSS Pin (PA4) is LOW</p>

<p>I have the feeling that the clock output is wrong when i try to use the spi functions.<br>Can someone help me out?</p>

<p><a class="attachment" href="../../uploads/default/original/2X/6/eval_board-control_dev_05.axp">eval_board-control_dev_05.axp</a> (7.5 KB)</p>

<p>___ EDIT ___ SOLVED<br>I found the right information<br><aside class="onebox whitelistedgeneric">
  <header class="source">
    <a href="https://www.playembedded.org/blog/stm32-spi-chibios/" target="_blank" rel="nofollow noopener">playembedded.org</a>
  </header>
  <article class="onebox-body">
    <img src="../../../www.playembedded.org/blog/wp-content/uploads/2018/08/Cube-SPI.jpg" width="695" height="428" class="thumbnail">

<h3><a href="https://www.playembedded.org/blog/stm32-spi-chibios/" target="_blank" rel="nofollow noopener">Using STM32 SPI with ChibiOS</a></h3>

<p>The Serial Peripheral Interface (often shored as SPI bus) is a widely used synchronous serial communication peripheral which communicates in full duplex mode using a master-slave architecture with a single master.
As the SPI is a Synchronous...</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>And i had set the Outputmode of some Pins twice.<br>I still dont know what this PAL_MODE_ALTERNATE in the GPIO/SPI/CONFIG object code means ... but it works</p>

<pre><code>palSetPadMode(GPIOA, 4, PAL_MODE_OUTPUT_PUSHPULL);// NSS</code></pre>

<p>palSetPadMode(GPIOA, 5, PAL_MODE_OUTPUT_PUSHPULL);// SCK<br>palSetPadMode(GPIOA, 7, PAL_MODE_OUTPUT_PUSHPULL);// MOSI<br>//palSetPadMode(GPIOA, 4, PAL_MODE_ALTERNATE(5));// NSS<br>palSetPadMode(GPIOA, 5, PAL_MODE_ALTERNATE(5));// SCK<br>palSetPadMode(GPIOA, 6, PAL_MODE_ALTERNATE(5));// MISO<br>palSetPadMode(GPIOA, 7, PAL_MODE_ALTERNATE(5));// MOSI</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/weasel79.html'><b itemprop='author'>weasel79</b></a>
           
           <time datetime='2020-02-21T15:49:18Z' itemprop='datePublished'>
             2020-02-21 15:49:18 UTC
           </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>thats exciting please keep us updated. maybe oyu wanna do another thread just for the DAC board driver though so its easier to find, since this current thread title is kind of misleading.</p>

<p>i thought you might be using the electro smith modules that also mostly utilize CEM chips:<br><a href="https://www.electro-smith.com/electro-boards" class="onebox" target="_blank" rel="nofollow noopener">https://www.electro-smith.com/electro-boards</a><br>they have a VCO, VCF, VCA and the FV-1 multieffect, all in very basic but super convenient "developement boards". i got a couple of them around and was gonna do something similar to what you're doing i think, use the axoloti as a controller, for UI, LFOs, envelopes etc and just send CVs to the analog submodules. But it looks like the stuff you're using is very similar.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2020-02-21T23:59:02Z' itemprop='datePublished'>
             2020-02-21 23:59:02 UTC
           </time>
        </span>
        <span itemprop='position'>#9</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="2" data-topic="6427" data-full="true"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/community.axoloti.com/jaffasplaffa/40/5808_1.png" class="avatar">jaffasplaffa:</div>
<blockquote>
<p>Axoloti editor has 2 fans for  putting code for objects into, one for K-rate, which is 3khz and one for S-rate, which is 48khz.</p>
<p>You can probably just put the code in the 48khz fan and it will be updated at 48khz?</p>
</blockquote></aside>

<p>No, what happens is that the Axoloti framwork puts a 16 times loop around the S-rate code, and runs the whole loop at the K-rate. So the code in the loop will be executed 48000 times per second, but not in a uniform manner, rather, 3000 times per second it will execute 16 times in a row. For some applications this is fine, but it doesn't sound like it would be a good idea if outputting data to one ore more DACs which need a regular sample interval corresponding to 48000 Hz.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2020-02-22T06:02:21Z' itemprop='datePublished'>
             2020-02-22 06:02:21 UTC
           </time>
        </span>
        <span itemprop='position'>#10</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thank you for the clarification, didn't know that <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Flub.html'><b itemprop='author'>Flub</b></a>
           
           <time datetime='2020-02-22T09:22:23Z' itemprop='datePublished'>
             2020-02-22 09:22:23 UTC
           </time>
        </span>
        <span itemprop='position'>#11</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../u/weasel79.html">@weasel79</a> <br>Ah, these are interesting modules. If i would have known that before buying the alfa chips in DIP-14 Housing I would have thinked about buying these instead. But they are also a little more expensive.</p>

<p><a class="mention" href="../../u/ricard.html">@ricard</a> Thank you for that hint. I am not sure if I understood it correctly. What you described would happen if i put the spiSend function inside the S-Rate code tab? <br>Is it possible to rename the thread to "AD5370 16bit 40 Channel DAC"?</p>

<p>Is there a way to execute my code 48000 times per second?<br>Here is the first working version:</p>

<p><a class="attachment" href="../../uploads/default/original/2X/3/eval_board-control_dev_11.axp">eval_board-control_dev_11.axp</a> (8.7 KB)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/ricard.html'><b itemprop='author'>ricard</b></a>
           
           <time datetime='2020-02-22T11:05:30Z' itemprop='datePublished'>
             2020-02-22 11:05:30 UTC
           </time>
        </span>
        <span itemprop='position'>#12</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="11" data-topic="6427" data-full="true"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v2/letter/f/4af34b/40.png" class="avatar">Flub:</div>
<blockquote>
<p><a class="mention" href="../../u/ricard.html">@ricard</a> Thank you for that hint. I am not sure if I understood it correctly. What you described would happen if i put the spiSend function inside the S-Rate code tab? </p>
<p>Is there a way to execute my code 48000 times per second?</p>
</blockquote></aside>

<p>If you put code inside the K-rate tab, it will be executed 3000 times per second, at roughly equal intervals (1/3000 s = 0.333 ms). The exact time at with the code is executed (relative to the 3000 Hz K-rate 'tick') depends on where the patcher actually places your code relative to the code for all the other modules. The higher up and further to the left in the patcher GUI you place a module, the closer to the 3000 Hz K-rate 'tick' it will be executed. Most often, modules take about the same amount of time to execute each time, so your code will get called fairly regularly at 0.333 ms intervals wherever in the physical patcher GUI space it is locaed.</p>

<p>If you put code inside the S-rate tab, the patcher puts a 16 times loop around it, and executes the loop at the K-rate of 3000 Hz. Thus, your code will be executed 48000 times a second (16 x 3000 Hz), but the interval between each time your code is called will not be 1/48000 = 20.833 µs. Rather, every 0.333 ms, your code will be called 16 times in quick succession. This means that if you're driving, say, an external DAC directly, and want to supply data (samples) every 20.833 µs (corresponding to 48000 Hz), it won't work, as you'll get a significantly shorter sample interval during the 16 times loop, and then a significantly longer (essentially, 0.333 ms minus the time it took the loop to run) time before the next burst of 16 samples.</p>

<p>But let's assume that the DAC has an internal FIFO that is at least 16 samples deep, and that the DAC consumes one sample from the FIFO per sampling interval (i.e. 20.833 µs @ 48000 kHz). In that case you could fire off 16 samples from the (implied loop in the) S-rate code, and the DAC would take care of them at the proper sampling interval, operating on one sample per sampling interval from the FIFO.</p>

<p>The point here is that if you want to precisely fire off a hardware event at a determined and constant interval, it won't work with S-rate code. Even K-rate code is dodgy, as the exact interval depends on the execution time of all the modules preceding your module. In some cases, like driving an external shift register to increase the number of GPIOs, when the exact interval is not important, it can be perfectly fine. But if you want drive a DAC to generate a stream of samples you want a very precise interval between the sample output.</p>

<p>(This raises the question of how the Axoloti handles the ADC and DAC in the ADAU1961 codec on the Axoloti board. The answer is that the codec is set up to generate and receive one sample per 48000 kHz sampling interval. The samples are sent using an I2S serial communications line which communicates with an I2S transceiver in the Axoloti. The I2S transceiver is in turn configured to continually send and receive a circular buffer of 32 samples for the DAC and 32 samples for the ADC, and generate an interrupt to the Axoloti firmware every 16 samples. This is what generates the K-rate sampling interval. At every K-rate interrupt, the Axoloti framework switches which half of the 32 sample in- and output buffers which is connected to the input and output modules, respectively. </p>

<p>Essentially, 16 samples from the ADC are accumulated in the input buffer, at the S-rate, which at the next K-rate interrupt are made available for the input module, and processed using the active patch, which in turn writes samples to the output buffer. At the same time, 16 samples from the previous run of the patch are being sent to the DAC. So the patch is constantly working on the 16 samples from the ADC from the previous K-rate interval, and writing 16 samples which will be sent to the DAC at the next K-rate interval.</p>

<p>Technically, the K-rate could be the same as the S-rate. However, this would mean that all processing for a single sample would need to take place at a 20.833 µs interval rather than a 0.333 ms interval. There are two reasons why this is not practical. First of all, there is an overhead setting up inputs and outputs etc for all modules, which then occurs for each sample, and not every 16 samples. Secondly, in order to optimze the DSP code, certain parameters are assumed to be constant during a K-rate interval. The resonance parameter for a filter is a good example of this. Limiting the resonance to be constant during a K-rate interval makes it possible to optimize the DSP code for the filter, leading to shorter overall execution times. Also, many processors, although I'm not sure about the ARM Cortex-M4F in the Axoloti, have instructions which can execute several trivial operations in one cycle (SIMD instructions) which can be used to optimize DSP code. Many CPUs have caches which speed up code execution, but they become really useful first when there are (tight) loops in the code. As far as I know though, the Cortex-M4F used in the Axoloti has no cache so this is not relevant.</p>

<p>So all in all, running DSP code in a K-rate vs S-rate environment allows significant optimizations of the code, which one wouldn't get with code processing individual samples all the way at the S-rate.</p>

<p>In fact, the K-rate used in the Axoloti is rather fast. In many DSP systems it can be a factor of 64 slower than the S-rate, or even slower, to minimize overhead, at the cost of increased latency. Indeed, the Axoloti system, with its 3 kHz K-rate, as an end-to-end (analog in to analog out) latency of about 0.333 ms * 2 = 0.667 ms, i.e. significantly less than a millisecond. That's about the same time it takes to transmit two MIDI bytes, of for a sound wave in air to travel about 20 cm.</p>

<p>Sorry for the long winded explanation... )</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:3'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Flub.html'><b itemprop='author'>Flub</b></a>
           
           <time datetime='2020-02-22T14:29:57Z' itemprop='datePublished'>
             2020-02-22 14:29:57 UTC
           </time>
        </span>
        <span itemprop='position'>#13</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Alright, thank you for that! So I could somehow think about using a 16 x 16bit buffer/shift register which is clocked out with the samplerate and loaded on each k-rate.<br>Perhaps K-rate is also enough. I just recognized that it is a bigger problem that my midi controller "akai midimix" cannot send NRPN cc messages. I mean that i can only get 0-127 steps from the faders which is not perfect. But it might be also okay when i use a smooth object in between the midi values and the "DAC object" input.</p>

<p>Anyways, if 3000Hz is not enough, is it possible to setup an extra timer + interrupt routine which is running faster?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/weasel79.html'><b itemprop='author'>weasel79</b></a>
           
           <time datetime='2020-02-22T16:49:52Z' itemprop='datePublished'>
             2020-02-22 16:49:52 UTC
           </time>
        </span>
        <span itemprop='position'>#14</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Wow thanks <a class="mention" href="../../u/ricard.html">@ricard</a> for the thorough explanation i finally understood a lot of issues i was running into recently. You should copy this into a user guide thread...</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/tele_player.html'><b itemprop='author'>tele_player</b></a>
           
           <time datetime='2020-02-22T23:34:11Z' itemprop='datePublished'>
             2020-02-22 23:34:11 UTC
           </time>
        </span>
        <span itemprop='position'>#15</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../u/flub-2.html">@Flub</a> - what is the maximum frequency you want to send using these DACs?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Flub.html'><b itemprop='author'>Flub</b></a>
           
           <time datetime='2020-02-23T16:18:16Z' itemprop='datePublished'>
             2020-02-23 16:18:16 UTC
           </time>
        </span>
        <span itemprop='position'>#16</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I am not sure yet. I want to make possible as much as possible so actually 48khz would be awesome to have. But I would just be fine with 3000 for a beginning.</p>

<p>I ve got a quick question about dynamically reading the inlet values.</p>

<pre><code>disp_d1 = inlet_i1 &gt;&gt; 11; 
//setDAC(1, X, (inlet_i2 &gt;&gt; 11));
for (uint8_t i = 0; i &lt; 40; i++) {
   setDAC(i, X, inlet_i??? &gt;&gt; 11));	
}
pulseLDAC();</code></pre>

<p>I think you see what the problem is. Do you know how it is done to dynamically compose those constant names ?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2020-02-23T16:57:31Z' itemprop='datePublished'>
             2020-02-23 16:57:31 UTC
           </time>
        </span>
        <span itemprop='position'>#17</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>You could just put the inlets into an array, like this:</p>

<p>int a[3]={inlet_i1,inlet_i2,inlet_i3};</p>

<p>And then use a variable to select which slot of the array you want to select:</p>

<p>outlet_l = a[param_sel];</p>

<p>Another way is to take advantage of srate inlets. If you are using many inlets, this is going to be the easiest way I think. If you are routing tons of cables, using this method can make bi patches a little bit easier to comprehed and work with.</p>

<p>If you make srate inlets, the red ones, but put the code into krate fan, you can actually route 16 krate signals through a srate inlet. Krate is 3000 srate is 48000, so 48000/3000=16.....</p>

<p>Something like this image below. Here I have ONE single srate inlet and then I use inlet[0], inlet[1], inlet[2], etc. to display each value from each of the parts of the inlets.</p>

<p><img src="../../uploads/default/original/2X/8/826e693d0486cab0f31dc7874afb0f2d4bcd9223.png" width="641" height="417"></p>

<p>You can simply use:</p>

<p>inlet_i[set number here]</p>

<p>to select one of the 16 inlet_i[x]</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Flub.html'><b itemprop='author'>Flub</b></a>
           
           <time datetime='2020-02-23T17:16:03Z' itemprop='datePublished'>
             2020-02-23 17:16:03 UTC
           </time>
        </span>
        <span itemprop='position'>#18</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Cool thank you! I just wanted to test it out, but i could not connect more than one blue line to the red input. How is that possible?<br>Anyways i think I will take that array approach so i can also check if the value changed before sending it to the DAC to save performance. When I send all of them it takes 60% of the cpu.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2020-02-23T17:20:07Z' itemprop='datePublished'>
             2020-02-23 17:20:07 UTC
           </time>
        </span>
        <span itemprop='position'>#19</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>See here how you get the values in. If you don't need many inlets, this is probably not the best solution. But if you do it's a lot easier.</p>

<p><img src="../../uploads/default/original/2X/5/56c817911d56d9ed4319c8a2aaf0ebb59d4e3a06.png" width="690" height="436"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Flub.html'><b itemprop='author'>Flub</b></a>
           
           <time datetime='2020-02-23T17:23:05Z' itemprop='datePublished'>
             2020-02-23 17:23:05 UTC
           </time>
        </span>
        <span itemprop='position'>#20</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Ah now I get it. Thats a nice trick and good to know : ) <br>I think I am gonna do it with a table and a kind of helper object where you can select the table index you want to control. so I can put the inlets for the DAC outputs speperated anywhere in the patch.</p>

<p>Another question:<br>I now implement the code in a patch/object. Is it somehow more perfomant to export it as a real object somehow? I dont know how to do it, but I am curious if it is worth trying out.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Increasing the 3khz control rate frequency'>
      <hr>
  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement'>
      <span itemprop='url'><b><a rel="next" itemprop="name" href="64274658.html?page=2">next page →</a></b></span>
  </div>





    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/increasing-the-3khz-control-rate-frequency/6427 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 17:15:19 GMT -->
</html>
