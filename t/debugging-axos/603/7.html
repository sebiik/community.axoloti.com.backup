<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/debugging-axos/603/7 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jul 2023 03:50:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Debugging axo&#39;s - AxoObject coding - Axoloti Community</title>
    <meta name="description" content="Hi guys, 

I&amp;#39;m working in an object and and it&amp;#39;s crashing after I added a pretty innocent line of code.  

	void setDecayTime(float f)
{
	static const float minTime = 1.0f;
	static const float maxTime = 2.0f;
	static con&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="../603.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Debugging axo&#39;s&#39;" href="../603-2.html" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/user_avatar/community.axoloti.com/johannes/200/8_1.png" />
<meta property="og:image" content="http://community.axoloti.com/user_avatar/community.axoloti.com/johannes/200/8_1.png" />
<meta property="og:url" content="http://community.axoloti.com/t/debugging-axos/603/7" />
<meta name="twitter:url" content="http://community.axoloti.com/t/debugging-axos/603/7" />
<meta property="og:title" content="Debugging axo&#39;s" />
<meta name="twitter:title" content="Debugging axo&#39;s" />
<meta property="og:description" content="For full debugging you need to connect an stlink   Or maybe inspecting the contents with objdump of the compiled patch can reveal the source of the issue? Maybe a stack overflow causing corruption?   Exceptions generally cause the microcontroller to log the source of the exception  and reboot and this is reported after booting." />
<meta name="twitter:description" content="For full debugging you need to connect an stlink   Or maybe inspecting the contents with objdump of the compiled patch can reveal the source of the issue? Maybe a stack overflow causing corruption?   Exceptions generally cause the microcontroller to log the source of the exception  and reboot and this is reported after booting." />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html"><img src="../../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="../603.html">Debugging axo&#39;s</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../../c/axoobject-code.html" itemprop="url">
        <span itemprop="title">AxoObject coding</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/fokke.html'><b itemprop='author'>fokke</b></a>
           
           <time datetime='2015-10-31T18:16:30Z' itemprop='datePublished'>
             2015-10-31 18:16:30 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi guys,</p>

<p>I'm working in an object and and it's crashing after I added a pretty innocent line of code. </p>

<pre><code>	void setDecayTime(float f)
{
	static const float minTime = 1.0f;
	static const float maxTime = 2.0f;
	static const float range = maxTime-minTime;
	decayTime = (f*range + minTime) * samplerate;
}</code></pre>

<p>If i remove that last line, everything is fine, but otherwise, it compiles but when it runs it does nothing (no sound, dsp load  is 0%)<br>How do you debug such a problem?  Running it in a debugger would be great of course, but maybe its possible to print to the console somehow? <br>The code runs fine on osx. </p>

<p>thanks.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2015-10-31T20:43:43Z' itemprop='datePublished'>
             2015-10-31 20:43:43 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hard to say why its crashing without seeing context....</p>

<p>you can insert logging, which gets sent to the Axoloti console:</p>

<pre><code>LogTextMessage(const char* format, ...)</code></pre>

<p>just use it in the same was as printf,  just be careful not to send too much logging. (board will disconnect if you do)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/fokke.html'><b itemprop='author'>fokke</b></a>
           
           <time datetime='2015-10-31T21:59:58Z' itemprop='datePublished'>
             2015-10-31 21:59:58 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks! I should be able to track down the problem with that.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/fokke.html'><b itemprop='author'>fokke</b></a>
           
           <time datetime='2015-11-01T19:01:35Z' itemprop='datePublished'>
             2015-11-01 19:01:35 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>After trying lots of different things, I concluded  there really isn't anything wrong with my code and tried setting the optimization level to -O2  in the Makefile.patch. That solved everything, although at a slight increase of cpu usage. I will try to turn on individual optimization flags to see what happens. Any one else run into this?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2015-11-01T19:43:14Z' itemprop='datePublished'>
             2015-11-01 19:43:14 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <ul>
<li>I haven't seen problems with -O3.</li>
<li>LogTextMessage uses chprintf rather than standard libc printf, and I think it is compiled without float support (CHPRINTF_USE_FLOAT).</li>
<li>I don't have enough context to understand what you're trying to do with the function at the top of this thread. </li>
<li>An empty patch shows 2% dsp load, if it shows 0% it may not have been loaded somehow?</li>
</ul>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/fokke.html'><b itemprop='author'>fokke</b></a>
           
           <time datetime='2015-11-02T15:42:00Z' itemprop='datePublished'>
             2015-11-02 15:42:00 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi Johannes,</p>

<p>I'm porting  a guitar multi FX o wrote of osx to axoloti. The code is bit too much to post here. The method above just sets some feedback level for the reverb and is called at krate.<br>The thing is, occasionally I get the 0% cpu after i have made some very minor change in code, which could not possibly cause any problems by itself.<br>I added some logging at initialization which is working normally, but when I get the "0%" none of the logging is printed to the console either, so maybe the patch isn't started somehow. But there are no compile errors and the console says:</p>

<pre><code>Done compiling patch
Start uploading patch
bin path: /Volumes/Intern/Users/fokke/Documents/axoloti/build/xpatch.bin
block uploaded @ 0x20011000 length 12980
Done uploading patch
Start starting patch
Done starting patch
Start locking
Done locking</code></pre>

<p>which makes me think everything is fine. Maybe the patch the patch is too big ? (perhaps unlikely at 12980 bytes). Could it be some kind of exception is happening?<br>Is there a way to turn on some more verbose logging?  </p>

<p>I mentioned in that setting set using -O2 rather than -O2 seems to solve the problem. But know i've changed that to<br>-O2 -finline-functions -funswitch-loops -fpredictive-commoning -fgcse-after-reload -ftree-loop-vectorize -ftree-loop-distribute-patterns -ftree-slp-vectorize -fvect-cost-model -ftree-partial-pre  -fipa-cp-clone</p>

<p>(which according to the gcc manual should do the same thing as -O3) And the patch runs fine (although is now only 9612 bytes) .....so i am a bit confused here.</p>

<p>Of course editing the Makefile is not really a permanent solution, and I don't think it actually fixes the real problem.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2015-11-03T13:05:36Z' itemprop='datePublished'>
             2015-11-03 13:05:36 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>For full debugging you need to connect an stlink<br><aside class="quote" data-post="1" data-topic="275">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="../../../user_avatar/community.axoloti.com/thetechnobear/40/6_1.png" class="avatar">
    <a href="../../low-level-firmware-debugging-via-swd/275.html">Low level firmware debugging (via SWD)</a> <a class="badge-wrapper  bullet" href="../../../c/software.html"><span class="badge-category-bg" style="background-color: #AB9364;"></span><span style="color: #FFFFFF;" data-drop-close="true" class="badge-category clear-badge" title="This category is for posts regarding the software of Axoloti, this includes the Axoloti patching GUI, Axoloti Objects (axo) and firmware. Please use the Patching category to discuss patching Axoloti. ">Software</span></a>
  </div>
  <blockquote>ok, this is not a support topic really just some ramblings on what I doing to try to do firmware debugging (just started) as it might help someone,  and also as a reminder to me [smile]   and thanks to <a class="mention" href="../../../users/johannes.html">@johannes</a> for helping me get this going! 

(Work in progress, I'll add more, as I learn more ) 

(no blame taken if you get it wrong and blow up your board... (very unlikely but still!)) 

Hardware connections

Find the label X3 pins (5 of them) , close to LEDs 

the board looks  something like thâ€¦
    <div class="topic-info">
    </div>
  </blockquote>
</aside>
<br>Or maybe inspecting the contents with objdump of the compiled patch can reveal the source of the issue?<br>Maybe a stack overflow causing corruption?</p>

<p>Exceptions generally cause the microcontroller to log the source of the exception <br>and reboot and this is reported after booting.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/fokke.html'><b itemprop='author'>fokke</b></a>
           
           <time datetime='2015-11-04T15:22:40Z' itemprop='datePublished'>
             2015-11-04 15:22:40 UTC
           </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi Johannes, thanks for your input. <br>The problem seems to have resolved itself again for some reason <img src="../../../images/emoji/emoji_one/smilea4f0.png?v=0" title=":smile:" class="emoji" alt=":smile:"> But the low level debugging is good to know.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2015-11-10T10:33:54Z' itemprop='datePublished'>
             2015-11-10 10:33:54 UTC
           </time>
        </span>
        <span itemprop='position'>#9</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Ive have seen major issues with optimisation ... it gets quite common when you start building more complex objects.</p>

<p>for me the issue was (and there are quite a lot of variations) is -O3 is very aggressive at inline coding,  this is partly down to the way axoloti creates everything into one file (xpatch.cpp) and so it appears to the compiler as being a likely candidate for inlining. this inlining obviously increases the memory footprint of the code <strong>significantly</strong> - when you use -O2 it reduces the likelihood of inlining.<br>however if you look at the GCC manual you will find there are preprocessor directives you can give to functions to explicitly tell the compiler to not inline.</p>

<p>(cpu performance obviously drops when you don't inline as its an extra function call, hence the art of performance tuning, deciding where you want to take the hit)</p>

<p>probably in the mid-term axoloti should allow for multiple source file includes, and also for compiler options to be specified.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/Katiska.html'><b itemprop='author'>Katiska</b></a>
           
           <time datetime='2015-12-29T21:26:45Z' itemprop='datePublished'>
             2015-12-29 21:26:45 UTC
           </time>
        </span>
        <span itemprop='position'>#10</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I stumbled upon a new open source embedded systems emulator called Emul8, and I'm wondering if that could be useful in some cases. The STM32F4 core is supposed to be supported at least, but I'm not sure about all the on-chip peripherals that Axoloti requires.</p>

<p><a href="http://emul8.org/get-started" class="onebox" target="_blank" rel="nofollow">http://emul8.org/get-started</a><br><a href="https://github.com/emul8/emul8" class="onebox" target="_blank" rel="nofollow">https://github.com/emul8/emul8</a></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2015-12-30T00:12:23Z' itemprop='datePublished'>
             2015-12-30 00:12:23 UTC
           </time>
        </span>
        <span itemprop='position'>#11</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I believe especially usb host+device and sdcard 'd be a lot of work to add in an emulator...<br>An emulator is possibly useful to step through some object code if there is only very little interaction between a test-patch and firmware. To debug objects I most often use patches in real time to diagnose object code, sometimes with some extra outlets added for diagnostics.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Debugging axo&#39;s'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../../index.html'>Home</a>
        <a href="../../../categories.html">Categories</a>
        <a href="../../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../../tos.html">Terms of Service</a>
        <a href="../../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/debugging-axos/603/7 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jul 2023 03:50:24 GMT -->
</html>
