<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/i2c-connectivity-could-you-clarify/2561 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Jul 2023 18:33:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>I2c connectivity - could you clarify - Hardware - Axoloti Community</title>
    <meta name="description" content="Hi guys, 

First of all apologies if this question has been answered before, I tried searching the forum but didn&amp;#39;t find a clear answer. I am new to axoloti but I am experienced with electronics, Pure Data and C coding, &amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="2561.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;I2c connectivity - could you clarify&#39;" href="2561.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/i2c-connectivity-could-you-clarify/2561" />
<meta name="twitter:url" content="http://community.axoloti.com/t/i2c-connectivity-could-you-clarify/2561" />
<meta property="og:title" content="I2c connectivity - could you clarify" />
<meta name="twitter:title" content="I2c connectivity - could you clarify" />
<meta property="og:description" content="Hi guys,   First of all apologies if this question has been answered before, I tried searching the forum but didn&#39;t find a clear answer. I am new to axoloti but I am experienced with electronics, Pure Data and C coding, Arduino etc. so this questions is more about specific Axoloti implementation.   I am connecting 8 buttons and 8 LEDs to axoloti via i2c, using the MCP23017-E/SP chip. I have used this setup plenty of times with arduino and I am confident about the hardware side of things.   I am ..." />
<meta name="twitter:description" content="Hi guys,   First of all apologies if this question has been answered before, I tried searching the forum but didn&#39;t find a clear answer. I am new to axoloti but I am experienced with electronics, Pure Data and C coding, Arduino etc. so this questions is more about specific Axoloti implementation.   I am connecting 8 buttons and 8 LEDs to axoloti via i2c, using the MCP23017-E/SP chip. I have used this setup plenty of times with arduino and I am confident about the hardware side of things.   I am ..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="4 ❤" />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="http://community.axoloti.com/uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="2561.html">I2c connectivity - could you clarify</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/hardware.html" itemprop="url">
        <span itemprop="title">Hardware</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/pawelgrudzien.html'><b itemprop='author'>pawelgrudzien</b></a>
           
           <time datetime='2016-11-23T11:28:57Z' itemprop='datePublished'>
             2016-11-23 11:28:57 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi guys,</p>

<p>First of all apologies if this question has been answered before, I tried searching the forum but didn't find a clear answer. I am new to axoloti but I am experienced with electronics, Pure Data and C coding, Arduino etc. so this questions is more about specific Axoloti implementation.</p>

<p>I am connecting 8 buttons and 8 LEDs to axoloti via i2c, using the MCP23017-E/SP chip. I have used this setup plenty of times with arduino and I am confident about the hardware side of things.</p>

<p>I am having difficulty figuring out how to setup Axoloti on the software side. I added the i2c config object and I hooked up the chip to PB8 and PB9 pins. I'd like to get 8 boolean outputs (from the switches) and 8 boolean inputs (for the LEDs). What script code should I use to communicate with the chip? Basically, how to setup GPA ports to read and GPB ports to write and how to read/send data between them and axoloti?</p>

<p>I am also using two MCP3208 chips to read 16 pots and the setup was quite straightforward, I just modified the example code from the forum. So if you could point me in the right direction regarding the i2c communication with the MCP23017 that would be fantastic.</p>

<p>Thank you.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='I2c connectivity - could you clarify'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/johannes.html'><b itemprop='author'>johannes</b></a>
           
           <time datetime='2016-11-23T12:53:17Z' itemprop='datePublished'>
             2016-11-23 12:53:17 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I have no code available for the MCP23017, but here's a quick outline:</p>

<p>The I2C communication needs to happen outside the audio processing workload, otherwise buffer underruns will occur cause by waiting time for communication to complete (or fail), to do this we need a "thread". The "script/script2" object shows how to do this, but does not provide the inlets/outlets you want for this application, so we need to customize it.</p>

<ul>
<li>create a "script/script2" object in a patch, and in the object popup menu, select "embed as patch/object"</li>
<li>in the object popup menu of the resulting "patch/object", select "edit". </li>
<li>in the <em>inlets</em> tab, create 8 inlets of the "bool32" type (in1, in2,...in8)</li>
<li>in the <em>outlets</em> tab, create 8 outlets of the "bool32" type (out1, out2,...out8)</li>
<li>in the <em>local data</em> tab, replace the declaration of in1, in2, out1, out2 with 8 booleans for input and 8 booleans for output<br><code>bool in1, in2, in3, in4, in5, in6, in7, in8;<br>bool out1, out2, out3, out4, out5, out6, out7, out8;</code><br>leave the rest of the <em>local data</em> code untouched, this sets up a thread</li>
<li>in the <em>k-rate</em> tab, all inlet values need to be copied to the local data, and all output local data needs to be copied to the respective outlets:<br><code>outlet_out1 = this-&gt;out1;</code><br><code>this-&gt;in1 = inlet_in1;</code><br>etc.</li>
<li>close the object editor, you'll see the inlets/outlets in the "patch/object"</li>
<li>in the object, click the *script edit" button, a text editor window pops open</li>
<li>in that script you'll need something like:<br><code>void setup(void){<br>}<br>void loop(void){<br>}<br></code>arduino style...</li>
<li>For interacting with I2C, use the Chibios I2C Driver : <a href="http://chibios.sourceforge.net/html/group___i2_c.html">documentation</a>, use <code>&amp;I2CD1</code> for I2CDriver. Most relevant calls are <code>i2cMasterTransmitTimeout()</code> and <code>i2cMasterReceiveTimeout()</code>. <br>I do recommend to use a sensible timeout value (can be obtained by the macro <code>MS2ST(milliseconds)</code>, and avoid making a loop inside the <code>void loop(void)...</code> code that does not terminate unconditionally, otherwise you may get a "zombie" thread.<br>To configure the I2C driver and GPIO pins, you can use the <code>gpio/i2c/config</code> object. </li>
<li>GPIOB,8 is SCL, GPIOB,9 is SDA. Changing the I/O pins to different ones will not work.</li>
<li>
<strong>important:</strong> the I2C driver uses DMA (direct memory access) to relieve the processor from copying bytes, but this only works for data that is in suitable memory, which can be declared like this:<br><code>static uint8_t txbuf[8] __attribute__ ((section (".sram2")));<br>static uint8_t rxbuf[8] __attribute__ ((section (".sram2")));</code>
</li>
<li>for debugging, the LogTextMessage() call is useful, works like printf(), but too intensive logging can disrupt communications.</li>
</ul>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:2'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='I2c connectivity - could you clarify'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/pawelgrudzien.html'><b itemprop='author'>pawelgrudzien</b></a>
           
           <time datetime='2016-11-23T16:14:37Z' itemprop='datePublished'>
             2016-11-23 16:14:37 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thank you, this clarifies things. If I understand correctly, I have to implement the specific protocol my I2C chip is using.</p>

<p>On Arduino there is a library called Wire which works with MCP23017 out of the box. I might port specific functions to my script (configuring the pull up on specific pin, setting pins as IN/OUT - there are a few more functions available). I will update this thread if I get it working.</p>

<p>I think it will be worthwhile getting the MCP23017 working with Axoloti as it is a fantastic chip - it has 16 individually configurable IN/OUT pins with built in pull up resistor (configurable per pin as well). More than one can be used with the same 2 pins on Axoloti. As it is I2C it can be used for less time demanding functions, like reading buttons, toggle switches, controlling LEDs etc. That frees up the SPI bus for reading pots and similar.</p>

<p>Thank you again for your help.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:2'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='I2c connectivity - could you clarify'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/soren1.html'><b itemprop='author'>soren1</b></a>
           
           <time datetime='2018-10-02T16:52:30Z' itemprop='datePublished'>
             2018-10-02 16:52:30 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../u/pawelgrudzien.html">@pawelgrudzien</a>  ondering if you managed to get the mcp20317 working with the axoloti? Am considering buying an axolotiy, but i need to know if I can get the mcp hooked up or not. otherwise I won't have enough pins for my project <img src="http://community.axoloti.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='I2c connectivity - could you clarify'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/i2c-connectivity-could-you-clarify/2561 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Jul 2023 18:33:29 GMT -->
</html>
