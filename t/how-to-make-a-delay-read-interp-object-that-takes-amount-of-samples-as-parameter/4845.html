<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/how-to-make-a-delay-read-interp-object-that-takes-amount-of-samples-as-parameter/4845 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Jul 2023 18:37:32 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>How to make a `delay/read_interp` object that takes amount of samples as parameter? - Patching - Axoloti Community</title>
    <meta name="description" content="I&amp;#39;m trying to modify the delay/read_interp object so that it takes an amount of samples (or in other words amount of s-rate cycles) as parameter instead of the &amp;quot;kind of percentage&amp;quot; parameter it takes by default. What I&amp;#39;d&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="https://sebiik.github.io/community.axoloti.com.backup/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="4845.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;How to make a `delay/read_interp` object that takes amount of samples as parameter?&#39;" href="4845.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/how-to-make-a-delay-read-interp-object-that-takes-amount-of-samples-as-parameter/4845" />
<meta name="twitter:url" content="http://community.axoloti.com/t/how-to-make-a-delay-read-interp-object-that-takes-amount-of-samples-as-parameter/4845" />
<meta property="og:title" content="How to make a `delay/read_interp` object that takes amount of samples as parameter?" />
<meta name="twitter:title" content="How to make a `delay/read_interp` object that takes amount of samples as parameter?" />
<meta property="og:description" content="I&#39;m trying to modify the delay/read_interp object so that it takes an amount of samples (or in other words amount of s-rate cycles) as parameter instead of the &quot;kind of percentage&quot; parameter it takes by default. What I&#39;d like to do is, say the delay/write is 256 samples and I&#39;d like to use half of that is pass 128 into the time parameter.   This is the s-rate code from the delay/read_interp object:     uint32_t tmp_d =  __USAT(param_time + inlet_time,27); uint32_t tmp_di = attr_delayname.writepo..." />
<meta name="twitter:description" content="I&#39;m trying to modify the delay/read_interp object so that it takes an amount of samples (or in other words amount of s-rate cycles) as parameter instead of the &quot;kind of percentage&quot; parameter it takes by default. What I&#39;d like to do is, say the delay/write is 256 samples and I&#39;d like to use half of that is pass 128 into the time parameter.   This is the s-rate code from the delay/read_interp object:     uint32_t tmp_d =  __USAT(param_time + inlet_time,27); uint32_t tmp_di = attr_delayname.writepo..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ❤" />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="http://community.axoloti.com/uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="4845.html">How to make a `delay/read_interp` object that takes amount of samples as parameter?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/patching.html" itemprop="url">
        <span itemprop="title">Patching</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/simonvanderveldt.html'><b itemprop='author'>simonvanderveldt</b></a>
           
           <time datetime='2018-08-04T15:18:47Z' itemprop='datePublished'>
             2018-08-04 15:18:47 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I'm trying to modify the <code>delay/read_interp</code> object so that it takes an amount of samples (or in other words amount of s-rate cycles) as parameter instead of the "kind of percentage" parameter it takes by default.<br>What I'd like to do is, say the <code>delay/write</code> is <code>256</code> samples and I'd like to use half of that is pass <code>128</code> into the <code>time</code> parameter.</p>

<p>This is the s-rate code from the <code>delay/read_interp</code> object:<br></p>

<p></p><pre><code class="lang-auto">uint32_t tmp_d =  __USAT(param_time + inlet_time,27);
uint32_t tmp_di = attr_delayname.writepos - (tmp_d&gt;&gt;(27-attr_delayname.LENGTHPOW)) - BUFSIZE + buffer_index -1;
uint32_t tmp_w1 = (tmp_d&lt;&lt;(attr_delayname.LENGTHPOW+3)) &amp; 0x3FFFFFFF;
uint32_t tmp_w2 = (1&lt;&lt;30) - tmp_w1;
int32_t tmp_a1 = attr_delayname.array[tmp_di&amp;attr_delayname.LENGTHMASK]&lt;&lt;16;
int32_t tmp_a2 = attr_delayname.array[(tmp_di+1)&amp;attr_delayname.LENGTHMASK]&lt;&lt;16;
int32_t tmp_r = ___SMMUL(tmp_a1,tmp_w1);
tmp_r = ___SMMLA(tmp_a2,tmp_w2,tmp_r);
outlet_out= tmp_r;</code></pre>

<p>I tried to make sense of it, but I have no clue why all the bitshifting is happening and where the (to me) "magic" values like <code>3</code>, <code>0x3FFFFFFF</code> and <code>30</code> come from.<br>Does anyone have an idea how to rewrite this so it takes samples/s-rate cycle count as input?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='How to make a `delay/read_interp` object that takes amount of samples as parameter?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2018-08-05T00:08:24Z' itemprop='datePublished'>
             2018-08-05 00:08:24 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../u/simonvanderveldt.html">@simonvanderveldt</a></p>

<p>You dont need to edit anything inside that object, to do what you want to do. You just need to scale whatever you send to time inlet. The specific example you give with 256 samples and then use 128 samples is pretty easy:<br>If you set the delay write delay time to the 256 samples and you want to set a delay time of 128 samples you can do it like this:</p>

<p><img src="http://community.axoloti.com/uploads/default/original/2X/d/d28d5a44c4748e6cb9277abeb3e25e4facf5b85c.png" width="569" height="282"></p>

<p>Beside that you can probably find some object that converts samples to krate values, so you can set the values with real numbers. I think Sir Sick Sik maybe has got one called sss/timers/Clock2Timing. Try it out. It actualle needs some trigger inputs and then it calculates the speed from the time between 2 triggers. But I think you can probably hack that object, bypass the trigger values and simply just type in the values in samples.</p>

<aside class="quote" data-post="1" data-topic="4845"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="http://community.axoloti.com/letter_avatar_proxy/v2/letter/s/5daacb/40.png" class="avatar">simonvanderveldt:</div>
<blockquote><p>I tried to make sense of it, but I have no clue why all the bitshifting is happening and where the (to me) "magic" values like 3, 0x3FFFFFFF and 30 come from.<br>Does anyone have an idea how to rewrite this so it takes samples/s-rate cycle count as input?</p></blockquote></aside>

<p>Sorry I cant give you a meaningful explanation for this, someone else with a deeper understanding of code have to give you that one, but YES... all the bitshifting also drove me nuts to start with. But I think it has to do with that Axoloti is a board with very limited resources and bitshifting values to a smaller scale saved memory, CPU etc.... But don't hang  for this, I am just thinking out loud, hehe <img src="http://community.axoloti.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> </p>

<p>Regarding the bitshifting, I would advice you to use some of the display objects, so you can see what is actually going on when you bitshift.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='How to make a `delay/read_interp` object that takes amount of samples as parameter?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/deadsy.html'><b itemprop='author'>deadsy</b></a>
           
           <time datetime='2018-08-05T01:41:55Z' itemprop='datePublished'>
             2018-08-05 01:41:55 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <blockquote><p>I tried to make sense of it, but I have no clue why all the bitshifting is happening and where the (to me) "magic" values like 3, 0x3FFFFFFF and 30 come from.</p></blockquote>

<p>They're coming from the use of fixed point math (Q5.27 values in this case). The code for fixed point math is often efficient at the cost of being a bit "write-only".</p>

<p>tmp_di is the index into the array<br>tmp_a* are the values of the array.<br>tmp_w* are the relative weight of the di and di+1 sample. (scaled to 1 &lt;&lt; 30)<br>The smmul/smmla is the actual LERP computation.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='How to make a `delay/read_interp` object that takes amount of samples as parameter?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/jaffasplaffa.html'><b itemprop='author'>jaffasplaffa</b></a>
           
           <time datetime='2018-08-05T08:28:46Z' itemprop='datePublished'>
             2018-08-05 08:28:46 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../u/deadsy.html">@deadsy</a></p>

<p>Thanks for elaborating it.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='How to make a `delay/read_interp` object that takes amount of samples as parameter?'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/thetechnobear.html'><b itemprop='author'>thetechnobear</b></a>
           
           <time datetime='2018-08-05T13:35:22Z' itemprop='datePublished'>
             2018-08-05 13:35:22 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>note: this is 'off the top of my head', so I might be missing something, as Ive not tested below, but hopefully gives you the general idea of what to try.</p>

<aside class="quote" data-post="1" data-topic="4845"><div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="http://community.axoloti.com/letter_avatar_proxy/v2/letter/s/5daacb/40.png" class="avatar">simonvanderveldt:</div>
<blockquote><p>uint32_t tmp_di = attr_delayname.writepos - (tmp_d&gt;&gt;(27-attr_delayname.LENGTHPOW)) - BUFSIZE + buffer_index -1;</p></blockquote></aside>

<p>basically this is the line you want to change... because your using samples directly, basically (tmp_d&gt;&gt;(27-attr_delayname.LENGTHPOW)) is calculating number of samples.</p>

<p>however, given you are given a particular sample, rather than a time, you also don't need to 'interp' it, since you will always fall on a particular sample. this means you can ditch tmp_w1/w2 and tmp_a2.<br>(the shift 16 might also have to change, but id have to go check the code a bit more to know for sure)</p>

<p>note: the adding of LENGTHMASK is being used to keep the sample read in range, and also wrapping.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='How to make a `delay/read_interp` object that takes amount of samples as parameter?'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/how-to-make-a-delay-read-interp-object-that-takes-amount-of-samples-as-parameter/4845 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Jul 2023 18:37:33 GMT -->
</html>
