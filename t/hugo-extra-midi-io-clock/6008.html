<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/hugo-extra-midi-io-clock/6008 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jul 2023 03:03:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Hugo Extra Midi IO / Clock - AxoObject coding - Axoloti Community</title>
    <meta name="description" content="Has anyone here used the script by @Hugo to send midi clock via Pin Pa2? I&amp;#39;m not enough of a coder to write this myself...">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="6008.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Hugo Extra Midi IO / Clock&#39;" href="6008.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:image" content="http://community.axoloti.com/uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png" />
<meta property="og:url" content="http://community.axoloti.com/t/hugo-extra-midi-io-clock/6008" />
<meta name="twitter:url" content="http://community.axoloti.com/t/hugo-extra-midi-io-clock/6008" />
<meta property="og:title" content="Hugo Extra Midi IO / Clock" />
<meta name="twitter:title" content="Hugo Extra Midi IO / Clock" />
<meta property="og:description" content="Has anyone here used the script by @Hugo to send midi clock via Pin Pa2? I&#39;m not enough of a coder to write this myself..." />
<meta name="twitter:description" content="Has anyone here used the script by @Hugo to send midi clock via Pin Pa2? I&#39;m not enough of a coder to write this myself..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="2 ❤" />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="6008.html">Hugo Extra Midi IO / Clock</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/axoobject-code.html" itemprop="url">
        <span itemprop="title">AxoObject coding</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Blindsmyth.html'><b itemprop='author'>Blindsmyth</b></a>
           
           <time datetime='2019-09-18T14:33:41Z' itemprop='datePublished'>
             2019-09-18 14:33:41 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Has anyone here used the script by <a class="mention" href="../../u/hugo-2.html">@Hugo</a> to send midi clock via Pin Pa2? I'm not enough of a coder to write this myself...</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Hugo Extra Midi IO / Clock'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/DrKoma.html'><b itemprop='author'>DrKoma</b></a>
           
           <time datetime='2021-01-17T14:42:17Z' itemprop='datePublished'>
             2021-01-17 14:42:17 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hey there <a class="mention" href="../../u/blindsmyth-2.html">@Blindsmyth</a>.<br>I was trying to archieve the same and failed . <br>Reading the midi docs and a tutorial for arduino , I could successfully "infer?"  the way to do it in axo world.<br>Here is the patch , original extra_io_midi , with the added code . But I attach also the needed code modification ( or just copy all and replace ) the receiving script object</p>

<p><a class="attachment" href="../../uploads/default/original/2X/4/extra_midi_io_clk.axp">extra_midi_io_clk.axp</a> (8.5 KB)</p>

<p></p><pre><code class="lang-auto">    uint8_t StatusToMsgLength(uint8_t t){
    switch(t) {
    case 0x0:
    case 0x1:
    case 0x2:
    case 0x3:
    case 0x4:
    case 0x5:
    case 0x6:
    case 0x7:
        return 0;
    case 0x8:
    case 0x9:
    case 0xa:
    case 0xb:
        return 3;
    case 0xc:
    case 0xd:
        return 2;
    case 0xe:
        return 3;
    default:
        return -1;
    }
  }

  uint8_t SysToMsgLength(uint8_t t){
    switch(t) {
    case 0x0:
        return -1; // 0xf0=sysex start. may vary
    case 0x1:
        return 2; // 0xf1=MIDI Time Code. 2 bytes
    case 0x2:
        return 3; // 0xf2=MIDI Song position. 3 bytes
    case 0x3:
        return 2; // 0xf3=MIDI Song Select. 2 bytes.
    case 0x4:
        return 1; // 0xf4=undefined
    case 0x5:
        return 1; // 0xf5=undefined
    case 0x6:
        return 1; // 0xf6=TUNE Request
    case 0x7:
        return 1; // 0xf7=sysex end.
    case 0x8:
        return 1; // 0xf8=timing clock. 1 byte
    case 0x9:
        return 1; // 0xf9=proposed measure end?
    case 0xa:
        return 1; // 0xfa=start. 1 byte
    case 0xb:
        return 1; // 0xfb=continue. 1 byte
    case 0xc:
        return 1; // 0xfc=stop. 1 byte
    case 0xd:
        return 1; // 0xfd=undefined
    case 0xe:
        return 1; // 0xfe=active sensing. 1 byte
    case 0xf:
    default:
        return 3; // 0xff= not reset, but a META-EVENT, which is always 3 bytes
    }
  }

  unsigned char MidiByte0;
  unsigned char MidiByte1;
  unsigned char MidiByte2;
  unsigned char MidiCurData;
  unsigned char MidiNumData;

  uint8_t port = 0;

  void setup(){
  MidiNumData = 0;
  MidiCurData = 0;
  }

  void MidiInByteHandler(uint8_t data) {
  int8_t len;

      if(data &amp; 0xf8){
MidiInMsgHandler(MIDI_DEVICE_INTERNAL,port,0xf8,0,0);
}
  if (data &amp; 0x80) {
    len = StatusToMsgLength(data &gt;&gt; 4);
    if (len == -1) {
      len = SysToMsgLength(data - 0xF0);
    }
    if (len == 1) {
      MidiInMsgHandler(MIDI_DEVICE_INTERNAL,port,data,0,0);
    } else {
      MidiByte0 = data;
      MidiNumData = len - 1;
      MidiCurData = 0;
    }
  }
  // FILTER AND SEND CLOCK MESSAGE

  else // not a status byte
  {
  	 
    if (MidiCurData == 0) {
      MidiByte1 = data;
      if (MidiNumData == 1) {
        // 2 byte message complete
        MidiInMsgHandler(MIDI_DEVICE_INTERNAL,port,MidiByte0, MidiByte1,0);
        
        MidiCurData = 0;
      }
      else
        MidiCurData++;
    }
    else if (MidiCurData == 1) {
      MidiByte2 = data;
      if (MidiNumData == 2) {
          MidiInMsgHandler(MIDI_DEVICE_INTERNAL,port,MidiByte0, MidiByte1, MidiByte2);
        MidiCurData = 0;
      }
    }
  }
  //LogTextMessage("data, %d",data);
  }
  void loop(){
    while(!sdGetWouldBlock(&amp;SD2))
    {
            char ch = sdGet(&amp;SD2);
            MidiInByteHandler(ch);
        }	
  }</code></pre>

<p>so no start/stop etc just yet big shout out to <a class="mention" href="../../u/hugo-2.html">@Hugo</a>  for this wonderful code. You guys could try and let me know , im not really sure if I correctly did this step in particular , but hey , my Ibar 16 is happy and dancing via UART</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Hugo Extra Midi IO / Clock'>
      <hr>
            <a href="../raspberry-pi-as-hub-for-usb-midi-devices-advice/3110/20.html">Raspberry Pi as hub for USB midi devices - advice?</a>
            <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/DrKoma.html'><b itemprop='author'>DrKoma</b></a>
           
           <time datetime='2021-01-17T16:18:51Z' itemprop='datePublished'>
             2021-01-17 16:18:51 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Fixed the error I had before, but still doesnt really works . If I send just midi clock it wont update the clock out. Only when receiving other data , something with the midi callback , hope someone can throw some light on this</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Hugo Extra Midi IO / Clock'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Blindsmyth.html'><b itemprop='author'>Blindsmyth</b></a>
           
           <time datetime='2021-01-17T22:42:28Z' itemprop='datePublished'>
             2021-01-17 22:42:28 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>he there! I have gotten this to work eventually but I don't find the patch right now and I'm too toasted from work.</p>

<p>this is a patch with a modified cc out thing object to send via the serial pins. <br>its not that hard, you have to define your midi function in the local part and then call it in the k-rate part.<br>just compare the codes, you can figure it out.<br><a class="attachment" href="../../uploads/default/original/2X/7/xtra%20io%20clock.axp">xtra io clock.axp</a> (6.8 KB)</p>

<p>otherwise i can still look for my clock object tomorrow. good night!</p>

<p>EDIT: found it! too tired to test, but i remember i had it working<br><a class="attachment" href="../../uploads/default/original/2X/7/xtra%20midi%20clock.axp">xtra midi clock.axp</a> (1.7 KB)</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Hugo Extra Midi IO / Clock'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/DrKoma.html'><b itemprop='author'>DrKoma</b></a>
           
           <time datetime='2021-01-18T14:32:54Z' itemprop='datePublished'>
             2021-01-18 14:32:54 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hm , not working here . But I see what you mean I guess.<br>I just realised that you wanted to output midi clock while Im trying to receive it on PA1 and route it to internal.<br>But yes would be cool to archieve this too .</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Hugo Extra Midi IO / Clock'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/hugo-extra-midi-io-clock/6008 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jul 2023 03:03:41 GMT -->
</html>
