<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from community.axoloti.com/t/make-a-usb-midi-controller-with-16-to-27-analog-inputs-for-cheap/3866?source_topic_id=6681 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:43:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Make a USB midi controller with 16 (to 27) analog inputs for cheap! - Hardware - Axoloti Community</title>
    <meta name="description" content="Hi everyone! Here&amp;#39;s how to make a USB midi controller for dirt cheap!  This one has has a red breakoutboard that you can attach 16 analog potentiometers to. The user @SmashedTransistors reminded me that If you choose to &amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 1.9.0.beta3 - https://github.com/discourse/discourse version 13f3de4bf673802eb8ec595d36587b4524773209">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<link rel="icon" sizes="144x144" href="../../uploads/default/original/1X/ffed196003990f0e5c2a0f8227fc977345cd68be.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="3866.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"http://community.axoloti.com","potentialAction":{"@type":"SearchAction","target":"http://community.axoloti.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Axoloti Community Search">

        <link href="../../stylesheets/desktop_d93a33ca8617326fe353f80e6ab865188244d48c8e0b.css?__ws=community.axoloti.com" media="all" rel="stylesheet" data-target="desktop"/>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56017691-4', {"cookieDomain":"auto"});
</script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Make a USB midi controller with 16 (to 27) analog inputs for cheap!&#39;" href="3866.rss" />
  <meta property="og:site_name" content="Axoloti Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://i.imgur.com/i63aWzf.png" />
<meta property="og:image" content="https://i.imgur.com/i63aWzf.png" />
<meta property="og:url" content="http://community.axoloti.com/t/make-a-usb-midi-controller-with-16-to-27-analog-inputs-for-cheap/3866?source_topic_id=6681" />
<meta name="twitter:url" content="http://community.axoloti.com/t/make-a-usb-midi-controller-with-16-to-27-analog-inputs-for-cheap/3866?source_topic_id=6681" />
<meta property="og:title" content="Make a USB midi controller with 16 (to 27) analog inputs for cheap!" />
<meta name="twitter:title" content="Make a USB midi controller with 16 (to 27) analog inputs for cheap!" />
<meta property="og:description" content="Hi everyone! Here&#39;s how to make a USB midi controller for dirt cheap!  This one has has a red breakoutboard that you can attach 16 analog potentiometers to. The user @SmashedTransistors reminded me that If you choose to utilize the remaining analog inputs on the Teensy then this project will end up adding up to 27 inputs!!!   what you&#39;ll need:    1 Teensy LC ---&gt; buy from pjrc $11.65 1  CD74HC4067 breakout board ---&gt; buy from sparkfun ($4.95) 1 to 16 10k linear B potentiometers. ---&gt; buy from eb..." />
<meta name="twitter:description" content="Hi everyone! Here&#39;s how to make a USB midi controller for dirt cheap!  This one has has a red breakoutboard that you can attach 16 analog potentiometers to. The user @SmashedTransistors reminded me that If you choose to utilize the remaining analog inputs on the Teensy then this project will end up adding up to 27 inputs!!!   what you&#39;ll need:    1 Teensy LC ---&gt; buy from pjrc $11.65 1  CD74HC4067 breakout board ---&gt; buy from sparkfun ($4.95) 1 to 16 10k linear B potentiometers. ---&gt; buy from eb..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="20 ❤" />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/b22e6e9ef608f1e17a1de19b733d043beff77f05.png" alt="Axoloti Community" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="3866.html">Make a USB midi controller with 16 (to 27) analog inputs for cheap!</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/hardware.html" itemprop="url">
        <span itemprop="title">Hardware</span>
      </a>
    </div>
</div>

    <div class='tags-list' itemscope itemtype='http://schema.org/ItemList'>
        <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
          <meta itemprop='url' content='../../tags/controllers.html'>
          <a href='../../tags/controllers.html' itemprop='item'>
            <span itemprop='name'>controllers</span>
          </a>
        </div>
    </div>




<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Androoclops.html'><b itemprop='author'>Androoclops</b></a>
           
           <time datetime='2017-10-21T20:48:41Z' itemprop='datePublished'>
             2017-10-21 20:48:41 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi everyone!<br>Here's how to make a USB midi controller for dirt cheap! <br>This one has has a red breakoutboard that you can attach 16 analog potentiometers to.<br>The user <a class="mention" href="../../u/smashedtransistors-2.html">@SmashedTransistors</a> reminded me that If you choose to utilize the remaining analog inputs on the Teensy then this project will end up adding up to <strong>27 inputs!!!</strong></p>

<p>what you'll need:</p>

<ul>
<li>1 Teensy LC ---&gt; <a href="https://www.pjrc.com/store/teensylc.html" rel="nofollow noopener">buy from pjrc</a> $11.65</li>
<li>1  CD74HC4067 breakout board ---&gt; <a href="https://www.sparkfun.com/products/9056" rel="nofollow noopener">buy from sparkfun</a> ($4.95)</li>
<li>1 to 16 10k linear B potentiometers. ---&gt; <a href="http://www.ebay.ca/itm/5pcs-B10K-10Kohm-Linear-Taper-Rotary-Potentiometer-Panel-Pot-/232421935652?hash=item361d6d4a24:g:YGMAAOSw0UNZdVR1" rel="nofollow noopener">buy from ebay</a> (5pc for $1.25)</li>
<li>1 Breadboard -----&gt; <a href="http://www.ebay.ca/itm/1PCS-Mini-Prototype-Solderless-Breadboard-400-Contacts-For-arduino-Raspberry-pi-/151909047511?hash=item235e7c1cd7:g:6AMAAOSw7FRWZlbJ" rel="nofollow noopener">buy from ebay</a> ($1.50)</li>
<li>Wire....pennies per ft! buy lots because its always handy to have lots of.</li>
</ul>

<p><strong>Step 1:</strong><br>Once you have all these items wire them up together like this...for simplicity sake only 3 potentiometers are shown but you can connect 16, just remember to connect any additional pots to +/- and the center pins of the potentiometers go to the "C" pins on the red breakout board. <br>          <a href="../../../i.imgur.com/i63aWzf.png" target="_blank" rel="nofollow noopener">
            <img src="../../../i.imgur.com/i63aWzf.png" width="690" height="446">
          </a>
</p>

<p><strong>Step 2:</strong><br>Install Arduino 1.8.4 (newer versions don't support teensy LC yet <img src="../../images/emoji/twitter/frowningae52.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"> )<br>Get it here ---&gt;  <a href="https://www.arduino.cc/en/Main/OldSoftwareReleases" rel="nofollow noopener">https://www.arduino.cc/en/Main/OldSoftwareReleases</a></p>

<p><strong>Step 3:</strong><br>Install the Teensy loader application <br>Get it here ---&gt; <a href="https://www.pjrc.com/teensy/loader.html" rel="nofollow noopener">https://www.pjrc.com/teensy/loader.html</a></p>

<p><strong>Step 4:</strong><br>Plug your Teensy into your computer via usb...</p>

<p><strong>Step 5:</strong><br>Open Arduino 1.8.4 and click "tools" and then set the board type to Teensy LC<br>          <a href="../../../i.imgur.com/mBqmiNm.png" target="_blank" rel="nofollow noopener">
            <img src="../../../i.imgur.com/mBqmiNm.png" width="690" height="395">
          </a>
</p>

<p><strong>Step 6:</strong><br>Click tools and also set the USB type to MIDI<br>          <a href="../../../i.imgur.com/qLzFDnu.png" target="_blank" rel="nofollow noopener">
            <img src="../../../i.imgur.com/qLzFDnu.png" width="690" height="435">
          </a>
</p>

<p><strong>Step 7:</strong><br>Delete the "void setup" and "loop setup" code so you have a nice blank page in arduino. <br>          <a href="../../../i.imgur.com/ViDcOmL.png" target="_blank" rel="nofollow noopener">
            <img src="../../../i.imgur.com/ViDcOmL.png" width="690" height="426">
          </a>
</p>

<p><strong>Step 8:</strong><br>Paste this code into the blank page</p>

<pre><code>//************LIBRARIES USED**************
// include the ResponsiveAnalogRead library for analog smoothing
#include &lt;ResponsiveAnalogRead.h&gt;
//usbMIDI.h library is added automatically when code is compiled as a MIDI device

// ******CONSTANT VALUES******** 
// customize code behaviour here!
const int muxTimeMin = 500; // minimum micro-seconds between MUX reads 
const int channel = 1; // MIDI channel
const int MUX_PINS = 16; // number of MUX Channnels

// define the CC ID numbers on which to send them..

const int CCID[MUX_PINS] = {70,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36};


//******VARIABLES***********
// a data array and a lagged copy to tell when MIDI changes are required
byte data[MUX_PINS];
byte dataLag[MUX_PINS]; // when lag and new are not the same then update MIDI CC value
byte i=0; // global index for MUX channel reads

//mapping of mux to teensy digital pins
int pin_Out_S0 = 4;
int pin_Out_S1 = 3;
int pin_Out_S2 = 2;
int pin_Out_S3 = 1;
int pin_In_Mux1 = A0;


//****** TIMER VARIABLE *** change scale here!
elapsedMicros mux1Updated; // switch to micros to run at speed and tune with muxTimeMin setting above
//elapsedMillis mux1Updated; // switch to millis to troubleshoot 

//************INITIALIZE LIBRARY OBJECTS**************
// initialize the ReponsiveAnalogRead objects
ResponsiveAnalogRead analog[]{
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true},
  {pin_In_Mux1 ,true}
}; 



//************SETUP**************
void setup() {
  //! don't forget to set for output!
  pinMode(pin_Out_S0, OUTPUT);
  pinMode(pin_Out_S1, OUTPUT);
  pinMode(pin_Out_S2, OUTPUT);
  pinMode(pin_Out_S3, OUTPUT);
}

//************LOOP**************
void loop() {
  nextMUXpin();
  while (usbMIDI.read()) {
     // controllers must call .read() to keep the queue clear even if they are not responding to MIDI
  }
}


//************MUX SECTION**************
void nextMUXpin(){  
  if (mux1Updated&gt;muxTimeMin) {  
    // update the ResponsiveAnalogRead object every loop
    analog[i].update(); 
    // if the repsonsive value has change, print out 'changed'
    if(analog[i].hasChanged()) {
      data[i] = analog[i].getValue()&gt;&gt;3;
      if (data[i] != dataLag[i]){
        dataLag[i] = data[i];
        usbMIDI.sendControlChange(CCID[i], data[i], channel);
        serialPringMIDIdata(); // use to troublshoot
      }
    }  

    //reset timer
    mux1Updated = 0; 
    //increment index
    i++;
    if (i&gt;15)   {i=0;}      
    // set mux control pins for next pass
    digitalWrite(pin_Out_S0, HIGH &amp;&amp; (i &amp; B00000001));
    digitalWrite(pin_Out_S1, HIGH &amp;&amp; (i &amp; B00000010));
    digitalWrite(pin_Out_S2, HIGH &amp;&amp; (i &amp; B00000100));
    digitalWrite(pin_Out_S3, HIGH &amp;&amp; (i &amp; B00001000));
  }
}

// **useful for debugging, comment out function call to run full speed
void serialPringMIDIdata(){
  Serial.print(i,DEC);
  Serial.print(" :");
  Serial.print(HIGH &amp;&amp; (i &amp; B00000001),BIN);
  Serial.print(HIGH &amp;&amp; (i &amp; B00000010),BIN);
  Serial.print(HIGH &amp;&amp; (i &amp; B00000100),BIN);
  Serial.print(HIGH &amp;&amp; (i &amp; B00001000),BIN);
  Serial.print(" MUX_PIN: ");
  Serial.print(i,DEC); 
  Serial.print(" CC: ");
  Serial.print(CCID[i],DEC); 
  Serial.print(" DATA HEX: ");
  Serial.println(data[i],HEX); 
}</code></pre>

<p> It was made by the user oddson over at the Teensy forum (<a href="https://forum.pjrc.com/" rel="nofollow noopener">https://forum.pjrc.com</a>) ... <a href="https://forum.pjrc.com/threads/46571-Teensy-LC-CD74HC4051-multiplex-Midi-problem/page2" rel="nofollow noopener">HERE</a> is a link to the full thread if you're bored and wanna see how he developed it. </p>

<p>To set the CC values of the C0 pins on the red breakoutboard, change the values in the "const int CCID[MUX_PINS] = {70,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36};"  to whatever you want! left to right (70 to 36) are c0 to c15</p>

<p><strong>Step 9:</strong><br>Click "verify" <br>          <a href="../../../i.imgur.com/UCf5PQJ.png" target="_blank" rel="nofollow noopener">
            <img src="../../../i.imgur.com/UCf5PQJ.png" width="690" height="480">
          </a>
<br>Wait a little while and allow the arduino software to verify and compile the code. </p>

<p><strong>Step 10:</strong><br>Once its done compiling, click "upload" <br>          <a href="../../../i.imgur.com/twCl2Hg.png" target="_blank" rel="nofollow noopener">
            <img src="../../../i.imgur.com/twCl2Hg.png" width="652" height="500">
          </a>
</p>

<p><strong>Step 11:</strong><br>Plug your fancy new DIY midi controller into the axoloti and enjoy!</p>

<p>Note: this USB midi controller is gunna take up your USB port..not ideal if you want to use a USB keyboard....I'll make another tutorial on how to hardwire one of these directly to the MIDI in pins once I figure it out...many people have attempted to help me so far but I'm pretty dense and haven't been able to get it to work yet....<img src="../../images/emoji/twitter/sweat_smileae52.png?v=5" title=":sweat_smile:" class="emoji" alt=":sweat_smile:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:9'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
            <a href="../teensy-and-mux-through-i2c/6681.html">Teensy and Mux Through I2C</a>
            <hr>
            <a href="../new-retro-lookin-synth-v-02/4917.html">New retro lookin&#39; synth .... v.02</a>
            <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/SmashedTransistors.html'><b itemprop='author'>SmashedTransistors</b></a>
           
           <time datetime='2017-10-21T21:47:47Z' itemprop='datePublished'>
             2017-10-21 21:47:47 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks <a class="mention" href="../../u/androoclops-2.html">@Androoclops</a> !</p>

<p>How many usable analog inputs does the teensy LC have without the 4067 ?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Androoclops.html'><b itemprop='author'>Androoclops</b></a>
           
           <time datetime='2017-10-21T21:51:05Z' itemprop='datePublished'>
             2017-10-21 21:51:05 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>12 I believe. <br>Adding this board to it increases the number to 27 .</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/SmashedTransistors.html'><b itemprop='author'>SmashedTransistors</b></a>
           
           <time datetime='2017-10-21T21:54:49Z' itemprop='datePublished'>
             2017-10-21 21:54:49 UTC
           </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>12, wow, just what i need.<br>I'm investigating how to make a very compact pressure sensitive (poly aftertouch) 60 key keyboard arranged in a 12 x 5 matrix...<br>At the moment, i plan to implement it on the Axoloti, but the teensy is smaller and best fitted for a midi project without audio.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:2'>
      <meta itemprop='interactionCount' content='UserComments:2'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Androoclops.html'><b itemprop='author'>Androoclops</b></a>
           
           <time datetime='2017-10-21T21:57:54Z' itemprop='datePublished'>
             2017-10-21 21:57:54 UTC
           </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>cool! Post that project when you're done!</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/Androoclops.html'><b itemprop='author'>Androoclops</b></a>
           
           <time datetime='2017-10-21T21:59:27Z' itemprop='datePublished'>
             2017-10-21 21:59:27 UTC
           </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>oh yeah, heres a video of how to make one without a breakout board <br></p><div class="lazyYT" data-youtube-id="aVf_el4N0tI" data-youtube-title="How To Build A DIY MIDI Controller (2015 Edition)" data-width="480" data-height="270" data-parameters="feature=oembed&amp;wmode=opaque"></div><br>I've done this tutorial before, its quite simple and fun.
      </div>
      <meta itemprop='interactionCount' content='UserLikes:4'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/timeorspace.html'><b itemprop='author'>timeorspace</b></a>
           
           <time datetime='2017-10-22T00:22:51Z' itemprop='datePublished'>
             2017-10-22 00:22:51 UTC
           </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>amazing the money we save DIY... I've watched that vid before... well, ok, a few times. cheers!</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/SmashedTransistors.html'><b itemprop='author'>SmashedTransistors</b></a>
           
           <time datetime='2017-10-22T13:05:57Z' itemprop='datePublished'>
             2017-10-22 13:05:57 UTC
           </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../u/androoclops-2.html">@Androoclops</a>,</p>

<p>My goal is to make the simplest and fastest way to scan a 12 x 5 FSR matrix <img src="../../images/emoji/twitter/roll_eyesae52.png?v=5" title=":roll_eyes:" class="emoji" alt=":roll_eyes:"> </p>

<p>I have a few questions regarding multiplexing and the teensy LC.</p>

<ul>
<li><p>What is the maximum multiplexing speed it can achieve with the 4067 ?</p></li>
<li><p>Does the teensy LC digital outputs can be set to open drain ?</p></li>
<li>
<p>If so, how much current can they handle ?</p>
<ul><li>self answer about drive current : <a href="https://forum.pjrc.com/threads/27624-Coming-Soon-Teensy-LC-(low-cost-Teensy)?s=38b93fb5c0ee827d6b1306a84d99a1de&amp;p=62969&amp;viewfull=1#post62969">Teensy LC thread</a> : 5mA on most outputs excepted 4 outputs that are 20mA <img src="../../images/emoji/twitter/face_with_raised_eyebrowae52.png?v=5" title=":face_with_raised_eyebrow:" class="emoji" alt=":face_with_raised_eyebrow:">
</li></ul>
</li>
<li><p>how good are the analog inputs on the teensy. (On the Axoloti, i find them quite jittery and i may say that 8 bits out of 12 are usable, even with shielding).</p></li>
</ul>

<p>Sorry for this bunch of questions, but i think i am hooked.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/milibeauty.html'><b itemprop='author'>milibeauty</b></a>
           
           <time datetime='2019-11-22T03:49:00Z' itemprop='datePublished'>
             2019-11-22 03:49:00 UTC
           </time>
        </span>
        <span itemprop='position'>#9</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>About one problem you didn't mention, I can't find teensy lc board in the tools list, so I google it, turns out I need to download a file called teensyduino on PJRC.com/ , and now it's solved. </p>

<p>Also I wanna know if I wanna use two 4067 on one LC board, how should I change the code?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/synthy.html'><b itemprop='author'>synthy</b></a>
           
           <time datetime='2019-11-30T21:21:05Z' itemprop='datePublished'>
             2019-11-30 21:21:05 UTC
           </time>
        </span>
        <span itemprop='position'>#10</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Just make another analog in pin like int pin_In_Mux2 = A1; And add  all code with Mux1, but then Mux2</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/milibeauty.html'><b itemprop='author'>milibeauty</b></a>
           
           <time datetime='2019-12-09T03:43:13Z' itemprop='datePublished'>
             2019-12-09 03:43:13 UTC
           </time>
        </span>
        <span itemprop='position'>#11</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thank you</p>

<p>I've tried but the CC numbers are messy with each other and the signal is not stable... Some knobs can control more than 1 signal and I can't fix it. Here's my code, can you help me?</p>

<p>//************LIBRARIES USED**************<br>// include the ResponsiveAnalogRead library for analog smoothing</p>

<h1>include </h1>

<h1>include </h1>

<p>int RUN = 7;<br>//usbMIDI.h library is added automatically when code is compiled as a MIDI device</p>

<p>// ******CONSTANT VALUES******** <br>// customize code behaviour here!<br>const int muxTimeMin = 500; // minimum micro-seconds between MUX reads <br>const int channel = 1; // MIDI channel<br>const int MUX1_PINS = 16; // number of MUX Channnels<br>const int MUX2_PINS = 16;</p>

<p>// define the CC ID numbers on which to send them..</p>

<p>const int CCID1[MUX1_PINS] = {18,17,16,15,14,13,12,11,28,27,26,25,24,23,22,21};<br>const int CCID2[MUX2_PINS] = {0,1,2,10,31,32,33,34,35,36,20,3,4,5,6,30};</p>

<p>//******VARIABLES***********<br>// a data array and a lagged copy to tell when MIDI changes are required<br>byte data1[MUX1_PINS];<br>byte dataLag1[MUX1_PINS]; // when lag and new are not the same then update MIDI CC value<br>byte i=0; // global index for MUX channel reads<br>byte data2[MUX2_PINS];<br>byte dataLag2[MUX2_PINS]; </p>

<p>//mapping of mux to teensy digital pins<br>int pin_Out1_S0 = 1;<br>int pin_Out1_S1 = 2;<br>int pin_Out1_S2 = 3;<br>int pin_Out1_S3 = 4;<br>int pin_In_Mux1 = A9;</p>

<p>int pin_Out2_S0 = 5;<br>int pin_Out2_S1 = 6;<br>int pin_Out2_S2 = 7;<br>int pin_Out2_S3 = 8;<br>int pin_In_Mux2 = A8;</p>

<p>//****** TIMER VARIABLE *** change scale here!<br>elapsedMicros mux1Updated; // switch to micros to run at speed and tune with muxTimeMin setting above<br>//elapsedMillis mux1Updated; // switch to millis to troubleshoot </p>

<p>//************INITIALIZE LIBRARY OBJECTS**************<br>// initialize the ReponsiveAnalogRead objects<br>ResponsiveAnalogRead analog1[]{<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>  {pin_In_Mux1 ,true},<br>};<br>ResponsiveAnalogRead analog2[]{<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true},<br>  {pin_In_Mux2 ,true}<br>}; </p>

<p>//************SETUP**************<br>void setup() {<br>  //! don't forget to set for output!<br>  pinMode(pin_Out1_S0, OUTPUT);<br>  pinMode(pin_Out1_S1, OUTPUT);<br>  pinMode(pin_Out1_S2, OUTPUT);<br>  pinMode(pin_Out1_S3, OUTPUT);<br>  pinMode(pin_Out2_S0, OUTPUT);<br>  pinMode(pin_Out2_S1, OUTPUT);<br>  pinMode(pin_Out2_S2, OUTPUT);<br>  pinMode(pin_Out2_S3, OUTPUT);<br>   Serial.begin(31250);<br>  pinMode(RUN, INPUT);<br>}</p>

<p>//************LOOP**************<br>void loop() {</p>

<p>  int STATE = digitalRead(RUN);<br>  Serial.println(RUN);<br>  delay(1);</p>

<p>  nextMUXpin();<br>  while (usbMIDI.read()) {<br>     // controllers must call .read() to keep the queue clear even if they are not responding to MIDI<br>  }<br>}</p>

<p>//************MUX SECTION**************<br>void nextMUXpin(){<br>  if (mux1Updated&gt;muxTimeMin) {<br>    // update the ResponsiveAnalogRead object every loop<br>    analog1[i].update(); <br>    analog2[i].update(); <br>    // if the repsonsive value has change, print out 'changed'<br>    if(analog1[i].hasChanged()) {<br>      data1[i] = analog1[i].getValue()&gt;&gt;3;<br>      if (data1[i] != dataLag1[i]){<br>        dataLag1[i] = data1[i];<br>        usbMIDI.sendControlChange(CCID1[i], data1[i], channel);<br>        serialPringMIDIdata(); // use to troublshoot<br>      }<br>    }<br>    if(analog2[i].hasChanged()) {<br>      data2[i] = analog2[i].getValue()&gt;&gt;3;<br>      if (data2[i] != dataLag2[i]){<br>        dataLag2[i] = data2[i];<br>        usbMIDI.sendControlChange(CCID2[i], data2[i], channel);<br>        serialPringMIDIdata(); // use to troublshoot<br>      }<br>    }  </p>

<pre><code>//reset timer
mux1Updated = 0; 
//increment index
i++;
if (i&gt;15)   {i=0;}      
// set mux control pins for next pass
digitalWrite(pin_Out1_S0, HIGH &amp;&amp; (i &amp; B00000001));
digitalWrite(pin_Out1_S1, HIGH &amp;&amp; (i &amp; B00000010));
digitalWrite(pin_Out1_S2, HIGH &amp;&amp; (i &amp; B00000100));
digitalWrite(pin_Out1_S3, HIGH &amp;&amp; (i &amp; B00001000));

digitalWrite(pin_Out2_S0, HIGH &amp;&amp; (i &amp; B00000001));
digitalWrite(pin_Out2_S1, HIGH &amp;&amp; (i &amp; B00000010));
digitalWrite(pin_Out2_S2, HIGH &amp;&amp; (i &amp; B00000100));
digitalWrite(pin_Out2_S3, HIGH &amp;&amp; (i &amp; B00001000));</code></pre>

<p>  }<br>}</p>

<p>// **useful for debugging, comment out function call to run full speed<br>void serialPringMIDIdata(){<br>  Serial.print(i,DEC);<br>  Serial.print(" :");<br>  Serial.print(HIGH &amp;&amp; (i &amp; B00000001),BIN);<br>  Serial.print(HIGH &amp;&amp; (i &amp; B00000010),BIN);<br>  Serial.print(HIGH &amp;&amp; (i &amp; B00000100),BIN);<br>  Serial.print(HIGH &amp;&amp; (i &amp; B00001000),BIN);<br>  Serial.print(" MUX_PIN: ");<br>  Serial.print(i,DEC); <br>  Serial.print(" CC: ");<br>  Serial.print(CCID1[i],DEC); <br>  Serial.print(" DATA HEX: ");<br>  Serial.println(data1[i],HEX); </p>

<p>  Serial.print(i,DEC);<br>  Serial.print(" :");<br>  Serial.print(HIGH &amp;&amp; (i &amp; B00000001),BIN);<br>  Serial.print(HIGH &amp;&amp; (i &amp; B00000010),BIN);<br>  Serial.print(HIGH &amp;&amp; (i &amp; B00000100),BIN);<br>  Serial.print(HIGH &amp;&amp; (i &amp; B00001000),BIN);<br>  Serial.print(" MUX_PIN: ");<br>  Serial.print(i,DEC); <br>  Serial.print(" CC: ");<br>  Serial.print(CCID2[i],DEC); <br>  Serial.print(" DATA HEX: ");<br>  Serial.println(data2[i],HEX); <br>}</p>

<p>yes I also wrote a button for the start function but it still not work either...</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/tele_player.html'><b itemprop='author'>tele_player</b></a>
           
           <time datetime='2019-12-09T06:34:27Z' itemprop='datePublished'>
             2019-12-09 06:34:27 UTC
           </time>
        </span>
        <span itemprop='position'>#12</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>What value pots are you using?<br>How many pots are you using?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/milibeauty.html'><b itemprop='author'>milibeauty</b></a>
           
           <time datetime='2019-12-09T06:40:06Z' itemprop='datePublished'>
             2019-12-09 06:40:06 UTC
           </time>
        </span>
        <span itemprop='position'>#13</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I'm using 1,2,3,4 and A9 for the first mux, and 5,6,7,8 plus A8 for the second mux.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/milibeauty.html'><b itemprop='author'>milibeauty</b></a>
           
           <time datetime='2019-12-09T09:17:26Z' itemprop='datePublished'>
             2019-12-09 09:17:26 UTC
           </time>
        </span>
        <span itemprop='position'>#14</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thank you guys again<br>I just figured it out!!<br>I duplicated the code and set all data into double, and it worked!!<br>I‘ve been tracking this webpage for half a year(A chinese girl who wasn't good at english and was using translation software to understand what I see LOL) and my little instrument has been through 3 versions...  I'll send my project here after the exhibition this weekend!!!!!<br>Thank you so much~~~~~</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/mlinton.html'><b itemprop='author'>mlinton</b></a>
           
           <time datetime='2019-12-10T21:35:42Z' itemprop='datePublished'>
             2019-12-10 21:35:42 UTC
           </time>
        </span>
        <span itemprop='position'>#15</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Can you post the basics of what you've done (parts used), I want to do something very similar.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/SmashedTransistors.html'><b itemprop='author'>SmashedTransistors</b></a>
           
           <time datetime='2019-12-10T22:55:16Z' itemprop='datePublished'>
             2019-12-10 22:55:16 UTC
           </time>
        </span>
        <span itemprop='position'>#16</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Why don't you reuse the same outputs to control both 4067 ?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/milibeauty.html'><b itemprop='author'>milibeauty</b></a>
           
           <time datetime='2019-12-12T07:44:02Z' itemprop='datePublished'>
             2019-12-12 07:44:02 UTC
           </time>
        </span>
        <span itemprop='position'>#17</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I need a list of CC number to control every knobs in the patch. Use the same outputs is unstable for the signal</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/tele_player.html'><b itemprop='author'>tele_player</b></a>
           
           <time datetime='2019-12-12T14:32:11Z' itemprop='datePublished'>
             2019-12-12 14:32:11 UTC
           </time>
        </span>
        <span itemprop='position'>#18</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>We understand that you need  CC for every knob. <br>But, you can use the same selectors (1,2,3,4) on both mux, and use A8 for knob 0-15, and A9 for knob 16-31. <br>So, you only use 6 Axoloti pins, instead of 10.</p>

<p>If this did not work, then there was an error in your wiring or your code.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/axism.html'><b itemprop='author'>axism</b></a>
           
           <time datetime='2019-12-14T15:43:43Z' itemprop='datePublished'>
             2019-12-14 15:43:43 UTC
           </time>
        </span>
        <span itemprop='position'>#19</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hello.  It not directly relate but notesandvolts member on youtube have good tutorial for how to do many control with midi using mux method.  It can be handy for lots of controls into few connections.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:2'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='../../u/milibeauty.html'><b itemprop='author'>milibeauty</b></a>
           
           <time datetime='2019-12-17T00:36:05Z' itemprop='datePublished'>
             2019-12-17 00:36:05 UTC
           </time>
        </span>
        <span itemprop='position'>#20</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I really didn't think of it... I may try this method on the other projects. Thank you.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Make a USB midi controller with 16 (to 27) analog inputs for cheap!'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  

<!-- Mirrored from community.axoloti.com/t/make-a-usb-midi-controller-with-16-to-27-analog-inputs-for-cheap/3866?source_topic_id=6681 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jul 2023 16:43:48 GMT -->
</html>
